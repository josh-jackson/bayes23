<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Bayesian Statistics 2023 - mlm</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Bayesian Statistics 2023</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./lectures.html" rel="" target="">
 <span class="menu-text">Lectures</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./homework.html" rel="" target="">
 <span class="menu-text">Homework</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./syllabus.html" rel="" target="">
 <span class="menu-text">Syllabus</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#mlm-review" id="toc-mlm-review" class="nav-link active" data-scroll-target="#mlm-review">MLM review</a></li>
  <li><a href="#empty-model" id="toc-empty-model" class="nav-link" data-scroll-target="#empty-model">Empty model</a></li>
  <li><a href="#random-and-fixed-effects" id="toc-random-and-fixed-effects" class="nav-link" data-scroll-target="#random-and-fixed-effects">Random and fixed effects</a></li>
  <li><a href="#level-1-predictors" id="toc-level-1-predictors" class="nav-link" data-scroll-target="#level-1-predictors">Level 1 predictors</a></li>
  <li><a href="#error-structure" id="toc-error-structure" class="nav-link" data-scroll-target="#error-structure">Error structure</a></li>
  <li><a href="#multiple-level-1-predictors" id="toc-multiple-level-1-predictors" class="nav-link" data-scroll-target="#multiple-level-1-predictors">Multiple level 1 predictors</a></li>
  <li><a href="#level-2-predictors" id="toc-level-2-predictors" class="nav-link" data-scroll-target="#level-2-predictors">Level 2 predictors</a></li>
  <li><a href="#cross-level-interactions" id="toc-cross-level-interactions" class="nav-link" data-scroll-target="#cross-level-interactions">Cross level interactions</a></li>
  <li><a href="#centering" id="toc-centering" class="nav-link" data-scroll-target="#centering">Centering</a></li>
  <li><a href="#mlm-as-default-and-make-it-maximum" id="toc-mlm-as-default-and-make-it-maximum" class="nav-link" data-scroll-target="#mlm-as-default-and-make-it-maximum">MLM as default and make it maximum</a></li>
  <li><a href="#mlm-intuitions" id="toc-mlm-intuitions" class="nav-link" data-scroll-target="#mlm-intuitions">MLM intuitions</a></li>
  <li><a href="#handling-multiple-dvs" id="toc-handling-multiple-dvs" class="nav-link" data-scroll-target="#handling-multiple-dvs">Handling multiple DVs?</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  <li><a href="#aggregation-obscures-hypotheses" id="toc-aggregation-obscures-hypotheses" class="nav-link" data-scroll-target="#aggregation-obscures-hypotheses">1. Aggregation obscures hypotheses</a></li>
  <li><a href="#regressions-within-regressions" id="toc-regressions-within-regressions" class="nav-link" data-scroll-target="#regressions-within-regressions">2. Regressions within regressions</a></li>
  <li><a href="#stroop-example" id="toc-stroop-example" class="nav-link" data-scroll-target="#stroop-example">Stroop example</a></li>
  <li><a href="#diferent-levels" id="toc-diferent-levels" class="nav-link" data-scroll-target="#diferent-levels">3. Diferent levels</a></li>
  <li><a href="#variance-decomposition" id="toc-variance-decomposition" class="nav-link" data-scroll-target="#variance-decomposition">4. Variance decomposition</a></li>
  <li><a href="#shrinkagepartial-pooling" id="toc-shrinkagepartial-pooling" class="nav-link" data-scroll-target="#shrinkagepartial-pooling">5. Shrinkage/partial pooling</a></li>
  <li><a href="#complete-partial-and-no-pooling" id="toc-complete-partial-and-no-pooling" class="nav-link" data-scroll-target="#complete-partial-and-no-pooling">Complete, partial and no pooling</a></li>
  <li><a href="#complete-pooling" id="toc-complete-pooling" class="nav-link" data-scroll-target="#complete-pooling">Complete pooling</a></li>
  <li><a href="#no-pooling" id="toc-no-pooling" class="nav-link" data-scroll-target="#no-pooling">No Pooling</a></li>
  <li><a href="#partial-pooling-aka-shrinkage-aka-regularization" id="toc-partial-pooling-aka-shrinkage-aka-regularization" class="nav-link" data-scroll-target="#partial-pooling-aka-shrinkage-aka-regularization">Partial pooling aka shrinkage aka regularization</a></li>
  <li><a href="#parameters-that-depend-on-other-parameters" id="toc-parameters-that-depend-on-other-parameters" class="nav-link" data-scroll-target="#parameters-that-depend-on-other-parameters">6. Parameters that depend on other parameters</a></li>
  <li><a href="#hyperprior" id="toc-hyperprior" class="nav-link" data-scroll-target="#hyperprior">Hyperprior</a></li>
  <li><a href="#parameters-that-depend-on-parameters" id="toc-parameters-that-depend-on-parameters" class="nav-link" data-scroll-target="#parameters-that-depend-on-parameters">Parameters that depend on parameters</a></li>
  <li><a href="#parameters-that-depend-on-parameters-1" id="toc-parameters-that-depend-on-parameters-1" class="nav-link" data-scroll-target="#parameters-that-depend-on-parameters-1">Parameters that depend on parameters</a></li>
  <li><a href="#partial-poolingshrinkage" id="toc-partial-poolingshrinkage" class="nav-link" data-scroll-target="#partial-poolingshrinkage">Partial pooling/Shrinkage</a></li>
  <li><a href="#partial-poolingshrinkage-1" id="toc-partial-poolingshrinkage-1" class="nav-link" data-scroll-target="#partial-poolingshrinkage-1">Partial pooling/Shrinkage</a></li>
  <li><a href="#working-with-mlm-posterior" id="toc-working-with-mlm-posterior" class="nav-link" data-scroll-target="#working-with-mlm-posterior">working with mlm posterior</a></li>
  <li><a href="#level-1-predictors-1" id="toc-level-1-predictors-1" class="nav-link" data-scroll-target="#level-1-predictors-1">level 1 predictors</a></li>
  <li><a href="#whats-in-our-posterior" id="toc-whats-in-our-posterior" class="nav-link" data-scroll-target="#whats-in-our-posterior">whats in our posterior?</a></li>
  <li><a href="#introducing-random-slopes" id="toc-introducing-random-slopes" class="nav-link" data-scroll-target="#introducing-random-slopes">Introducing random slopes</a></li>
  <li><a href="#random-slopes" id="toc-random-slopes" class="nav-link" data-scroll-target="#random-slopes">Random slopes</a></li>
  <li><a href="#correlated-features" id="toc-correlated-features" class="nav-link" data-scroll-target="#correlated-features">correlated features</a></li>
  <li><a href="#random-slopes-1" id="toc-random-slopes-1" class="nav-link" data-scroll-target="#random-slopes-1">Random slopes</a></li>
  <li><a href="#lkj-1-parameter-correlation-prior" id="toc-lkj-1-parameter-correlation-prior" class="nav-link" data-scroll-target="#lkj-1-parameter-correlation-prior">lkj 1 parameter correlation prior</a></li>
  <li><a href="#multivariate-distributions" id="toc-multivariate-distributions" class="nav-link" data-scroll-target="#multivariate-distributions">Multivariate distributions</a></li>
  <li><a href="#making-predictions" id="toc-making-predictions" class="nav-link" data-scroll-target="#making-predictions">Making predictions</a></li>
  <li><a href="#mr.-p" id="toc-mr.-p" class="nav-link" data-scroll-target="#mr.-p">Mr.&nbsp;P</a></li>
  <li><a href="#mr.p" id="toc-mr.p" class="nav-link" data-scroll-target="#mr.p">Mr.P</a></li>
  <li><a href="#weighting-vs-postratifying" id="toc-weighting-vs-postratifying" class="nav-link" data-scroll-target="#weighting-vs-postratifying">Weighting vs postratifying</a></li>
  <li><a href="#mr.p-not-limited-to-surveys" id="toc-mr.p-not-limited-to-surveys" class="nav-link" data-scroll-target="#mr.p-not-limited-to-surveys">Mr.P Not limited to surveys</a></li>
  <li><a href="#recent-example" id="toc-recent-example" class="nav-link" data-scroll-target="#recent-example">recent example</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="mlm-8.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">mlm</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<hr>
<p><img src="chelsea.jpeg" class="img-fluid"></p>
<section id="mlm-review" class="level2">
<h2 class="anchored" data-anchor-id="mlm-review">MLM review</h2>
<p><span class="math display">\[{Y}_{i} = b_{0} + b_{1}X_{i} +  ... +\epsilon_{i}\]</span></p>
<p><span class="math display">\[{Y}_{ij} = b_{0} + b_{1}X_{ij} + ... +\epsilon_{ij}\]</span> Where j refers to some clustering or grouping variable and i refers to the observations within j</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/josh-jackson/bayes/master/mlm.csv"</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>mlm <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(data) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.2     ✔ readr     2.1.4
✔ forcats   1.0.0     ✔ stringr   1.5.0
✔ ggplot2   3.4.3     ✔ tibble    3.2.1
✔ lubridate 1.9.2     ✔ tidyr     1.3.0
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">114</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>mlm <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n_of</span>(<span class="dv">20</span>, ID) <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> CON, <span class="at">group =</span> ID, <span class="at">fill =</span> ID)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(ID))) <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(ID)),<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"X"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Y"</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="empty-model" class="level2">
<h2 class="anchored" data-anchor-id="empty-model">Empty model</h2>
<p>Level 1 <span class="math display">\[{Y}_{ij} = \beta_{0j}  + \varepsilon_{ij}\]</span></p>
<p>Level 2 <span class="math display">\[{\beta}_{0j} = \gamma_{00} + U_{0j}\]</span></p>
<p><span class="math display">\[{U}_{0j} \sim\mathcal{N}(0, \tau_{00}^{2})\]</span> <span class="math display">\[{e}_{ij} \sim\mathcal{N}(0, \sigma^{2})\]</span></p>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mlm <span class="sc">%&gt;%</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n_of</span>(<span class="dv">8</span>, ID) <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> CON, <span class="at">group =</span> ID)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(ID))) <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(ID)), <span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula=</span>y<span class="sc">~</span><span class="dv">1</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"X"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Y"</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><span class="math display">\[{Y}_{ij} = \gamma_{00} + U_{0j}  + \varepsilon_{ij}\]</span></p>
<p>Akin to ANOVA if we treat <span class="math inline">\(U_{0j}\)</span> as between subjects variance &amp; <span class="math inline">\(\varepsilon_{ij}\)</span> as within subjects variance.</p>
</section>
<section id="random-and-fixed-effects" class="level2">
<h2 class="anchored" data-anchor-id="random-and-fixed-effects">Random and fixed effects</h2>
<div class="columns">
<div class="column" style="width:40%;">
<p>Level 1: <span class="math display">\[{Y}_{ij} = \beta_{0j}  + \varepsilon_{ij}\]</span></p>
<p>Level 2: <span class="math display">\[{\beta}_{0j} = \gamma_{00} + U_{0j}\]</span> Combined: <span class="math display">\[{Y}_{ij} = \gamma_{00} + U_{0j}  + \varepsilon_{ij}\]</span></p>
</div><div class="column" style="width:60%;">
<p><span class="math inline">\(U_{0j}\)</span> is considered a random effect, as it is varies across our grouping</p>
<p><span class="math inline">\(\gamma_{00}\)</span> is considered a fixed effect, as it is what is fixed (average) across our grouping</p>
</div>
</div>
</section>
<section id="level-1-predictors" class="level2">
<h2 class="anchored" data-anchor-id="level-1-predictors">Level 1 predictors</h2>
<p>Level 1 is where you have data that repeats within your grouping or clustering data. Is your cluster classrooms? Then students are level 1. Is your cluster people? Then observations are level 1.</p>
<p><span class="math display">\[{Y}_{ij} = \beta_{0j}  + \beta_{1j}X_{ij} + \varepsilon_{ij}\]</span> Notice on the subscript of X that these predictors vary across group (j) and within the group (i) So if your grouping (j) is people, then i refers to different observations.</p>
<hr>
<p>Level 2 takes the parameters at level 1 and decomposes them into a fixed component ( <span class="math inline">\(\gamma\)</span> ) that reflects the average and, if desired, the individual deviations around that fixed effect (U).</p>
<p>level 1 <span class="math display">\[{Y}_{ij} = \beta_{0j}  + \beta_{1j}X_{ij} + \varepsilon_{ij}\]</span></p>
<p>level 2 <span class="math display">\[{\beta}_{0j} = \gamma_{00} + U_{0j}\]</span><br>
<span class="math display">\[{\beta}_{1j} = \gamma_{10}\]</span></p>
<hr>
<p>Level 1:</p>
<p><span class="math display">\[{Y}_{ij} = \beta_{0j}  + \beta_{1j}X_{ij} + \varepsilon_{ij}\]</span> Level 2:<br>
<span class="math display">\[{\beta}_{0j} = \gamma_{00} + U_{0j}\]</span></p>
<p><span class="math display">\[{\beta}_{1j} = \gamma_{10} + U_{1j}\]</span></p>
<p>Combined <span class="math display">\[{Y}_{ij} = \gamma_{00} + \gamma_{10}(X_{ij})+ U_{0j} + U_{1j}(X_{ij}) + \varepsilon_{ij}\]</span></p>
<p>Can think of a persons score divided up into a fixed component as well as the random component.</p>
<p><span class="math display">\[{\beta}_{16} = \gamma_{10} \pm U_{16}\]</span></p>
</section>
<section id="error-structure" class="level2">
<h2 class="anchored" data-anchor-id="error-structure">Error structure</h2>
<p>The residual structure, where the random effects are again normally distributed with a mean of zero, but this time one must also consider covariance in addition to variance.</p>
<p><span class="math display">\[\begin{pmatrix} {U}_{0j} \\ {U}_{1j} \end{pmatrix}
\sim \mathcal{N} \begin{pmatrix}
  0,      \tau_{00}^{2} &amp; \tau_{01}\\
  0,  \tau_{01} &amp; \tau_{10}^{2}
\end{pmatrix}\]</span></p>
<p>Note that it is possible to have a different error structure for the random effects</p>
<p><span class="math display">\[{e}_{ij} \sim \mathcal{N}(0, \sigma^{2})\]</span></p>
</section>
<section id="multiple-level-1-predictors" class="level2">
<h2 class="anchored" data-anchor-id="multiple-level-1-predictors">Multiple level 1 predictors</h2>
<p>Level 1:</p>
<p><span class="math display">\[{Y}_{ijk} = \beta_{0j}  + \beta_{1j}X_{ij} + \beta_{2j}Z_{ik} + \varepsilon_{ijk}\]</span> Level 2:<br>
<span class="math display">\[{\beta}_{0j} = \gamma_{00} + U_{0j}\]</span></p>
<p><span class="math display">\[{\beta}_{1j} = \gamma_{10} + U_{1j}\]</span> <span class="math display">\[{\beta}_{2k} = \gamma_{20} + U_{2k}\]</span></p>
</section>
<section id="level-2-predictors" class="level2">
<h2 class="anchored" data-anchor-id="level-2-predictors">Level 2 predictors</h2>
<p>Level 1: <span class="math display">\[{Y}_{ij} = \beta_{0j}  + \beta_{1j}X_{ij} + \varepsilon_{ij}\]</span> Level 2: <span class="math display">\[{\beta}_{0j} = \gamma_{00} + \gamma_{01}G_{j} +   U_{0j}\]</span><br>
<span class="math display">\[{\beta}_{1j} = \gamma_{10} + U_{1j}\]</span></p>
<p>Combined <span class="math display">\[{Y}_{ij} = \gamma_{00} + \gamma_{01}G_{j}+  \gamma_{10} (X_{ij}) + U_{0j} + U_{1j}(X_{ij}) + \varepsilon_{ij}\]</span> <span class="math display">\[{Y}_{ij} = [\gamma_{00} + \gamma_{01}G_{j}+ U_{0j}]  + [(\gamma_{10}  + U_{1j})(X_{ij})] + \varepsilon_{ij}\]</span></p>
</section>
<section id="cross-level-interactions" class="level2">
<h2 class="anchored" data-anchor-id="cross-level-interactions">Cross level interactions</h2>
<p>level 1: <span class="math display">\[{Y}_{ij} = \beta_{0j}  + \beta_{1j}X_{ij} + \varepsilon_{ij}\]</span> Level 2: <span class="math display">\[{\beta}_{0j} = \gamma_{00} + \gamma_{01}G_{j} +   U_{0j}\]</span><br>
<span class="math display">\[{\beta}_{1j} = \gamma_{10} + \gamma_{11}G_{j} + U_{1j}\]</span><br>
<span class="math display">\[{Y}_{ij} = \gamma_{00} + \gamma_{01}G_{j}+  \gamma_{10} (X_{ij}) + \gamma_{11}(G_{j}*X{ij}) +  U_{0j} + U_{1j}(X{ij}) + \varepsilon_{ij}\]</span></p>
<p><span class="math display">\[{Y}_{ij} = [\gamma_{00} + U_{0j} +\gamma_{01}G_{j}] + [(\gamma_{10}  + \gamma_{11}G_{j}+  U_{1j})(X{ij})] + \varepsilon_{ij}\]</span></p>
</section>
<section id="centering" class="level2">
<h2 class="anchored" data-anchor-id="centering">Centering</h2>
<p>As a rule, each level-1 predictor is usually really 2 predictor variables. It is important to separate within-group from between group variance. Failing to do so will “smush” between and within variance to level 1.</p>
<p>Example: student SES at level 1, with schools at level 2. Some kids have more money than other kids in their school Some schools have more money than other schools</p>
<p>Fortunately it is easy to separate this</p>
<hr>
<p>Level 1: <span class="math display">\[{Y}_{ij} = \beta_{0j}  + \beta_{1j}(X_{ij}- \bar{X_j}) + \varepsilon_{ij}\]</span></p>
<p>Level 2: <span class="math display">\[{\beta}_{0j} = \gamma_{00} + \bar{X_j} +   U_{0j}\]</span></p>
<p><span class="math display">\[{\beta}_{1j} = \gamma_{10} + \bar{X_j} + U_{1j}\]</span></p>
</section>
<section id="mlm-as-default-and-make-it-maximum" class="level2">
<h2 class="anchored" data-anchor-id="mlm-as-default-and-make-it-maximum">MLM as default and make it maximum</h2>
<p>If you have data like this you should analyze like this! If you don’t, then you are losing information (GEE being a potential exception).</p>
<p>The question often is about which random effects to fit. There are multiple opinions, but mine is to start maximum, and then work downward (ie simplify) if necessary/consistent with theory. It doesn’t really hurt to include them, especially within Bayesian estimation!</p>
</section>
<section id="mlm-intuitions" class="level2">
<h2 class="anchored" data-anchor-id="mlm-intuitions">MLM intuitions</h2>
<p>Anytime you have repeated DVs you should use MLM as opposed to doing aggregation outside the model. While that should be your default, it is helpful to conceptualize why it is helpful.</p>
<ol type="1">
<li>Aggregation is bad</li>
<li>Regressions within regressions (ie coefficients as outcomes)</li>
<li>Questions at different levels</li>
<li>Variance decomposition<br>
</li>
<li>Learning from other data through pooling/shrinkage</li>
<li>Parameters that depend on parameters</li>
</ol>
</section>
<section id="handling-multiple-dvs" class="level2">
<h2 class="anchored" data-anchor-id="handling-multiple-dvs">Handling multiple DVs?</h2>
<p>What if people had more than 1 DV, like we do with time? What do you do with multiple items, multiple trials, multiple ____ ?</p>
<p>Two options: 1. Collapse and average across.</p>
</section>
<section id="example" class="level2">
<h2 class="anchored" data-anchor-id="example">Example</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>simp<span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>ID, <span class="sc">~</span>group,  <span class="sc">~</span>test.score, <span class="sc">~</span>study,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">1</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">3</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">2</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">4</span>,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="dv">6</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">5</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="dv">7</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">4</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="dv">8</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">6</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="dv">9</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">5</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="dv">10</span>,<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>Could aggragate across group</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="aggregation-obscures-hypotheses" class="level2">
<h2 class="anchored" data-anchor-id="aggregation-obscures-hypotheses">1. Aggregation obscures hypotheses</h2>
<ul>
<li><p>Between person H1: Do students who study more get better grades?</p></li>
<li><p>Within person H2: When a student studies, do they get better grades?</p></li>
<li><p>H1 and H2 are independent from one another! Aggregation collapses the two. When you have nested data with many DVs it is important to not aggregate.</p></li>
<li><p>#compositeskill</p></li>
</ul>
</section>
<section id="regressions-within-regressions" class="level2">
<h2 class="anchored" data-anchor-id="regressions-within-regressions">2. Regressions within regressions</h2>
<p>Helps to take multilevel and split it into the different levels.</p>
<p>Level 1 is the smallest unit of analysis (students, waves, trials, family members)</p>
<p>Level 2 variables are what level 1 variables are “nested” in (people, schools, counties, families, dyads)</p>
<p>We are going to use level one components to run a regression, all the while level 1 is also estimating a regression. (Coefficents as outcomes)</p>
<hr>
</section>
<section id="stroop-example" class="level2">
<h2 class="anchored" data-anchor-id="stroop-example">Stroop example</h2>
<p>We calculate stroop scores by looking at repeated trials of congruent vs not congruent. This is dummy coded such that the <span class="math inline">\(\beta_{1}\)</span> reflects the average stroop effect. How much slower are people in incongruent trials?</p>
<p><span class="math display">\[Y_{i} = \beta_{0} + \beta_{1}X_{1} + \varepsilon_i\]</span></p>
<hr>
<p><span class="math display">\[Y_{trials, i} = \beta_{0i} + \beta_{1i}X_{trial,i} + \varepsilon_{trial,i}\]</span></p>
<p><span class="math display">\[\beta_{0} = \gamma_{00} + U_{0i}\]</span> <span class="math display">\[\beta_{1} = \gamma_{10} +\gamma_{11}Age_i+ U_{1i}\]</span></p>
<p>Our B1 coefficient indexes the stroop effect. However, people differ on this stroop effect. There is some average effect (fixed effect) that people vary around. Each person has some personal <span class="math inline">\(\beta_1\)</span>, which we find using Level 1 data. From there we can also ask questions (with regressions) about that random variable.</p>
<hr>
<p>People differ on the stroop</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>example <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/josh-jackson/longitudinal-2021/master/example.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 225 Columns: 50
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr  (17): group, Exclude, RSNexclude, RSNexcludeDevDem, PIBpos18, Neuro_Dx,...
dbl  (30): ID, time, CON, CON_SAL, CON_SMN7, DAN, DAN_CON, DAN_SAL, DAN_SMN7...
date  (3): date, CogDate_0, CCIRtrio_MR_date_0

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>example<span class="sc">$</span>year <span class="ot">&lt;-</span> example<span class="sc">$</span>week</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>ex.random <span class="ot">&lt;-</span> example <span class="sc">%&gt;%</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ID) <span class="sc">%&gt;%</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  distinct <span class="sc">%&gt;%</span> </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_n</span>(<span class="dv">3</span>) </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>example2 <span class="ot">&lt;-</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ex.random, example)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(ID)`</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>g2<span class="ot">&lt;-</span> <span class="fu">ggplot</span>(example2,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> SMN7, <span class="at">group =</span> ID)) <span class="sc">+</span>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">formula=</span>y<span class="sc">~</span><span class="dv">1</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">facet_wrap</span>( <span class="sc">~</span>ID) <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> .<span class="dv">13</span>) <span class="sc">+</span>  <span class="fu">ylab</span>(<span class="st">"stroop effect"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"trials"</span>) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="at">label=</span><span class="st">"Grand mean "</span>,  <span class="at">x=</span><span class="dv">1</span>,<span class="at">y=</span>.<span class="dv">13</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">label.size =</span> <span class="fl">0.15</span>) </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>g2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>example <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do</span>(<span class="at">avg =</span> <span class="fu">tidy</span>(<span class="fu">lm</span>(SMN7 <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> .))) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(avg) <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimate)) <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_dotsinterval</span>() <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"density"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="diferent-levels" class="level2">
<h2 class="anchored" data-anchor-id="diferent-levels">3. Diferent levels</h2>
<p>To sum up the first two ways to think about regression, we take a relationship that could be simplified by aggregation, and conduct regressions from regressions. (Regression inception)</p>
<p>The third way is to think of questions at different levels. At level 1 we can ask lower-unit questions e.g., if trials are nested within person, what predicts lengthier trials?</p>
<p>If level 1 is made up of repeated observations, then we can ask level 1/observation level questions like does failure at the trial level impact future trial performance.</p>
<hr>
<p>At level 2 we can ask broader-unit questions. E.g., is age associated with stroop differences</p>
<p>Often level 2 is between person variables.</p>
<p>Both levels are simple regressions. Level 2 uses coefficients from level 1 as DVs. Level 1 variables are time varying, level 2 variables are time invariant</p>
</section>
<section id="variance-decomposition" class="level2">
<h2 class="anchored" data-anchor-id="variance-decomposition">4. Variance decomposition</h2>
<p>For standard regression, we think of error as existing in one big bucket called <span class="math inline">\(\varepsilon\)</span> . Everything that we do not know goes into that bucket, from measurement error to unmeasured important factors.</p>
<p>For MLMs we will be breaking up ( <span class="math inline">\(\varepsilon\)</span> ) into multiple buckets. These useful “buckets” (Us) are what we refer to as random/varying effects.</p>
<p><span class="math display">\[Y_{trials, i} = \beta_{0i} + \beta_{1i}X_{trial,i} + \varepsilon_{trial}\]</span> <span class="math display">\[\beta_{0} = \gamma_{00} + U_{0i}\]</span> <span class="math display">\[\beta_{1} = \gamma_{10} +\gamma_{11}Z_i+ U_{1i}\]</span></p>
<hr>
<p><img src="btw.png" class="img-fluid"></p>
<p>Assume a simple intercept only model where we aggregate across types of trials.</p>
<hr>
<p><img src="win.png" class="img-fluid"></p>
<p>A MLM intercept only model takes what was previously chalked up to error and reassigns it into person specific “buckets”</p>
<hr>
<p>Model for the means (like normal) and now we have a model for the variance (random effects!)</p>
<p>We will treat random effects as variables themselves e.g.&nbsp;individual differences in reaction time or stroop effect. They index how much people DIFFER on some effect. e.g.&nbsp;does everyone show the same stroop effect?</p>
<p>We can relate the random effects to other random effects e.g., do people who show an effect have a slower reaction time?</p>
</section>
<section id="shrinkagepartial-pooling" class="level2">
<h2 class="anchored" data-anchor-id="shrinkagepartial-pooling">5. Shrinkage/partial pooling</h2>
<ul>
<li><p>We treat our group variable as coming from a population. All groups are alike (because they are from the same population), but different in their own way. Because of this it is helpful to use information from other groups to help make predictions.</p></li>
<li><p>We do this in standard regression where we make predictions based on values from the whole dataset (not just binned Xs). A similar analogy for MLM is running a regression for each group. We want to pool as this leads to better predictions as we are not overfitting our data!</p></li>
</ul>
<hr>
<p>If we take our simplified stroop effect model (an empty model)</p>
<p><span class="math display">\[Y_{trials, i} = \beta_{0i} +  \varepsilon_{trial}\]</span></p>
<p><span class="math display">\[\beta_{0} = \gamma_{00} + U_{0i}\]</span></p>
<p>Where does <span class="math inline">\(U_{0i}\)</span> come from? If we calculated each by hand, through taking the average reaction time for a person i and subtracting that from the grand mean reaction time, would that equal <span class="math inline">\(U_{0i}\)</span> ?</p>
</section>
<section id="complete-partial-and-no-pooling" class="level2">
<h2 class="anchored" data-anchor-id="complete-partial-and-no-pooling">Complete, partial and no pooling</h2>
<ul>
<li><p>Complete assumes everyone is the same, with <span class="math inline">\(U_{0i}\)</span> being zero for everyone.</p></li>
<li><p>No pooling is if we calculate every person’s effect with a regression, subtracting out he grand mean average.</p></li>
<li><p>Partial pooling is in the middle, a weighted average between the two. For those with fewer trials there is less information for a particular individual, thus the complete pooling estimate will be given more weight. If someone has a lot of data, there weighted average is closer to no pooling.</p></li>
<li><p>Partial pooling prevents both over and under fitting of your data, leading to increased out of sample predictions.</p></li>
</ul>
</section>
<section id="complete-pooling" class="level2">
<h2 class="anchored" data-anchor-id="complete-pooling">Complete pooling</h2>
<p>Ignores any dependency. Doesn’t learn from others, assumes everyone is the same. Underfits the model.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mlm, <span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> SMN7)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>) <span class="sc">+</span><span class="fu">ylab</span>(<span class="st">"test score"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"study"</span>) <span class="sc">+</span>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 9 rows containing non-finite values (`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 9 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="no-pooling" class="level2">
<h2 class="anchored" data-anchor-id="no-pooling">No Pooling</h2>
<p>Everyone is unqiue and we cannot learn from others. Leads to overfitting</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mlm, <span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> SMN7, <span class="at">group =</span> ID)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">facet_wrap</span>( <span class="sc">~</span> ID) <span class="sc">+</span><span class="fu">ylab</span>(<span class="st">"test score"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"study"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 9 rows containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 9 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="partial-pooling-aka-shrinkage-aka-regularization" class="level2">
<h2 class="anchored" data-anchor-id="partial-pooling-aka-shrinkage-aka-regularization">Partial pooling aka shrinkage aka regularization</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: viridisLite</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mlm, <span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> SMN7, <span class="at">group =</span> ID, <span class="at">colour =</span> ID)) <span class="sc">+</span> <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span><span class="fu">scale_color_viridis</span>()<span class="sc">+</span>  <span class="fu">ylab</span>(<span class="st">"test score"</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"study amount"</span>) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 9 rows containing non-finite values (`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 9 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>Partial pooling aka shrinkage provides the optimal amount of learning from others. Assumes people come from the same distribution but are distinct from one another.</p>
<p>If you have a little data, then the safe bet is to look at the average. If you have a lot of data, you can ignore others.</p>
<p>In a way, this is similar to Bayesian reasoning where learning is based on how much information you have about a person with other people serving as a prior.</p>
</section>
<section id="parameters-that-depend-on-other-parameters" class="level2">
<h2 class="anchored" data-anchor-id="parameters-that-depend-on-other-parameters">6. Parameters that depend on other parameters</h2>
<p><span class="math display">\[\text{y}_{ij}  \sim \operatorname{Normal}(\mu_i, \sigma)\]</span> <span class="math display">\[\mu_i  = \beta_{0[j]}\]</span></p>
<p><span class="math display">\[\beta_{0[j]} \sim \operatorname{Normal}({\bar \mu},  \sigma_0)\]</span> <span class="math display">\[{\bar \mu}  \sim {\operatorname{Normal}(0, 1.5)}\]</span> <span class="math display">\[\sigma_0 \sim {\operatorname{Exponential}(1)}\]</span> <span class="math display">\[\sigma \sim {\operatorname{Exponential}(1)}\]</span></p>
</section>
<section id="hyperprior" class="level2">
<h2 class="anchored" data-anchor-id="hyperprior">Hyperprior</h2>
<p>We now have a prior for the population of effects. We typically put a prior directly on parameters. Here, because are using a multilevel model, we are interested in the population of intercepts, not just a single intercept.</p>
<p>Intercept in simple regression –&gt; a (prior/posterior) distribution of possible scores</p>
<p>Intercept in mlm –&gt; a distribution of group/clusters of intercepts. The population we are sampling from can have a distribution (mu, sigma), and that distribution is different from the observed distribution of mu (or sigma)</p>
</section>
<section id="parameters-that-depend-on-parameters" class="level2">
<h2 class="anchored" data-anchor-id="parameters-that-depend-on-parameters">Parameters that depend on parameters</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># normal density</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(beyonce)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>bp <span class="ot">&lt;-</span> <span class="fu">beyonce_palette</span>(<span class="dv">128</span>, <span class="at">n =</span> <span class="dv">9</span>, <span class="at">type =</span> <span class="st">"continuous"</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">to =</span> <span class="dv">3</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> (<span class="fu">dnorm</span>(x)) <span class="sc">/</span> <span class="fu">max</span>(<span class="fu">dnorm</span>(x)))) <span class="sc">+</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> bp[<span class="dv">6</span>], <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> .<span class="dv">2</span>,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"normal"</span>,</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">y =</span> .<span class="dv">6</span>,</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"italic(M)[0]"</span>, <span class="st">"italic(S)[0]"</span>), </span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>], <span class="at">family =</span> <span class="st">"Times"</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">color =</span> bp[<span class="dv">1</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The `size` argument of `element_line()` is deprecated as of ggplot2 3.4.0.
ℹ Please use the `linewidth` argument instead.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># half-normal density</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">3</span>, <span class="at">by =</span> .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> (<span class="fu">dnorm</span>(x)) <span class="sc">/</span> <span class="fu">max</span>(<span class="fu">dnorm</span>(x)))) <span class="sc">+</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> bp[<span class="dv">6</span>], <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fl">1.5</span>, <span class="at">y =</span> .<span class="dv">2</span>,</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"half-normal"</span>,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fl">1.5</span>, <span class="at">y =</span> .<span class="dv">6</span>,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"0*','*~italic(S)[sigma][0]"</span>, </span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>], <span class="at">family =</span> <span class="st">"Times"</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">color =</span> bp[<span class="dv">1</span>]))</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>my_arrow <span class="ot">&lt;-</span> <span class="fu">arrow</span>(<span class="at">angle =</span> <span class="dv">20</span>, <span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.35</span>, <span class="st">"cm"</span>), <span class="at">type =</span> <span class="st">"closed"</span>)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a><span class="co"># a second normal density</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">to =</span> <span class="dv">3</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> (<span class="fu">dnorm</span>(x)) <span class="sc">/</span> <span class="fu">max</span>(<span class="fu">dnorm</span>(x)))) <span class="sc">+</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> bp[<span class="dv">6</span>], <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> .<span class="dv">2</span>,</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"normal"</span>,</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">y =</span> .<span class="dv">6</span>,</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"italic(M)[1]"</span>, <span class="st">"italic(S)[1]"</span>), </span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>], <span class="at">family =</span> <span class="st">"Times"</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">color =</span> bp[<span class="dv">1</span>]))</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a><span class="co"># a second half-normal density</span></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">3</span>, <span class="at">by =</span> .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> (<span class="fu">dnorm</span>(x)) <span class="sc">/</span> <span class="fu">max</span>(<span class="fu">dnorm</span>(x)))) <span class="sc">+</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> bp[<span class="dv">6</span>], <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fl">1.5</span>, <span class="at">y =</span> .<span class="dv">2</span>,</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"half-normal"</span>,</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fl">1.5</span>, <span class="at">y =</span> .<span class="dv">6</span>,</span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"0*','*~italic(S)[sigma][1]"</span>, </span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>], <span class="at">family =</span> <span class="st">"Times"</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">color =</span> bp[<span class="dv">1</span>]))</span>
<span id="cb31-54"><a href="#cb31-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-55"><a href="#cb31-55" aria-hidden="true" tabindex="-1"></a><span class="co"># four annotated arrows</span></span>
<span id="cb31-56"><a href="#cb31-56" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span></span>
<span id="cb31-57"><a href="#cb31-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x    =</span> <span class="fu">c</span>(.<span class="dv">05</span>, .<span class="dv">35</span>, .<span class="dv">65</span>, .<span class="dv">95</span>),</span>
<span id="cb31-58"><a href="#cb31-58" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb31-59"><a href="#cb31-59" aria-hidden="true" tabindex="-1"></a>         <span class="at">xend =</span> <span class="fu">c</span>(.<span class="dv">32</span>, .<span class="dv">4</span>, .<span class="dv">65</span>, .<span class="dv">72</span>),</span>
<span id="cb31-60"><a href="#cb31-60" aria-hidden="true" tabindex="-1"></a>         <span class="at">yend =</span> <span class="fu">c</span>(.<span class="dv">2</span>, .<span class="dv">2</span>, .<span class="dv">2</span>, .<span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-61"><a href="#cb31-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-62"><a href="#cb31-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend,</span>
<span id="cb31-63"><a href="#cb31-63" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> y, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb31-64"><a href="#cb31-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">arrow =</span> my_arrow, <span class="at">color =</span> bp[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb31-65"><a href="#cb31-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-66"><a href="#cb31-66" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">c</span>(.<span class="dv">15</span>, .<span class="dv">35</span>, .<span class="dv">625</span>, .<span class="dv">78</span>), <span class="at">y =</span> .<span class="dv">55</span>,</span>
<span id="cb31-67"><a href="#cb31-67" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"'~'"</span>,</span>
<span id="cb31-68"><a href="#cb31-68" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">10</span>, <span class="at">color =</span> bp[<span class="dv">1</span>], <span class="at">family =</span> <span class="st">"Times"</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb31-69"><a href="#cb31-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb31-70"><a href="#cb31-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb31-71"><a href="#cb31-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-72"><a href="#cb31-72" aria-hidden="true" tabindex="-1"></a><span class="co"># third normal density</span></span>
<span id="cb31-73"><a href="#cb31-73" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span></span>
<span id="cb31-74"><a href="#cb31-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">to =</span> <span class="dv">3</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-75"><a href="#cb31-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> (<span class="fu">dnorm</span>(x)) <span class="sc">/</span> <span class="fu">max</span>(<span class="fu">dnorm</span>(x)))) <span class="sc">+</span></span>
<span id="cb31-76"><a href="#cb31-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> bp[<span class="dv">6</span>], <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb31-77"><a href="#cb31-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-78"><a href="#cb31-78" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> .<span class="dv">2</span>,</span>
<span id="cb31-79"><a href="#cb31-79" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"normal"</span>,</span>
<span id="cb31-80"><a href="#cb31-80" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb31-81"><a href="#cb31-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-82"><a href="#cb31-82" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">y =</span> .<span class="dv">6</span>,</span>
<span id="cb31-83"><a href="#cb31-83" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"mu[0]"</span>, <span class="st">"sigma[0]"</span>), </span>
<span id="cb31-84"><a href="#cb31-84" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>], <span class="at">family =</span> <span class="st">"Times"</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb31-85"><a href="#cb31-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb31-86"><a href="#cb31-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb31-87"><a href="#cb31-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">color =</span> bp[<span class="dv">1</span>]))</span>
<span id="cb31-88"><a href="#cb31-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-89"><a href="#cb31-89" aria-hidden="true" tabindex="-1"></a><span class="co"># fourth normal density</span></span>
<span id="cb31-90"><a href="#cb31-90" aria-hidden="true" tabindex="-1"></a>p7 <span class="ot">&lt;-</span></span>
<span id="cb31-91"><a href="#cb31-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">to =</span> <span class="dv">3</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-92"><a href="#cb31-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> (<span class="fu">dnorm</span>(x)) <span class="sc">/</span> <span class="fu">max</span>(<span class="fu">dnorm</span>(x)))) <span class="sc">+</span></span>
<span id="cb31-93"><a href="#cb31-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> bp[<span class="dv">6</span>], <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb31-94"><a href="#cb31-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-95"><a href="#cb31-95" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> .<span class="dv">2</span>,</span>
<span id="cb31-96"><a href="#cb31-96" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"normal"</span>,</span>
<span id="cb31-97"><a href="#cb31-97" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb31-98"><a href="#cb31-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-99"><a href="#cb31-99" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">y =</span> .<span class="dv">6</span>,</span>
<span id="cb31-100"><a href="#cb31-100" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"mu[1]"</span>, <span class="st">"sigma[1]"</span>), </span>
<span id="cb31-101"><a href="#cb31-101" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>], <span class="at">family =</span> <span class="st">"Times"</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb31-102"><a href="#cb31-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb31-103"><a href="#cb31-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb31-104"><a href="#cb31-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">color =</span> bp[<span class="dv">1</span>]))</span>
<span id="cb31-105"><a href="#cb31-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-106"><a href="#cb31-106" aria-hidden="true" tabindex="-1"></a><span class="co"># two annotated arrows</span></span>
<span id="cb31-107"><a href="#cb31-107" aria-hidden="true" tabindex="-1"></a>p8 <span class="ot">&lt;-</span></span>
<span id="cb31-108"><a href="#cb31-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x    =</span> <span class="fu">c</span>(.<span class="dv">18</span>, .<span class="dv">82</span>),</span>
<span id="cb31-109"><a href="#cb31-109" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb31-110"><a href="#cb31-110" aria-hidden="true" tabindex="-1"></a>         <span class="at">xend =</span> <span class="fu">c</span>(.<span class="dv">36</span>, .<span class="dv">55</span>),</span>
<span id="cb31-111"><a href="#cb31-111" aria-hidden="true" tabindex="-1"></a>         <span class="at">yend =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-112"><a href="#cb31-112" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-113"><a href="#cb31-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend,</span>
<span id="cb31-114"><a href="#cb31-114" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> y, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb31-115"><a href="#cb31-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">arrow =</span> my_arrow, <span class="at">color =</span> bp[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb31-116"><a href="#cb31-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-117"><a href="#cb31-117" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">c</span>(.<span class="dv">18</span>, .<span class="dv">33</span>, .<span class="dv">64</span>, .<span class="dv">77</span>), <span class="at">y =</span> .<span class="dv">55</span>,</span>
<span id="cb31-118"><a href="#cb31-118" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"'~'"</span>, <span class="st">"italic(j)"</span>, <span class="st">"'~'"</span>, <span class="st">"italic(j)"</span>),</span>
<span id="cb31-119"><a href="#cb31-119" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">7</span>), </span>
<span id="cb31-120"><a href="#cb31-120" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> bp[<span class="dv">1</span>], <span class="at">family =</span> <span class="st">"Times"</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb31-121"><a href="#cb31-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb31-122"><a href="#cb31-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb31-123"><a href="#cb31-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-124"><a href="#cb31-124" aria-hidden="true" tabindex="-1"></a><span class="co"># exponential density</span></span>
<span id="cb31-125"><a href="#cb31-125" aria-hidden="true" tabindex="-1"></a>p9 <span class="ot">&lt;-</span></span>
<span id="cb31-126"><a href="#cb31-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-127"><a href="#cb31-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> (<span class="fu">dexp</span>(x, <span class="dv">2</span>) <span class="sc">/</span> <span class="fu">max</span>(<span class="fu">dexp</span>(x, <span class="dv">2</span>))))) <span class="sc">+</span></span>
<span id="cb31-128"><a href="#cb31-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> bp[<span class="dv">6</span>], <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb31-129"><a href="#cb31-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-130"><a href="#cb31-130" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> .<span class="dv">5</span>, <span class="at">y =</span> .<span class="dv">2</span>,</span>
<span id="cb31-131"><a href="#cb31-131" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"exp"</span>,</span>
<span id="cb31-132"><a href="#cb31-132" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb31-133"><a href="#cb31-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-134"><a href="#cb31-134" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> .<span class="dv">5</span>, <span class="at">y =</span> .<span class="dv">6</span>,</span>
<span id="cb31-135"><a href="#cb31-135" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"italic(K)"</span>,</span>
<span id="cb31-136"><a href="#cb31-136" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>], <span class="at">family =</span> <span class="st">"Times"</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb31-137"><a href="#cb31-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb31-138"><a href="#cb31-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb31-139"><a href="#cb31-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">color =</span> bp[<span class="dv">1</span>]))</span>
<span id="cb31-140"><a href="#cb31-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-141"><a href="#cb31-141" aria-hidden="true" tabindex="-1"></a><span class="co"># likelihood formula</span></span>
<span id="cb31-142"><a href="#cb31-142" aria-hidden="true" tabindex="-1"></a>p10 <span class="ot">&lt;-</span></span>
<span id="cb31-143"><a href="#cb31-143" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> .<span class="dv">5</span>,</span>
<span id="cb31-144"><a href="#cb31-144" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> .<span class="dv">25</span>,</span>
<span id="cb31-145"><a href="#cb31-145" aria-hidden="true" tabindex="-1"></a>         <span class="at">label =</span> <span class="st">"beta[0][italic(j)]+beta[1][italic(j)]*italic(x)[italic(i)*'|'*italic(j)]"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-146"><a href="#cb31-146" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-147"><a href="#cb31-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb31-148"><a href="#cb31-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>], <span class="at">parse =</span> T, <span class="at">family =</span> <span class="st">"Times"</span>) <span class="sc">+</span></span>
<span id="cb31-149"><a href="#cb31-149" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb31-150"><a href="#cb31-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb31-151"><a href="#cb31-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb31-152"><a href="#cb31-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-153"><a href="#cb31-153" aria-hidden="true" tabindex="-1"></a><span class="co"># half-normal density</span></span>
<span id="cb31-154"><a href="#cb31-154" aria-hidden="true" tabindex="-1"></a>p11 <span class="ot">&lt;-</span></span>
<span id="cb31-155"><a href="#cb31-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">3</span>, <span class="at">by =</span> .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-156"><a href="#cb31-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> (<span class="fu">dnorm</span>(x)) <span class="sc">/</span> <span class="fu">max</span>(<span class="fu">dnorm</span>(x)))) <span class="sc">+</span></span>
<span id="cb31-157"><a href="#cb31-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> bp[<span class="dv">6</span>], <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb31-158"><a href="#cb31-158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-159"><a href="#cb31-159" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fl">1.5</span>, <span class="at">y =</span> .<span class="dv">2</span>,</span>
<span id="cb31-160"><a href="#cb31-160" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"half-normal"</span>,</span>
<span id="cb31-161"><a href="#cb31-161" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb31-162"><a href="#cb31-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-163"><a href="#cb31-163" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fl">1.5</span>, <span class="at">y =</span> .<span class="dv">6</span>,</span>
<span id="cb31-164"><a href="#cb31-164" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"0*','*~italic(S)[sigma]"</span>, </span>
<span id="cb31-165"><a href="#cb31-165" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>], <span class="at">family =</span> <span class="st">"Times"</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb31-166"><a href="#cb31-166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb31-167"><a href="#cb31-167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb31-168"><a href="#cb31-168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">color =</span> bp[<span class="dv">1</span>]))</span>
<span id="cb31-169"><a href="#cb31-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-170"><a href="#cb31-170" aria-hidden="true" tabindex="-1"></a><span class="co"># four annotated arrows</span></span>
<span id="cb31-171"><a href="#cb31-171" aria-hidden="true" tabindex="-1"></a>p12 <span class="ot">&lt;-</span></span>
<span id="cb31-172"><a href="#cb31-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x    =</span> <span class="fu">c</span>(.<span class="dv">43</span>, .<span class="dv">43</span>, <span class="fl">1.5</span>, <span class="fl">2.5</span>),</span>
<span id="cb31-173"><a href="#cb31-173" aria-hidden="true" tabindex="-1"></a>         <span class="at">y    =</span> <span class="fu">c</span>(<span class="dv">1</span>, .<span class="dv">55</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb31-174"><a href="#cb31-174" aria-hidden="true" tabindex="-1"></a>         <span class="at">xend =</span> <span class="fu">c</span>(.<span class="dv">43</span>, <span class="fl">1.225</span>, <span class="fl">1.5</span>, <span class="fl">1.75</span>),</span>
<span id="cb31-175"><a href="#cb31-175" aria-hidden="true" tabindex="-1"></a>         <span class="at">yend =</span> <span class="fu">c</span>(.<span class="dv">8</span>, .<span class="dv">15</span>, .<span class="dv">2</span>, .<span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-176"><a href="#cb31-176" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-177"><a href="#cb31-177" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend,</span>
<span id="cb31-178"><a href="#cb31-178" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> y, <span class="at">yend =</span> yend)) <span class="sc">+</span></span>
<span id="cb31-179"><a href="#cb31-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">arrow =</span> my_arrow, <span class="at">color =</span> bp[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb31-180"><a href="#cb31-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-181"><a href="#cb31-181" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">c</span>(.<span class="dv">3</span>, .<span class="dv">7</span>, <span class="fl">1.38</span>, <span class="dv">2</span>), <span class="at">y =</span> <span class="fu">c</span>(.<span class="dv">92</span>, .<span class="dv">22</span>, .<span class="dv">65</span>, .<span class="dv">6</span>),</span>
<span id="cb31-182"><a href="#cb31-182" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"'~'"</span>, <span class="st">"'='"</span>, <span class="st">"'='"</span>, <span class="st">"'~'"</span>),</span>
<span id="cb31-183"><a href="#cb31-183" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">10</span>, </span>
<span id="cb31-184"><a href="#cb31-184" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> bp[<span class="dv">1</span>], <span class="at">family =</span> <span class="st">"Times"</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb31-185"><a href="#cb31-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-186"><a href="#cb31-186" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> .<span class="dv">43</span>, <span class="at">y =</span> .<span class="dv">7</span>,</span>
<span id="cb31-187"><a href="#cb31-187" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"nu*minute+1"</span>,</span>
<span id="cb31-188"><a href="#cb31-188" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>], <span class="at">family =</span> <span class="st">"Times"</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb31-189"><a href="#cb31-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb31-190"><a href="#cb31-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb31-191"><a href="#cb31-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-192"><a href="#cb31-192" aria-hidden="true" tabindex="-1"></a><span class="co"># student-t density</span></span>
<span id="cb31-193"><a href="#cb31-193" aria-hidden="true" tabindex="-1"></a>p13 <span class="ot">&lt;-</span></span>
<span id="cb31-194"><a href="#cb31-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">to =</span> <span class="dv">3</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-195"><a href="#cb31-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> (<span class="fu">dt</span>(x, <span class="dv">3</span>) <span class="sc">/</span> <span class="fu">max</span>(<span class="fu">dt</span>(x, <span class="dv">3</span>))))) <span class="sc">+</span></span>
<span id="cb31-196"><a href="#cb31-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">fill =</span> bp[<span class="dv">6</span>], <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb31-197"><a href="#cb31-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-198"><a href="#cb31-198" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> .<span class="dv">2</span>,</span>
<span id="cb31-199"><a href="#cb31-199" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"student t"</span>,</span>
<span id="cb31-200"><a href="#cb31-200" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb31-201"><a href="#cb31-201" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb31-202"><a href="#cb31-202" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> .<span class="dv">6</span>,</span>
<span id="cb31-203"><a href="#cb31-203" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"nu~~mu[italic(i)*'|'*italic(j)]~~sigma"</span>,</span>
<span id="cb31-204"><a href="#cb31-204" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>], <span class="at">family =</span> <span class="st">"Times"</span>, <span class="at">parse =</span> T) <span class="sc">+</span></span>
<span id="cb31-205"><a href="#cb31-205" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb31-206"><a href="#cb31-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb31-207"><a href="#cb31-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.line.x =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">color =</span> bp[<span class="dv">1</span>]))</span>
<span id="cb31-208"><a href="#cb31-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-209"><a href="#cb31-209" aria-hidden="true" tabindex="-1"></a><span class="co"># the final annotated arrow</span></span>
<span id="cb31-210"><a href="#cb31-210" aria-hidden="true" tabindex="-1"></a>p14 <span class="ot">&lt;-</span></span>
<span id="cb31-211"><a href="#cb31-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x     =</span> <span class="fu">c</span>(.<span class="dv">375</span>, .<span class="dv">625</span>),</span>
<span id="cb31-212"><a href="#cb31-212" aria-hidden="true" tabindex="-1"></a>         <span class="at">y     =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>),</span>
<span id="cb31-213"><a href="#cb31-213" aria-hidden="true" tabindex="-1"></a>         <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"'~'"</span>, <span class="st">"italic(i)*'|'*italic(j)"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-214"><a href="#cb31-214" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-215"><a href="#cb31-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb31-216"><a href="#cb31-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">size =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">7</span>), <span class="at">color =</span> bp[<span class="dv">1</span>], <span class="at">parse =</span> T, <span class="at">family =</span> <span class="st">"Times"</span>) <span class="sc">+</span></span>
<span id="cb31-217"><a href="#cb31-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> .<span class="dv">5</span>, <span class="at">xend =</span> .<span class="dv">5</span>,</span>
<span id="cb31-218"><a href="#cb31-218" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="dv">1</span>, <span class="at">yend =</span> <span class="dv">0</span>, </span>
<span id="cb31-219"><a href="#cb31-219" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> bp[<span class="dv">1</span>], <span class="at">arrow =</span> my_arrow) <span class="sc">+</span></span>
<span id="cb31-220"><a href="#cb31-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb31-221"><a href="#cb31-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb31-222"><a href="#cb31-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-223"><a href="#cb31-223" aria-hidden="true" tabindex="-1"></a><span class="co"># some text</span></span>
<span id="cb31-224"><a href="#cb31-224" aria-hidden="true" tabindex="-1"></a>p15 <span class="ot">&lt;-</span></span>
<span id="cb31-225"><a href="#cb31-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x     =</span> .<span class="dv">5</span>,</span>
<span id="cb31-226"><a href="#cb31-226" aria-hidden="true" tabindex="-1"></a>         <span class="at">y     =</span> .<span class="dv">5</span>,</span>
<span id="cb31-227"><a href="#cb31-227" aria-hidden="true" tabindex="-1"></a>         <span class="at">label =</span> <span class="st">"italic(y)[italic(i)*'|'*italic(j)]"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-228"><a href="#cb31-228" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-229"><a href="#cb31-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label)) <span class="sc">+</span></span>
<span id="cb31-230"><a href="#cb31-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">color =</span> bp[<span class="dv">1</span>], <span class="at">parse =</span> T, <span class="at">family =</span> <span class="st">"Times"</span>) <span class="sc">+</span></span>
<span id="cb31-231"><a href="#cb31-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb31-232"><a href="#cb31-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb31-233"><a href="#cb31-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-234"><a href="#cb31-234" aria-hidden="true" tabindex="-1"></a><span class="co"># define the layout</span></span>
<span id="cb31-235"><a href="#cb31-235" aria-hidden="true" tabindex="-1"></a>layout <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb31-236"><a href="#cb31-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">r =</span> <span class="dv">3</span>),</span>
<span id="cb31-237"><a href="#cb31-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">l =</span> <span class="dv">5</span>, <span class="at">r =</span> <span class="dv">7</span>),</span>
<span id="cb31-238"><a href="#cb31-238" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">l =</span> <span class="dv">9</span>, <span class="at">r =</span> <span class="dv">11</span>),</span>
<span id="cb31-239"><a href="#cb31-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">l =</span> <span class="dv">13</span>, <span class="at">r =</span> <span class="dv">15</span>),</span>
<span id="cb31-240"><a href="#cb31-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">4</span>, <span class="at">b =</span> <span class="dv">5</span>, <span class="at">l =</span> <span class="dv">5</span>, <span class="at">r =</span> <span class="dv">7</span>),</span>
<span id="cb31-241"><a href="#cb31-241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">4</span>, <span class="at">b =</span> <span class="dv">5</span>, <span class="at">l =</span> <span class="dv">9</span>, <span class="at">r =</span> <span class="dv">11</span>),</span>
<span id="cb31-242"><a href="#cb31-242" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">3</span>, <span class="at">b =</span> <span class="dv">4</span>, <span class="at">l =</span> <span class="dv">1</span>, <span class="at">r =</span> <span class="dv">15</span>),</span>
<span id="cb31-243"><a href="#cb31-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">7</span>, <span class="at">b =</span> <span class="dv">8</span>, <span class="at">l =</span> <span class="dv">3</span>, <span class="at">r =</span> <span class="dv">5</span>),</span>
<span id="cb31-244"><a href="#cb31-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">7</span>, <span class="at">b =</span> <span class="dv">8</span>, <span class="at">l =</span> <span class="dv">7</span>, <span class="at">r =</span> <span class="dv">9</span>),</span>
<span id="cb31-245"><a href="#cb31-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">7</span>, <span class="at">b =</span> <span class="dv">8</span>, <span class="at">l =</span> <span class="dv">11</span>, <span class="at">r =</span> <span class="dv">13</span>),</span>
<span id="cb31-246"><a href="#cb31-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">6</span>, <span class="at">b =</span> <span class="dv">7</span>, <span class="at">l =</span> <span class="dv">5</span>, <span class="at">r =</span> <span class="dv">11</span>),</span>
<span id="cb31-247"><a href="#cb31-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">10</span>, <span class="at">b =</span> <span class="dv">11</span>, <span class="at">l =</span> <span class="dv">7</span>, <span class="at">r =</span> <span class="dv">9</span>),</span>
<span id="cb31-248"><a href="#cb31-248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">9</span>, <span class="at">b =</span> <span class="dv">10</span>, <span class="at">l =</span> <span class="dv">3</span>, <span class="at">r =</span> <span class="dv">13</span>),</span>
<span id="cb31-249"><a href="#cb31-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">12</span>, <span class="at">b =</span> <span class="dv">12</span>, <span class="at">l =</span> <span class="dv">7</span>, <span class="at">r =</span> <span class="dv">9</span>),</span>
<span id="cb31-250"><a href="#cb31-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">area</span>(<span class="at">t =</span> <span class="dv">13</span>, <span class="at">b =</span> <span class="dv">13</span>, <span class="at">l =</span> <span class="dv">7</span>, <span class="at">r =</span> <span class="dv">9</span>)</span>
<span id="cb31-251"><a href="#cb31-251" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-252"><a href="#cb31-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-253"><a href="#cb31-253" aria-hidden="true" tabindex="-1"></a><span class="co"># combine and plot!</span></span>
<span id="cb31-254"><a href="#cb31-254" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span> p4 <span class="sc">+</span> p6 <span class="sc">+</span> p7 <span class="sc">+</span> p5 <span class="sc">+</span> p9 <span class="sc">+</span> p10 <span class="sc">+</span> p11 <span class="sc">+</span> p8 <span class="sc">+</span> p13 <span class="sc">+</span> p12 <span class="sc">+</span> p14 <span class="sc">+</span> p15) <span class="sc">+</span> </span>
<span id="cb31-255"><a href="#cb31-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">design =</span> layout) <span class="sc">&amp;</span></span>
<span id="cb31-256"><a href="#cb31-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">&amp;</span></span>
<span id="cb31-257"><a href="#cb31-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">0</span>, <span class="fl">5.5</span>, <span class="dv">0</span>, <span class="fl">5.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for y is already present.
Adding another scale for y, which will replace the existing scale.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>If we are estimating a mean, we can divide that up into two priors:</p>
<ol type="1">
<li><p>A distribution of our best guess at the mean e.g., N(3,.5) means I am very confident in my guess vs N(3,50). This is all about the mean.</p></li>
<li><p>A distribution that represents the spread around that mean e.g., N(0,1) suggests small spread vs (0,100) suggest people may differ a lot (Even though the distribution has the same mean).</p></li>
</ol>
<p>Fixed effect describes #1 whereas random effects describe #2</p>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Rcpp</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading 'brms' package (version 2.20.1). Useful instructions
can be found by typing help('brms'). A more detailed introduction
to the package is available through vignette('brms_overview').</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'brms'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:tidybayes':

    dstudent_t, pstudent_t, qstudent_t, rstudent_t</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    ar</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.1</span> <span class="ot">&lt;-</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">family =</span> gaussian,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>      CON <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID),</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> sd), </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">5000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">sample_prior =</span> <span class="st">"yes"</span>,</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> mlm, </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">"cmdstanr"</span>,</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">"mlm.1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you think about parameters you are estimating the number of priors are simple. But in terms of what those priors represent, they are providing a prior on a prior. The intercept and the SD are both providing estimates of means. We could model this 1 parameter (anova or index coded) or 2 (mlm)</p>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mlm<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: CON ~ 1 + (1 | ID) 
   Data: mlm (Number of observations: 225) 
  Draws: 4 chains, each with iter = 5000; warmup = 1000; thin = 1;
         total post-warmup draws = 16000

Group-Level Effects: 
~ID (Number of levels: 91) 
              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)     0.06      0.01     0.05     0.07 1.00     5431     8578

Population-Level Effects: 
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     0.19      0.01     0.18     0.20 1.00     7203    10549

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.05      0.00     0.04     0.05 1.00     9902    11403

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<hr>
<p>Notice we have one less parameter we are estimating.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.2</span> <span class="ot">&lt;-</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">family =</span> gaussian,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>      CON <span class="sc">~</span> <span class="dv">1</span> ,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">5000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">sample_prior =</span> <span class="st">"yes"</span>,</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> mlm, </span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">"cmdstanr"</span>,</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">"mlm.2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mlm<span class="fl">.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: CON ~ 1 
   Data: mlm (Number of observations: 225) 
  Draws: 4 chains, each with iter = 5000; warmup = 1000; thin = 1;
         total post-warmup draws = 16000

Population-Level Effects: 
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     0.19      0.00     0.18     0.20 1.00    16615    11267

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.07      0.00     0.07     0.08 1.00    10474     9132

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(mlm<span class="fl">.1</span>, <span class="st">"loo"</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.2</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(mlm<span class="fl">.2</span>, <span class="st">"loo"</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(mlm<span class="fl">.1</span>, mlm<span class="fl">.2</span>, <span class="at">criterion =</span> <span class="st">"loo"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      elpd_diff se_diff
mlm.1   0.0       0.0  
mlm.2 -58.1       8.8  </code></pre>
</div>
</div>
<hr>
<ul>
<li><p>Notice how the intercept is the same in each of these models. Even the CIs. Conceptually they are different though. The intercept is directly modeled in the standard regression. In the MLM it is better thought of as the map of the distribution of random effects.</p></li>
<li><p>The population is larger than what we have. This is true for almost anything we do. We sample paradigms, we sample people, we usually never have a full population under our study. Don’t we want to model that variation?</p></li>
</ul>
<hr>
<p><span class="math display">\[\text{y}_{ij}  \sim \operatorname{Normal}(\mu_i, \sigma)\]</span> <span class="math display">\[\mu_i  = \beta_{0[j]}\]</span> This parenthesis indicates we have varying intercepts that vary over individual j. Each parameter estimated needs a prior. <span class="math display">\[\beta_{0[j]} \sim \operatorname{Normal}({\bar \mu},  \sigma_0)\]</span> <span class="math display">\[{\bar \mu}  \sim {\operatorname{Normal}(0, 1.5)}\]</span> <span class="math display">\[\sigma_0 \sim {\operatorname{Exponential}(1)}\]</span> <span class="math display">\[\sigma \sim {\operatorname{Exponential}(1)}\]</span></p>
</section>
<section id="parameters-that-depend-on-parameters-1" class="level2">
<h2 class="anchored" data-anchor-id="parameters-that-depend-on-parameters-1">Parameters that depend on parameters</h2>
<div class="cell">
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>With mlm we treated means as coming from a population of means. And thus there was a best guess of the mean (intercept) and variation around that guess (SD). With anova we ignored the variation. But we could, in bayes, still examine that variation. Lets fit an index model, where each person gets a mean.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="sc">$</span>ID.f <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(mlm<span class="sc">$</span>ID)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>mlm.id <span class="ot">&lt;-</span> </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">family =</span> gaussian,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>      CON <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> ID.f ,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">2</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> mlm, </span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">"cmdstanr"</span>,</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">"mlm.id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>This is similar to a “fixed effect” model, something that is popular in econometrics. It, in contrast to the random effect model, does not model random effects.</p>
<p>Why do we want to model random effects? Variance decomposition which leads to increased power.</p>
<p>Also, 1. we can include group/cluster level predictors, which fixed effect cannot. 2. it makes an assumption about whether the clusters are random or not. Psych they are almost always random (people, site, orgs) whereas for econometrics they aren’t (country, state).</p>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mlm.id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: CON ~ 0 + ID.f 
   Data: mlm (Number of observations: 225) 
  Draws: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;
         total post-warmup draws = 6000

Population-Level Effects: 
        Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
ID.f6       0.19      0.03     0.14     0.24 1.00    12843     4563
ID.f29      0.12      0.03     0.06     0.19 1.00    12890     4381
ID.f34      0.11      0.03     0.04     0.17 1.00    11125     3396
ID.f36      0.16      0.03     0.09     0.22 1.00    10520     4353
ID.f37      0.19      0.03     0.13     0.24 1.00    13971     4513
ID.f48      0.22      0.03     0.16     0.28 1.00    11877     3672
ID.f53      0.19      0.03     0.12     0.25 1.00    12973     3832
ID.f54      0.25      0.03     0.19     0.30 1.00    10693     4209
ID.f58      0.24      0.03     0.18     0.29 1.00    11734     3630
ID.f61      0.09      0.03     0.02     0.15 1.00    11095     4131
ID.f66      0.24      0.03     0.18     0.30 1.00    10702     3905
ID.f67      0.20      0.02     0.15     0.25 1.00    12121     4120
ID.f69      0.21      0.03     0.14     0.27 1.00    11762     4351
ID.f71      0.06      0.03     0.00     0.11 1.00    12658     4033
ID.f74      0.20      0.03     0.15     0.26 1.00    12824     4541
ID.f75      0.27      0.03     0.21     0.34 1.00    13089     4330
ID.f76      0.10      0.03     0.05     0.15 1.00    11192     4021
ID.f78      0.24      0.03     0.19     0.30 1.00    13957     4076
ID.f79      0.13      0.03     0.06     0.20 1.00    11956     3914
ID.f80      0.14      0.03     0.07     0.20 1.00    10268     4029
ID.f81      0.24      0.03     0.19     0.30 1.00    11554     4247
ID.f82      0.33      0.02     0.28     0.37 1.00    10263     4261
ID.f85      0.16      0.03     0.09     0.22 1.00    12539     4150
ID.f86      0.12      0.03     0.05     0.18 1.00    10475     4054
ID.f87      0.11      0.03     0.05     0.18 1.00    13807     4300
ID.f89      0.14      0.03     0.08     0.19 1.00    11419     4313
ID.f91      0.17      0.03     0.12     0.23 1.00    12721     4282
ID.f92      0.20      0.03     0.15     0.26 1.00    11862     4418
ID.f93      0.25      0.03     0.20     0.31 1.00    12602     3651
ID.f94      0.12      0.03     0.06     0.17 1.00    11041     3875
ID.f96      0.23      0.03     0.16     0.30 1.00    12876     3812
ID.f97      0.25      0.02     0.20     0.29 1.00    10826     4330
ID.f98      0.14      0.02     0.09     0.19 1.00     9621     4076
ID.f99      0.18      0.02     0.13     0.23 1.00    12074     4029
ID.f101     0.25      0.03     0.19     0.30 1.00    13398     4000
ID.f102     0.19      0.02     0.14     0.23 1.00    11928     4485
ID.f103     0.15      0.03     0.09     0.22 1.00    12408     4337
ID.f104     0.17      0.03     0.11     0.24 1.00    11784     4181
ID.f105     0.16      0.03     0.11     0.22 1.00    10588     3372
ID.f106     0.20      0.03     0.14     0.25 1.00    12531     4475
ID.f110     0.18      0.03     0.13     0.24 1.00    11621     3912
ID.f112     0.09      0.03     0.04     0.15 1.00    12749     4372
ID.f114     0.13      0.03     0.08     0.19 1.00    13131     4640
ID.f115     0.14      0.03     0.09     0.20 1.00    11539     4158
ID.f116     0.14      0.03     0.09     0.20 1.00    11704     4916
ID.f120     0.35      0.03     0.29     0.42 1.00    11116     4498
ID.f122     0.17      0.03     0.12     0.22 1.00    13135     4066
ID.f125     0.20      0.03     0.14     0.25 1.00    10812     4172
ID.f127     0.23      0.03     0.17     0.28 1.00    12523     4304
ID.f129     0.13      0.03     0.06     0.20 1.00    12336     3775
ID.f135     0.30      0.03     0.24     0.35 1.00    11249     4325
ID.f136     0.29      0.03     0.24     0.34 1.00    12910     4060
ID.f137     0.29      0.03     0.23     0.36 1.00    11799     3709
ID.f140     0.13      0.03     0.06     0.19 1.00    12368     4573
ID.f141     0.19      0.03     0.13     0.26 1.00    11270     4112
ID.f142     0.18      0.03     0.11     0.24 1.00    11910     3756
ID.f143     0.31      0.03     0.25     0.38 1.00    11943     4100
ID.f144     0.17      0.03     0.11     0.24 1.00    10872     4346
ID.f146     0.21      0.03     0.14     0.28 1.00    12834     3844
ID.f149     0.23      0.03     0.16     0.30 1.00    13499     4048
ID.f150     0.20      0.03     0.14     0.27 1.00    11754     4112
ID.f152     0.22      0.03     0.16     0.29 1.00    12196     3979
ID.f153     0.15      0.03     0.08     0.21 1.00    11960     4349
ID.f155     0.14      0.03     0.08     0.21 1.00    12799     4708
ID.f156     0.14      0.03     0.08     0.19 1.00    11804     4149
ID.f159     0.12      0.03     0.06     0.19 1.00    12160     3926
ID.f160     0.18      0.03     0.11     0.24 1.00    12500     4331
ID.f162     0.39      0.03     0.34     0.45 1.00    11956     4512
ID.f163     0.13      0.03     0.07     0.20 1.00    13493     4058
ID.f165     0.20      0.03     0.13     0.26 1.00    10433     3473
ID.f167     0.13      0.03     0.06     0.20 1.00    11378     3996
ID.f169     0.24      0.03     0.18     0.31 1.00    10844     3478
ID.f171     0.23      0.03     0.16     0.29 1.00    11715     4200
ID.f174     0.26      0.03     0.20     0.33 1.00    12807     4506
ID.f182     0.19      0.03     0.12     0.25 1.00    14151     4268
ID.f187     0.06      0.03    -0.00     0.13 1.00    11480     3807
ID.f189     0.22      0.03     0.16     0.29 1.00    10615     3896
ID.f190     0.13      0.03     0.06     0.19 1.00    11900     4110
ID.f193     0.21      0.03     0.14     0.27 1.00    11690     3406
ID.f194     0.12      0.03     0.05     0.19 1.00    11769     4036
ID.f201     0.19      0.03     0.12     0.25 1.00    12564     4307
ID.f204     0.29      0.03     0.22     0.35 1.00    11331     4479
ID.f205     0.19      0.03     0.13     0.26 1.00    12142     4243
ID.f208     0.20      0.03     0.14     0.27 1.00    11908     4093
ID.f209     0.21      0.03     0.15     0.28 1.00    12056     4303
ID.f211     0.14      0.03     0.07     0.21 1.00    12298     4843
ID.f214     0.28      0.03     0.21     0.34 1.00    11659     4294
ID.f219     0.23      0.03     0.16     0.30 1.00    13161     3850
ID.f222     0.14      0.03     0.07     0.20 1.00    11313     4140
ID.f223     0.17      0.03     0.10     0.23 1.00    12990     4250
ID.f229     0.14      0.03     0.07     0.21 1.00    11559     4131

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.05      0.00     0.04     0.05 1.00     3458     3621

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(mlm.id) <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_ID.f6<span class="sc">:</span>b_ID.f91, <span class="at">names_to=</span><span class="st">"ID"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean=</span><span class="fu">mean</span>(value), <span class="at">sd=</span><span class="fu">sd</span>(value))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
   mean     sd
  &lt;dbl&gt;  &lt;dbl&gt;
1 0.177 0.0698</code></pre>
</div>
</div>
</section>
<section id="partial-poolingshrinkage" class="level2">
<h2 class="anchored" data-anchor-id="partial-poolingshrinkage">Partial pooling/Shrinkage</h2>
<p><span class="math inline">\(\sigma_0\)</span> (our random effect) can turn on/off/adjust shrinkage.</p>
<p>Setting SD to zero says everyone is the same. Infinite SD says all groups are unrelated (no pooling). In the middle gives you partial pooling.</p>
<p>We use our prior of <span class="math inline">\(\sigma_0\)</span> plus our data to get an estimate of <span class="math inline">\(\beta_{0[j]}\)</span>. This is how we accurately partial pool.</p>
</section>
<section id="partial-poolingshrinkage-1" class="level2">
<h2 class="anchored" data-anchor-id="partial-poolingshrinkage-1">Partial pooling/Shrinkage</h2>
<p><span class="math display">\[\text{y}_{ij}  \sim \operatorname{Normal}(\mu_i, \sigma_i)\]</span></p>
<p><span class="math display">\[\mu_i  = \beta_{0[i]}\]</span></p>
<p><span class="math display">\[\beta_{0[j]} \sim \operatorname{Normal}({\bar \mu},  \sigma_0)\]</span> <span class="math display">\[{\bar \mu}  \sim {\operatorname{Normal}(0, 1.5)}\]</span></p>
<p><span class="math display">\[\sigma_0 \sim {\operatorname{Normal}(0, 1.5)}\]</span></p>
<p><span class="math display">\[\sigma \sim {\operatorname{Exponential}(1)}\]</span></p>
</section>
<section id="working-with-mlm-posterior" class="level2">
<h2 class="anchored" data-anchor-id="working-with-mlm-posterior">working with mlm posterior</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mlm<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: CON ~ 1 + (1 | ID) 
   Data: mlm (Number of observations: 225) 
  Draws: 4 chains, each with iter = 5000; warmup = 1000; thin = 1;
         total post-warmup draws = 16000

Group-Level Effects: 
~ID (Number of levels: 91) 
              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)     0.06      0.01     0.05     0.07 1.00     5431     8578

Population-Level Effects: 
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     0.19      0.01     0.18     0.20 1.00     7203    10549

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.05      0.00     0.04     0.05 1.00     9902    11403

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_variables</span>(mlm<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "b_Intercept"         "sd_ID__Intercept"    "sigma"              
  [4] "r_ID[6,Intercept]"   "r_ID[29,Intercept]"  "r_ID[34,Intercept]" 
  [7] "r_ID[36,Intercept]"  "r_ID[37,Intercept]"  "r_ID[48,Intercept]" 
 [10] "r_ID[53,Intercept]"  "r_ID[54,Intercept]"  "r_ID[58,Intercept]" 
 [13] "r_ID[61,Intercept]"  "r_ID[66,Intercept]"  "r_ID[67,Intercept]" 
 [16] "r_ID[69,Intercept]"  "r_ID[71,Intercept]"  "r_ID[74,Intercept]" 
 [19] "r_ID[75,Intercept]"  "r_ID[76,Intercept]"  "r_ID[78,Intercept]" 
 [22] "r_ID[79,Intercept]"  "r_ID[80,Intercept]"  "r_ID[81,Intercept]" 
 [25] "r_ID[82,Intercept]"  "r_ID[85,Intercept]"  "r_ID[86,Intercept]" 
 [28] "r_ID[87,Intercept]"  "r_ID[89,Intercept]"  "r_ID[91,Intercept]" 
 [31] "r_ID[92,Intercept]"  "r_ID[93,Intercept]"  "r_ID[94,Intercept]" 
 [34] "r_ID[96,Intercept]"  "r_ID[97,Intercept]"  "r_ID[98,Intercept]" 
 [37] "r_ID[99,Intercept]"  "r_ID[101,Intercept]" "r_ID[102,Intercept]"
 [40] "r_ID[103,Intercept]" "r_ID[104,Intercept]" "r_ID[105,Intercept]"
 [43] "r_ID[106,Intercept]" "r_ID[110,Intercept]" "r_ID[112,Intercept]"
 [46] "r_ID[114,Intercept]" "r_ID[115,Intercept]" "r_ID[116,Intercept]"
 [49] "r_ID[120,Intercept]" "r_ID[122,Intercept]" "r_ID[125,Intercept]"
 [52] "r_ID[127,Intercept]" "r_ID[129,Intercept]" "r_ID[135,Intercept]"
 [55] "r_ID[136,Intercept]" "r_ID[137,Intercept]" "r_ID[140,Intercept]"
 [58] "r_ID[141,Intercept]" "r_ID[142,Intercept]" "r_ID[143,Intercept]"
 [61] "r_ID[144,Intercept]" "r_ID[146,Intercept]" "r_ID[149,Intercept]"
 [64] "r_ID[150,Intercept]" "r_ID[152,Intercept]" "r_ID[153,Intercept]"
 [67] "r_ID[155,Intercept]" "r_ID[156,Intercept]" "r_ID[159,Intercept]"
 [70] "r_ID[160,Intercept]" "r_ID[162,Intercept]" "r_ID[163,Intercept]"
 [73] "r_ID[165,Intercept]" "r_ID[167,Intercept]" "r_ID[169,Intercept]"
 [76] "r_ID[171,Intercept]" "r_ID[174,Intercept]" "r_ID[182,Intercept]"
 [79] "r_ID[187,Intercept]" "r_ID[189,Intercept]" "r_ID[190,Intercept]"
 [82] "r_ID[193,Intercept]" "r_ID[194,Intercept]" "r_ID[201,Intercept]"
 [85] "r_ID[204,Intercept]" "r_ID[205,Intercept]" "r_ID[208,Intercept]"
 [88] "r_ID[209,Intercept]" "r_ID[211,Intercept]" "r_ID[214,Intercept]"
 [91] "r_ID[219,Intercept]" "r_ID[222,Intercept]" "r_ID[223,Intercept]"
 [94] "r_ID[229,Intercept]" "prior_Intercept"     "prior_sigma"        
 [97] "prior_sd_ID"         "lprior"              "lp__"               
[100] "accept_stat__"       "treedepth__"         "stepsize__"         
[103] "divergent__"         "n_leapfrog__"        "energy__"           </code></pre>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.1</span> <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(r_ID[ID, term]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,456,000 × 6
# Groups:   ID, term [91]
      ID term          r_ID .chain .iteration .draw
   &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;  &lt;int&gt;      &lt;int&gt; &lt;int&gt;
 1     6 Intercept  0.00486      1          1     1
 2     6 Intercept  0.00189      1          2     2
 3     6 Intercept  0.0203       1          3     3
 4     6 Intercept -0.0463       1          4     4
 5     6 Intercept  0.0358       1          5     5
 6     6 Intercept -0.0305       1          6     6
 7     6 Intercept  0.0108       1          7     7
 8     6 Intercept  0.00562      1          8     8
 9     6 Intercept  0.00230      1          9     9
10     6 Intercept  0.0235       1         10    10
# ℹ 1,455,990 more rows</code></pre>
</div>
</div>
<p>16000 samples (4 chains * 4k iterations) * 91 people</p>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.1</span> <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(r_ID[ID]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,456,000 × 5
# Groups:   ID [91]
      ID     r_ID .chain .iteration .draw
   &lt;int&gt;    &lt;dbl&gt;  &lt;int&gt;      &lt;int&gt; &lt;int&gt;
 1     6  0.00486      1          1     1
 2     6  0.00189      1          2     2
 3     6  0.0203       1          3     3
 4     6 -0.0463       1          4     4
 5     6  0.0358       1          5     5
 6     6 -0.0305       1          6     6
 7     6  0.0108       1          7     7
 8     6  0.00562      1          8     8
 9     6  0.00230      1          9     9
10     6  0.0235       1         10    10
# ℹ 1,455,990 more rows</code></pre>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.1</span> <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(r_ID[ID, term]) <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">median_qi</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 91 × 8
      ID term           r_ID   .lower   .upper .width .point .interval
   &lt;int&gt; &lt;chr&gt;         &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
 1     6 Intercept  0.000127 -0.0495   0.0492    0.95 median qi       
 2    29 Intercept -0.0482   -0.106    0.00947   0.95 median qi       
 3    34 Intercept -0.0614   -0.120   -0.00548   0.95 median qi       
 4    36 Intercept -0.0225   -0.0795   0.0348    0.95 median qi       
 5    37 Intercept -0.00341  -0.0522   0.0459    0.95 median qi       
 6    48 Intercept  0.0234   -0.0255   0.0728    0.95 median qi       
 7    53 Intercept  0.000252 -0.0556   0.0569    0.95 median qi       
 8    54 Intercept  0.0452   -0.00413  0.0937    0.95 median qi       
 9    58 Intercept  0.0370   -0.0125   0.0867    0.95 median qi       
10    61 Intercept -0.0743   -0.131   -0.0168    0.95 median qi       
# ℹ 81 more rows</code></pre>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.1</span> <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(r_ID[ID, term]) <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mlm <span class="sc">%&gt;%</span> <span class="fu">select</span> (ID, CON) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span>  <span class="fu">mutate</span>(<span class="at">CON =</span> <span class="fu">mean</span>(CON))) <span class="sc">%&gt;%</span> </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">median_qi</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> ID)) <span class="sc">+</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> r_ID), <span class="at">color =</span> <span class="st">"orange2"</span>) <span class="sc">+</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> CON), <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span>  </span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"orange is model based, black circles are observed means"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(ID)`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(., mlm %&gt;% select(ID, CON) %&gt;% group_by(ID) %&gt;% mutate(CON = mean(CON))): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 1 of `x` matches multiple rows in `y`.
ℹ Row 1 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>Think back to {lme4} and <code>ranef</code> <code>coef</code> and <code>fixef</code> functions.</p>
<p>What do each of these describe?</p>
<p>What scale is our random effect (typically) in?</p>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.1</span> <span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(b_Intercept, r_ID[ID, term]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,456,000 × 7
# Groups:   ID, term [91]
   .chain .iteration .draw b_Intercept    ID term          r_ID
    &lt;int&gt;      &lt;int&gt; &lt;int&gt;       &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;
 1      1          1     1       0.201     6 Intercept  0.00486
 2      1          1     1       0.201    29 Intercept -0.0310 
 3      1          1     1       0.201    34 Intercept -0.124  
 4      1          1     1       0.201    36 Intercept -0.105  
 5      1          1     1       0.201    37 Intercept -0.0349 
 6      1          1     1       0.201    48 Intercept  0.0250 
 7      1          1     1       0.201    53 Intercept -0.0462 
 8      1          1     1       0.201    54 Intercept  0.0262 
 9      1          1     1       0.201    58 Intercept -0.0356 
10      1          1     1       0.201    61 Intercept -0.0765 
# ℹ 1,455,990 more rows</code></pre>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.1</span> <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(b_Intercept, r_ID[ID, term]) <span class="sc">%&gt;%</span> </span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">person_I =</span> b_Intercept <span class="sc">+</span> r_ID) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,456,000 × 8
# Groups:   ID, term [91]
   .chain .iteration .draw b_Intercept    ID term          r_ID person_I
    &lt;int&gt;      &lt;int&gt; &lt;int&gt;       &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt;    &lt;dbl&gt;
 1      1          1     1       0.201     6 Intercept  0.00486   0.206 
 2      1          1     1       0.201    29 Intercept -0.0310    0.170 
 3      1          1     1       0.201    34 Intercept -0.124     0.0769
 4      1          1     1       0.201    36 Intercept -0.105     0.0961
 5      1          1     1       0.201    37 Intercept -0.0349    0.166 
 6      1          1     1       0.201    48 Intercept  0.0250    0.226 
 7      1          1     1       0.201    53 Intercept -0.0462    0.155 
 8      1          1     1       0.201    54 Intercept  0.0262    0.227 
 9      1          1     1       0.201    58 Intercept -0.0356    0.165 
10      1          1     1       0.201    61 Intercept -0.0765    0.124 
# ℹ 1,455,990 more rows</code></pre>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.1</span> <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(b_Intercept, r_ID[ID, term]) <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">person_I =</span> b_Intercept <span class="sc">+</span> r_ID) <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mlm <span class="sc">%&gt;%</span> <span class="fu">select</span> (ID, CON) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span>  <span class="fu">mutate</span>(<span class="at">CON =</span> <span class="fu">mean</span>(CON))) <span class="sc">%&gt;%</span> </span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">median_qi</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> ID)) <span class="sc">+</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> person_I), <span class="at">color =</span> <span class="st">"orange2"</span>) <span class="sc">+</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> CON), <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span>  </span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"orange is model based, black circles are observed means"</span>) <span class="sc">+</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span><span class="fl">0.1849846</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(ID)`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(., mlm %&gt;% select(ID, CON) %&gt;% group_by(ID) %&gt;% mutate(CON = mean(CON))): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 1 of `x` matches multiple rows in `y`.
ℹ Row 1 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.1</span> <span class="sc">%&gt;%</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(b_Intercept, r_ID[ID, term]) <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">median_qi</span>(<span class="at">person_I =</span> b_Intercept <span class="sc">+</span> r_ID) <span class="sc">%&gt;%</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>( <span class="at">y =</span> <span class="fu">reorder</span>(ID, person_I), <span class="at">x =</span> person_I, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"est"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"ID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>Set prior for random effect to almost zero for complete pooling.</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.1</span>p <span class="ot">&lt;-</span> </span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">family =</span> gaussian,</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>      CON <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID),</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, .<span class="dv">00001</span>), <span class="at">class =</span> sd), </span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">sample_prior =</span> <span class="st">"yes"</span>,</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">"mlm.1p"</span>,</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">backend =</span> <span class="st">"cmdstanr"</span>,</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> mlm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mlm<span class="fl">.1</span>p)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: CON ~ 1 + (1 | ID) 
   Data: mlm (Number of observations: 225) 
  Draws: 4 chains, each with iter = 4000; warmup = 1000; thin = 1;
         total post-warmup draws = 12000

Group-Level Effects: 
~ID (Number of levels: 91) 
              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)     0.00      0.00     0.00     0.00 1.00     9457     6383

Population-Level Effects: 
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     0.19      0.00     0.18     0.20 1.00    15396     8212

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.07      0.00     0.07     0.08 1.00    17206     8431

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.1</span>p <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(b_Intercept, r_ID[ID, term]) <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">person_I =</span> b_Intercept <span class="sc">+</span> r_ID) <span class="sc">%&gt;%</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(mlm <span class="sc">%&gt;%</span> <span class="fu">select</span> (ID, CON) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span>  <span class="fu">mutate</span>(<span class="at">CON =</span> <span class="fu">mean</span>(CON))) <span class="sc">%&gt;%</span> </span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">median_qi</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> ID)) <span class="sc">+</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> person_I), <span class="at">color =</span> <span class="st">"orange2"</span>) <span class="sc">+</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> CON), <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span>  </span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"complete pooling"</span>) <span class="sc">+</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span><span class="fl">0.189846</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(ID)`</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in left_join(., mlm %&gt;% select(ID, CON) %&gt;% group_by(ID) %&gt;% mutate(CON = mean(CON))): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 1 of `x` matches multiple rows in `y`.
ℹ Row 1 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>No pooling means you are not learning from other data, which is by default not an MLM model. We already fit this fixed effects no intercept model above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mlm.id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: CON ~ 0 + ID.f 
   Data: mlm (Number of observations: 225) 
  Draws: 2 chains, each with iter = 4000; warmup = 1000; thin = 1;
         total post-warmup draws = 6000

Population-Level Effects: 
        Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
ID.f6       0.19      0.03     0.14     0.24 1.00    12843     4563
ID.f29      0.12      0.03     0.06     0.19 1.00    12890     4381
ID.f34      0.11      0.03     0.04     0.17 1.00    11125     3396
ID.f36      0.16      0.03     0.09     0.22 1.00    10520     4353
ID.f37      0.19      0.03     0.13     0.24 1.00    13971     4513
ID.f48      0.22      0.03     0.16     0.28 1.00    11877     3672
ID.f53      0.19      0.03     0.12     0.25 1.00    12973     3832
ID.f54      0.25      0.03     0.19     0.30 1.00    10693     4209
ID.f58      0.24      0.03     0.18     0.29 1.00    11734     3630
ID.f61      0.09      0.03     0.02     0.15 1.00    11095     4131
ID.f66      0.24      0.03     0.18     0.30 1.00    10702     3905
ID.f67      0.20      0.02     0.15     0.25 1.00    12121     4120
ID.f69      0.21      0.03     0.14     0.27 1.00    11762     4351
ID.f71      0.06      0.03     0.00     0.11 1.00    12658     4033
ID.f74      0.20      0.03     0.15     0.26 1.00    12824     4541
ID.f75      0.27      0.03     0.21     0.34 1.00    13089     4330
ID.f76      0.10      0.03     0.05     0.15 1.00    11192     4021
ID.f78      0.24      0.03     0.19     0.30 1.00    13957     4076
ID.f79      0.13      0.03     0.06     0.20 1.00    11956     3914
ID.f80      0.14      0.03     0.07     0.20 1.00    10268     4029
ID.f81      0.24      0.03     0.19     0.30 1.00    11554     4247
ID.f82      0.33      0.02     0.28     0.37 1.00    10263     4261
ID.f85      0.16      0.03     0.09     0.22 1.00    12539     4150
ID.f86      0.12      0.03     0.05     0.18 1.00    10475     4054
ID.f87      0.11      0.03     0.05     0.18 1.00    13807     4300
ID.f89      0.14      0.03     0.08     0.19 1.00    11419     4313
ID.f91      0.17      0.03     0.12     0.23 1.00    12721     4282
ID.f92      0.20      0.03     0.15     0.26 1.00    11862     4418
ID.f93      0.25      0.03     0.20     0.31 1.00    12602     3651
ID.f94      0.12      0.03     0.06     0.17 1.00    11041     3875
ID.f96      0.23      0.03     0.16     0.30 1.00    12876     3812
ID.f97      0.25      0.02     0.20     0.29 1.00    10826     4330
ID.f98      0.14      0.02     0.09     0.19 1.00     9621     4076
ID.f99      0.18      0.02     0.13     0.23 1.00    12074     4029
ID.f101     0.25      0.03     0.19     0.30 1.00    13398     4000
ID.f102     0.19      0.02     0.14     0.23 1.00    11928     4485
ID.f103     0.15      0.03     0.09     0.22 1.00    12408     4337
ID.f104     0.17      0.03     0.11     0.24 1.00    11784     4181
ID.f105     0.16      0.03     0.11     0.22 1.00    10588     3372
ID.f106     0.20      0.03     0.14     0.25 1.00    12531     4475
ID.f110     0.18      0.03     0.13     0.24 1.00    11621     3912
ID.f112     0.09      0.03     0.04     0.15 1.00    12749     4372
ID.f114     0.13      0.03     0.08     0.19 1.00    13131     4640
ID.f115     0.14      0.03     0.09     0.20 1.00    11539     4158
ID.f116     0.14      0.03     0.09     0.20 1.00    11704     4916
ID.f120     0.35      0.03     0.29     0.42 1.00    11116     4498
ID.f122     0.17      0.03     0.12     0.22 1.00    13135     4066
ID.f125     0.20      0.03     0.14     0.25 1.00    10812     4172
ID.f127     0.23      0.03     0.17     0.28 1.00    12523     4304
ID.f129     0.13      0.03     0.06     0.20 1.00    12336     3775
ID.f135     0.30      0.03     0.24     0.35 1.00    11249     4325
ID.f136     0.29      0.03     0.24     0.34 1.00    12910     4060
ID.f137     0.29      0.03     0.23     0.36 1.00    11799     3709
ID.f140     0.13      0.03     0.06     0.19 1.00    12368     4573
ID.f141     0.19      0.03     0.13     0.26 1.00    11270     4112
ID.f142     0.18      0.03     0.11     0.24 1.00    11910     3756
ID.f143     0.31      0.03     0.25     0.38 1.00    11943     4100
ID.f144     0.17      0.03     0.11     0.24 1.00    10872     4346
ID.f146     0.21      0.03     0.14     0.28 1.00    12834     3844
ID.f149     0.23      0.03     0.16     0.30 1.00    13499     4048
ID.f150     0.20      0.03     0.14     0.27 1.00    11754     4112
ID.f152     0.22      0.03     0.16     0.29 1.00    12196     3979
ID.f153     0.15      0.03     0.08     0.21 1.00    11960     4349
ID.f155     0.14      0.03     0.08     0.21 1.00    12799     4708
ID.f156     0.14      0.03     0.08     0.19 1.00    11804     4149
ID.f159     0.12      0.03     0.06     0.19 1.00    12160     3926
ID.f160     0.18      0.03     0.11     0.24 1.00    12500     4331
ID.f162     0.39      0.03     0.34     0.45 1.00    11956     4512
ID.f163     0.13      0.03     0.07     0.20 1.00    13493     4058
ID.f165     0.20      0.03     0.13     0.26 1.00    10433     3473
ID.f167     0.13      0.03     0.06     0.20 1.00    11378     3996
ID.f169     0.24      0.03     0.18     0.31 1.00    10844     3478
ID.f171     0.23      0.03     0.16     0.29 1.00    11715     4200
ID.f174     0.26      0.03     0.20     0.33 1.00    12807     4506
ID.f182     0.19      0.03     0.12     0.25 1.00    14151     4268
ID.f187     0.06      0.03    -0.00     0.13 1.00    11480     3807
ID.f189     0.22      0.03     0.16     0.29 1.00    10615     3896
ID.f190     0.13      0.03     0.06     0.19 1.00    11900     4110
ID.f193     0.21      0.03     0.14     0.27 1.00    11690     3406
ID.f194     0.12      0.03     0.05     0.19 1.00    11769     4036
ID.f201     0.19      0.03     0.12     0.25 1.00    12564     4307
ID.f204     0.29      0.03     0.22     0.35 1.00    11331     4479
ID.f205     0.19      0.03     0.13     0.26 1.00    12142     4243
ID.f208     0.20      0.03     0.14     0.27 1.00    11908     4093
ID.f209     0.21      0.03     0.15     0.28 1.00    12056     4303
ID.f211     0.14      0.03     0.07     0.21 1.00    12298     4843
ID.f214     0.28      0.03     0.21     0.34 1.00    11659     4294
ID.f219     0.23      0.03     0.16     0.30 1.00    13161     3850
ID.f222     0.14      0.03     0.07     0.20 1.00    11313     4140
ID.f223     0.17      0.03     0.10     0.23 1.00    12990     4250
ID.f229     0.14      0.03     0.07     0.21 1.00    11559     4131

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.05      0.00     0.04     0.05 1.00     3458     3621

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>data2<span class="ot">&lt;-</span>mlm <span class="sc">%&gt;%</span> <span class="fu">select</span>(ID, CON) <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CON =</span> <span class="fu">mean</span>(CON)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>mlm.id <span class="sc">%&gt;%</span> <span class="fu">tidy_draws</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_ID.f6<span class="sc">:</span>b_ID.f229, <span class="at">names_to =</span> <span class="st">"ID"</span>, <span class="at">values_to =</span> <span class="st">"CON_I"</span>, <span class="at">names_prefix =</span> <span class="st">"b_ID.f"</span>, <span class="at">names_transform =</span> <span class="fu">list</span>(<span class="at">ID =</span> as.integer)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(data2) <span class="sc">%&gt;%</span> </span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span> </span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">median_qi</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> ID)) <span class="sc">+</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> CON_I), <span class="at">color =</span> <span class="st">"orange2"</span>) <span class="sc">+</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> CON), <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span>  </span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NO pooling"</span>) <span class="sc">+</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span><span class="fl">0.1849846</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(ID)`</code></pre>
</div>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>MLM will automatically create the best fitting model – balancing between over and under fitting. It identifies the value of sigma of the random effect that is ideal.</p>
<p>This “knob” can be manually turned to different values and we can look at the fit of the model via loo or wais. But we dont need to!</p>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>mlm.id <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(mlm.id, <span class="st">"loo"</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.1</span>p <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(mlm<span class="fl">.1</span>p, <span class="st">"loo"</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(mlm<span class="fl">.1</span>, <span class="st">"loo"</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(mlm.id, mlm<span class="fl">.1</span>p, mlm<span class="fl">.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       elpd_diff se_diff
mlm.1    0.0       0.0  
mlm.id -16.2       5.8  
mlm.1p -58.1       8.8  </code></pre>
</div>
</div>
</section>
<section id="level-1-predictors-1" class="level2">
<h2 class="anchored" data-anchor-id="level-1-predictors-1">level 1 predictors</h2>
<p><span class="math display">\[\text{y}_{ij}  \sim \operatorname{Normal}(\mu_i, \sigma)\]</span> <span class="math display">\[\mu_i  = \beta_{0[j]} + \beta_{1[j]}Time_{ij}\]</span></p>
<p><span class="math display">\[\beta_{0[j]} \sim \operatorname{Normal}({\bar \mu}, \sigma_0)\]</span> <span class="math display">\[{\bar \mu}  \sim {\operatorname{Normal}(0, 1.5)}\]</span> <span class="math display">\[\sigma_0 \sim {\operatorname{Exponential}(1)}\]</span> <span class="math display">\[\beta_{1[j]} \sim {\operatorname{Normal}(0, 1.5)}\]</span> <span class="math display">\[\sigma \sim {\operatorname{Exponential}(1)}\]</span></p>
<hr>
<p>Notice how the slope variable was not a hyper prior. What does that mean? That means it is not random. People can still differ, but only based on the equation we set up for it. That is, there are fixed effects based on different gammas, but not Us to represent random variation. To do so we would need a parameter for that, and we dont have it.</p>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prior</span>(CON <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> time <span class="sc">+</span> (<span class="dv">1</span><span class="sc">|</span>ID), <span class="at">data =</span> mlm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  prior     class      coef group resp dpar nlpar lb ub
                 (flat)         b                                      
                 (flat)         b      time                            
 student_t(3, 0.2, 2.5) Intercept                                      
   student_t(3, 0, 2.5)        sd                                  0   
   student_t(3, 0, 2.5)        sd              ID                  0   
   student_t(3, 0, 2.5)        sd Intercept    ID                  0   
   student_t(3, 0, 2.5)     sigma                                  0   
       source
      default
 (vectorized)
      default
      default
 (vectorized)
 (vectorized)
      default</code></pre>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.3</span> <span class="ot">&lt;-</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">family =</span> gaussian,</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>      CON <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> time <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID),</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> b),</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> sd), </span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">sample_prior =</span> <span class="st">"yes"</span>,</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">"mlm.3"</span>,</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">"cmdstanr"</span>,</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> mlm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mlm<span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: CON ~ 1 + time + (1 | ID) 
   Data: mlm (Number of observations: 225) 
  Draws: 4 chains, each with iter = 4000; warmup = 1000; thin = 1;
         total post-warmup draws = 12000

Group-Level Effects: 
~ID (Number of levels: 91) 
              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)     0.06      0.01     0.05     0.07 1.00     4257     6307

Population-Level Effects: 
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     0.19      0.01     0.18     0.21 1.00     6326     8742
time         -0.00      0.00    -0.01     0.00 1.00    15278    10371

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.05      0.00     0.04     0.05 1.00     7244     9241

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(mlm<span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         Estimate    Est.Error          Q2.5         Q97.5
b_Intercept          1.939778e-01  0.007941985  1.783368e-01  2.094254e-01
b_time              -2.636000e-03  0.002165885 -6.873653e-03  1.649770e-03
sd_ID__Intercept     5.670837e-02  0.005571281  4.645314e-02  6.833351e-02
sigma                4.731651e-02  0.002933124  4.196708e-02  5.345535e-02
r_ID[6,Intercept]    7.365707e-03  0.025731804 -4.367414e-02  5.821149e-02
r_ID[29,Intercept]  -4.294873e-02  0.029602225 -1.008998e-01  1.533892e-02
r_ID[34,Intercept]  -5.512252e-02  0.029627013 -1.132857e-01  2.337104e-03
r_ID[36,Intercept]  -2.083782e-02  0.029330151 -7.816040e-02  3.704874e-02
r_ID[37,Intercept]   3.067380e-03  0.025565571 -4.731446e-02  5.359054e-02
r_ID[48,Intercept]   2.951456e-02  0.025676401 -2.115828e-02  7.813181e-02
r_ID[53,Intercept]   5.874492e-03  0.029856691 -5.283035e-02  6.536125e-02
r_ID[54,Intercept]   5.006500e-02  0.025608086  4.810638e-05  1.002139e-01
r_ID[58,Intercept]   3.834425e-02  0.025261551 -1.115868e-02  8.767775e-02
r_ID[61,Intercept]  -6.933273e-02  0.030370893 -1.299183e-01 -1.011322e-02
r_ID[66,Intercept]   4.217768e-02  0.025383115 -7.443768e-03  9.188301e-02
r_ID[67,Intercept]   1.257196e-02  0.022487627 -3.205021e-02  5.690846e-02
r_ID[69,Intercept]   1.245007e-02  0.028283827 -4.267907e-02  6.764206e-02
r_ID[71,Intercept]  -1.047749e-01  0.025845371 -1.561854e-01 -5.381433e-02
r_ID[74,Intercept]   1.398717e-02  0.025809763 -3.709893e-02  6.371352e-02
r_ID[75,Intercept]   5.987898e-02  0.029557278  1.383434e-03  1.178726e-01
r_ID[76,Intercept]  -7.260905e-02  0.025454351 -1.221176e-01 -2.262357e-02
r_ID[78,Intercept]   4.727447e-02  0.025351671 -2.274342e-03  9.614280e-02
r_ID[79,Intercept]  -4.332142e-02  0.028666740 -9.985444e-02  1.304572e-02
r_ID[80,Intercept]  -3.338615e-02  0.029541447 -9.094584e-02  2.533545e-02
r_ID[81,Intercept]   4.468282e-02  0.025875362 -6.213619e-03  9.557265e-02
r_ID[82,Intercept]   1.196305e-01  0.023087407  7.458592e-02  1.645894e-01
r_ID[85,Intercept]  -2.679339e-02  0.029353325 -8.403728e-02  3.087414e-02
r_ID[86,Intercept]  -5.671391e-02  0.029230758 -1.136282e-01  3.135088e-04
r_ID[87,Intercept]  -5.975400e-02  0.029549718 -1.178488e-01 -1.269038e-03
r_ID[89,Intercept]  -4.511241e-02  0.025045894 -9.477729e-02  2.825421e-03
r_ID[91,Intercept]  -1.486806e-02  0.024972710 -6.344995e-02  3.439783e-02
r_ID[92,Intercept]   9.563044e-03  0.025025885 -3.959121e-02  5.777742e-02
r_ID[93,Intercept]   5.072168e-02  0.025598349  1.323002e-04  1.005786e-01
r_ID[94,Intercept]  -5.874171e-02  0.025411099 -1.092914e-01 -8.160009e-03
r_ID[96,Intercept]   2.818653e-02  0.029353220 -2.908296e-02  8.658670e-02
r_ID[97,Intercept]   4.945016e-02  0.022988076  4.232164e-03  9.418137e-02
r_ID[98,Intercept]  -4.307168e-02  0.022528705 -8.648116e-02  1.596159e-03
r_ID[99,Intercept]  -6.629387e-03  0.022677651 -5.223577e-02  3.809565e-02
r_ID[101,Intercept]  4.371327e-02  0.025646964 -5.980274e-03  9.505591e-02
r_ID[102,Intercept] -1.811568e-03  0.022695382 -4.594051e-02  4.173026e-02
r_ID[103,Intercept] -2.853653e-02  0.029094790 -8.549110e-02  2.765629e-02
r_ID[104,Intercept] -1.360900e-02  0.028906597 -6.990044e-02  4.352810e-02
r_ID[105,Intercept] -2.286403e-02  0.024966927 -7.191176e-02  2.593100e-02
r_ID[106,Intercept]  5.628244e-03  0.024981489 -4.317290e-02  5.544271e-02
r_ID[110,Intercept] -6.389311e-03  0.024917289 -5.561549e-02  4.297960e-02
r_ID[112,Intercept] -7.805704e-02  0.026077638 -1.279965e-01 -2.638628e-02
r_ID[114,Intercept] -4.684630e-02  0.025042693 -9.589051e-02  2.599923e-03
r_ID[115,Intercept] -3.976937e-02  0.025453806 -8.994426e-02  9.789406e-03
r_ID[116,Intercept] -3.771538e-02  0.025579645 -8.742118e-02  1.232891e-02
r_ID[120,Intercept]  1.178067e-01  0.030028491  5.752295e-02  1.759070e-01
r_ID[122,Intercept] -1.677586e-02  0.025399997 -6.669110e-02  3.353763e-02
r_ID[125,Intercept]  3.746859e-03  0.024943794 -4.546805e-02  5.274863e-02
r_ID[127,Intercept]  2.906199e-02  0.025004532 -2.001918e-02  7.819544e-02
r_ID[129,Intercept] -4.615920e-02  0.029026790 -1.037133e-01  1.100142e-02
r_ID[135,Intercept]  8.640316e-02  0.025686968  3.545103e-02  1.361081e-01
r_ID[136,Intercept]  8.146483e-02  0.025217564  3.175153e-02  1.307380e-01
r_ID[137,Intercept]  7.395952e-02  0.029820192  1.527080e-02  1.319618e-01
r_ID[140,Intercept] -4.801843e-02  0.029336401 -1.062262e-01  9.242976e-03
r_ID[141,Intercept]  8.448914e-04  0.029249215 -5.552762e-02  5.766044e-02
r_ID[142,Intercept] -9.227819e-03  0.028767228 -6.629232e-02  4.712142e-02
r_ID[143,Intercept]  8.738596e-02  0.029511533  2.963071e-02  1.456204e-01
r_ID[144,Intercept] -1.222306e-02  0.028904798 -6.811663e-02  4.430095e-02
r_ID[146,Intercept]  1.445459e-02  0.029339331 -4.333197e-02  7.337600e-02
r_ID[149,Intercept]  2.840905e-02  0.029568929 -2.970203e-02  8.622119e-02
r_ID[150,Intercept]  7.910038e-03  0.028939123 -4.910080e-02  6.439652e-02
r_ID[152,Intercept]  2.220899e-02  0.029334756 -3.506017e-02  8.006732e-02
r_ID[153,Intercept] -3.221761e-02  0.029199198 -8.986935e-02  2.521008e-02
r_ID[155,Intercept] -3.478631e-02  0.029375299 -9.197716e-02  2.408389e-02
r_ID[156,Intercept] -4.411287e-02  0.025175593 -9.328570e-02  5.002319e-03
r_ID[159,Intercept] -5.043752e-02  0.029382589 -1.074262e-01  7.965986e-03
r_ID[160,Intercept] -1.055755e-02  0.029468714 -6.866319e-02  4.713833e-02
r_ID[162,Intercept]  1.637661e-01  0.026439019  1.120089e-01  2.153536e-01
r_ID[163,Intercept] -4.217885e-02  0.028785853 -9.885516e-02  1.447865e-02
r_ID[165,Intercept]  4.545892e-03  0.028671107 -5.099875e-02  6.074066e-02
r_ID[167,Intercept] -4.280409e-02  0.029181786 -9.924144e-02  1.514441e-02
r_ID[169,Intercept]  3.984291e-02  0.029837732 -1.903054e-02  9.779733e-02
r_ID[171,Intercept]  2.788781e-02  0.028920065 -2.942898e-02  8.414554e-02
r_ID[174,Intercept]  5.355908e-02  0.029840769 -4.715711e-03  1.135731e-01
r_ID[182,Intercept] -2.492706e-03  0.029204541 -5.964457e-02  5.556924e-02
r_ID[187,Intercept] -9.319717e-02  0.029464066 -1.509185e-01 -3.504916e-02
r_ID[189,Intercept]  2.339273e-02  0.029181630 -3.322005e-02  8.081186e-02
r_ID[190,Intercept] -4.719972e-02  0.029364728 -1.051792e-01  1.023142e-02
r_ID[193,Intercept]  1.141311e-02  0.029434456 -4.779079e-02  6.914981e-02
r_ID[194,Intercept] -5.174900e-02  0.029157372 -1.086822e-01  4.818244e-03
r_ID[201,Intercept] -2.137385e-03  0.029070034 -5.854123e-02  5.556658e-02
r_ID[204,Intercept]  7.169953e-02  0.029254127  1.368136e-02  1.286256e-01
r_ID[205,Intercept]  1.979349e-03  0.029721402 -5.680617e-02  5.954486e-02
r_ID[208,Intercept]  1.064491e-02  0.029233673 -4.750901e-02  6.694176e-02
r_ID[209,Intercept]  1.683285e-02  0.029066014 -3.975163e-02  7.372425e-02
r_ID[211,Intercept] -3.793040e-02  0.028752381 -9.470966e-02  1.796184e-02
r_ID[214,Intercept]  6.336997e-02  0.029137329  5.668194e-03  1.203804e-01
r_ID[219,Intercept]  3.046883e-02  0.029501518 -2.767228e-02  8.822436e-02
r_ID[222,Intercept] -3.982453e-02  0.029002719 -9.701049e-02  1.709380e-02
r_ID[223,Intercept] -1.668723e-02  0.028616785 -7.312110e-02  3.966887e-02
r_ID[229,Intercept] -3.656376e-02  0.029415896 -9.406351e-02  2.126052e-02
prior_Intercept      3.628099e-03  1.490858166 -2.903607e+00  2.929187e+00
prior_b             -6.182730e-03  1.513961622 -2.962613e+00  3.007680e+00
prior_sigma          9.932137e-01  1.005350563  2.528490e-02  3.682698e+00
prior_sd_ID          1.195759e+00  0.898614921  4.316324e-02  3.350468e+00
lprior              -3.336070e+00  0.002985242 -3.342260e+00 -3.330640e+00
lp__                 2.304329e+02 11.002378103  2.078374e+02  2.510074e+02</code></pre>
</div>
</div>
</section>
<section id="whats-in-our-posterior" class="level2">
<h2 class="anchored" data-anchor-id="whats-in-our-posterior">whats in our posterior?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_variables</span>(mlm<span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "b_Intercept"         "b_time"              "sd_ID__Intercept"   
  [4] "sigma"               "r_ID[6,Intercept]"   "r_ID[29,Intercept]" 
  [7] "r_ID[34,Intercept]"  "r_ID[36,Intercept]"  "r_ID[37,Intercept]" 
 [10] "r_ID[48,Intercept]"  "r_ID[53,Intercept]"  "r_ID[54,Intercept]" 
 [13] "r_ID[58,Intercept]"  "r_ID[61,Intercept]"  "r_ID[66,Intercept]" 
 [16] "r_ID[67,Intercept]"  "r_ID[69,Intercept]"  "r_ID[71,Intercept]" 
 [19] "r_ID[74,Intercept]"  "r_ID[75,Intercept]"  "r_ID[76,Intercept]" 
 [22] "r_ID[78,Intercept]"  "r_ID[79,Intercept]"  "r_ID[80,Intercept]" 
 [25] "r_ID[81,Intercept]"  "r_ID[82,Intercept]"  "r_ID[85,Intercept]" 
 [28] "r_ID[86,Intercept]"  "r_ID[87,Intercept]"  "r_ID[89,Intercept]" 
 [31] "r_ID[91,Intercept]"  "r_ID[92,Intercept]"  "r_ID[93,Intercept]" 
 [34] "r_ID[94,Intercept]"  "r_ID[96,Intercept]"  "r_ID[97,Intercept]" 
 [37] "r_ID[98,Intercept]"  "r_ID[99,Intercept]"  "r_ID[101,Intercept]"
 [40] "r_ID[102,Intercept]" "r_ID[103,Intercept]" "r_ID[104,Intercept]"
 [43] "r_ID[105,Intercept]" "r_ID[106,Intercept]" "r_ID[110,Intercept]"
 [46] "r_ID[112,Intercept]" "r_ID[114,Intercept]" "r_ID[115,Intercept]"
 [49] "r_ID[116,Intercept]" "r_ID[120,Intercept]" "r_ID[122,Intercept]"
 [52] "r_ID[125,Intercept]" "r_ID[127,Intercept]" "r_ID[129,Intercept]"
 [55] "r_ID[135,Intercept]" "r_ID[136,Intercept]" "r_ID[137,Intercept]"
 [58] "r_ID[140,Intercept]" "r_ID[141,Intercept]" "r_ID[142,Intercept]"
 [61] "r_ID[143,Intercept]" "r_ID[144,Intercept]" "r_ID[146,Intercept]"
 [64] "r_ID[149,Intercept]" "r_ID[150,Intercept]" "r_ID[152,Intercept]"
 [67] "r_ID[153,Intercept]" "r_ID[155,Intercept]" "r_ID[156,Intercept]"
 [70] "r_ID[159,Intercept]" "r_ID[160,Intercept]" "r_ID[162,Intercept]"
 [73] "r_ID[163,Intercept]" "r_ID[165,Intercept]" "r_ID[167,Intercept]"
 [76] "r_ID[169,Intercept]" "r_ID[171,Intercept]" "r_ID[174,Intercept]"
 [79] "r_ID[182,Intercept]" "r_ID[187,Intercept]" "r_ID[189,Intercept]"
 [82] "r_ID[190,Intercept]" "r_ID[193,Intercept]" "r_ID[194,Intercept]"
 [85] "r_ID[201,Intercept]" "r_ID[204,Intercept]" "r_ID[205,Intercept]"
 [88] "r_ID[208,Intercept]" "r_ID[209,Intercept]" "r_ID[211,Intercept]"
 [91] "r_ID[214,Intercept]" "r_ID[219,Intercept]" "r_ID[222,Intercept]"
 [94] "r_ID[223,Intercept]" "r_ID[229,Intercept]" "prior_Intercept"    
 [97] "prior_b"             "prior_sigma"         "prior_sd_ID"        
[100] "lprior"              "lp__"                "accept_stat__"      
[103] "treedepth__"         "stepsize__"          "divergent__"        
[106] "n_leapfrog__"        "energy__"           </code></pre>
</div>
</div>
</section>
<section id="introducing-random-slopes" class="level2">
<h2 class="anchored" data-anchor-id="introducing-random-slopes">Introducing random slopes</h2>
<ul>
<li><p>MLMs “learn” from other units as we saw with random effects</p></li>
<li><p>MLMs can also “learn” about one parameter from another parameter</p></li>
<li><p>We do this through correlated features or parameters. We create this correlated features through introducing random slopes, which pools information across groups</p></li>
<li><p>This is another advantage of “keep it maximal.” Better estimates of intercepts rather than just fitting an intercept only model</p></li>
</ul>
</section>
<section id="random-slopes" class="level2">
<h2 class="anchored" data-anchor-id="random-slopes">Random slopes</h2>
<p>Level 1: <span class="math display">\[{Y}_{ij} = \beta_{0j}  + \beta_{1j}X_{ij} + \varepsilon_{ij}\]</span> Level 2: <span class="math display">\[{\beta}_{0j} = \gamma_{00} + \gamma_{01}G_{j} +   U_{0j}\]</span><br>
<span class="math display">\[{\beta}_{1j} = \gamma_{10} + \gamma_{11}G_{j} + U_{1j}\]</span></p>
<p><span class="math display">\[\begin{pmatrix} {U}_{0j} \\ {U}_{1j} \end{pmatrix}
\sim \mathcal{N} \begin{pmatrix}
  0,      \tau_{00}^{2} &amp; \tau_{01}\\
  0,  \tau_{01} &amp; \tau_{10}^{2}
\end{pmatrix}\]</span></p>
</section>
<section id="correlated-features" class="level2">
<h2 class="anchored" data-anchor-id="correlated-features">correlated features</h2>
<ul>
<li><p>Modeling the joint population of intercepts and slopes, which means by modeling their covariance. We will use joint multivariate Gaussian distribution b/c it is max entropy distribution</p></li>
<li><p>Rather than a 1 dimension prior we will be putting on a two dimension prior.</p></li>
<li><p>Can scale into &gt; 2d depending on how many random effects you have</p></li>
</ul>
</section>
<section id="random-slopes-1" class="level2">
<h2 class="anchored" data-anchor-id="random-slopes-1">Random slopes</h2>
<p><span class="math display">\[y_i \sim \text{Normal}(\mu, \sigma)\]</span> <span class="math display">\[\mu_i = \beta_{0j} + \beta_{1j}X_{ij}\]</span> <span class="math display">\[(\beta_{0j}, \beta_{1j}) \sim \text{MVNormal}  ([\beta_0, \beta_1], \Sigma)\]</span></p>
<p><span class="math display">\[\Sigma =
\left(\begin{array}{cc}
\sigma_{\beta_0}&amp;0\\
0&amp;\sigma_{\beta_1}
\end{array}\right)R
\left(\begin{array}{cc}
\sigma_{\beta_0}&amp;0\\
0&amp;\sigma_{\beta_1}
\end{array}\right)\]</span> <span class="math display">\[\beta_0 \sim \text{Normal}(0, 1)\]</span></p>
<p><span class="math display">\[\beta_1 \sim \text{Normal}(0, 1)\]</span> <span class="math display">\[\sigma_{\beta_0} \sim \text{Exponential}(1)\]</span> <span class="math display">\[\sigma_{\beta_1} \sim \text{Exponential}(1)\]</span> <span class="math display">\[\sigma \sim \text{Exponential}(1)\]</span> <span class="math display">\[R \sim \text{LKJcorr(2)}\]</span></p>
<hr>
<p>where Σ is the covariance matrix</p>
<p><span class="math display">\[\Sigma =
\left(\begin{array}{cc}
\sigma^2_{\beta_0}&amp;\sigma_{\beta_0}\sigma_{\beta_1}\rho\\
\sigma_{\beta_0}\sigma_{\beta_1}\rho&amp;\sigma^2_{\beta_1}
\end{array}\right)\]</span></p>
<p>and R is the correlation matrix R = <span class="math inline">\(\begin{bmatrix} 1 &amp; \rho \\ \rho &amp; 1 \end{bmatrix}\)</span>.</p>
<p>With more random effects, this matrix expands.</p>
</section>
<section id="lkj-1-parameter-correlation-prior" class="level2">
<h2 class="anchored" data-anchor-id="lkj-1-parameter-correlation-prior">lkj 1 parameter correlation prior</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="fu">expand.grid</span>(</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>,</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">K =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">fct_rev</span>(<span class="fu">ordered</span>(eta)), <span class="at">dist =</span> <span class="st">"lkjcorr_marginal"</span>, <span class="at">arg1 =</span> K, <span class="at">arg2 =</span> eta)) <span class="sc">+</span></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_dist_slab</span>() <span class="sc">+</span></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> <span class="fu">paste0</span>(K, <span class="st">"x"</span>, K)) <span class="sc">+</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>      <span class="st">"LKJ(eta) prior on different matrix sizes:</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"eta"</span>,</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Marginal correlation"</span></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="multivariate-distributions" class="level2">
<h2 class="anchored" data-anchor-id="multivariate-distributions">Multivariate distributions</h2>
<p>r = 0. Knowing about 1 parameter doesn’t tell you anything about the other.</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:patchwork':

    area</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `stat(density)` was deprecated in ggplot2 3.4.0.
ℹ Please use `after_stat(density)` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>r = .5</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:patchwork':

    area</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>r = .8</p>
<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:patchwork':

    area</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prior</span>(<span class="at">family =</span> gaussian,</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>      CON <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> time <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> time <span class="sc">|</span> ID),</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> mlm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  prior     class      coef group resp dpar nlpar lb ub
                 (flat)         b                                      
                 (flat)         b      time                            
                 lkj(1)       cor                                      
                 lkj(1)       cor              ID                      
 student_t(3, 0.2, 2.5) Intercept                                      
   student_t(3, 0, 2.5)        sd                                  0   
   student_t(3, 0, 2.5)        sd              ID                  0   
   student_t(3, 0, 2.5)        sd Intercept    ID                  0   
   student_t(3, 0, 2.5)        sd      time    ID                  0   
   student_t(3, 0, 2.5)     sigma                                  0   
       source
      default
 (vectorized)
      default
 (vectorized)
      default
      default
 (vectorized)
 (vectorized)
 (vectorized)
      default</code></pre>
</div>
</div>
<hr>
<p>Information needed to learn about parameters can be ranked:</p>
<ol type="1">
<li>Means are easy</li>
<li>SDs are medium</li>
<li>Correlations are hard</li>
</ol>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.4</span> <span class="ot">&lt;-</span> </span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">family =</span> gaussian,</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>      CON <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> time <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> time <span class="sc">|</span> ID),</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> b),</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> Intercept, <span class="at">group =</span> ID), </span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> time, <span class="at">group =</span> ID), </span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">2</span>), <span class="at">class =</span> cor)),</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">"mlm.4"</span>,</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">"cmdstanr"</span>,</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> mlm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mlm<span class="fl">.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There were 32 divergent transitions after warmup. Increasing
adapt_delta above 0.8 may help. See
http://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: CON ~ 1 + time + (1 + time | ID) 
   Data: mlm (Number of observations: 225) 
  Draws: 4 chains, each with iter = 4000; warmup = 1000; thin = 1;
         total post-warmup draws = 12000

Group-Level Effects: 
~ID (Number of levels: 91) 
                    Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)           0.06      0.01     0.05     0.07 1.00     3680     5470
sd(time)                0.00      0.00     0.00     0.01 1.00     1392     1534
cor(Intercept,time)    -0.09      0.40    -0.78     0.74 1.00    10248     7901

Population-Level Effects: 
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     0.19      0.01     0.18     0.21 1.00     4864     5920
time         -0.00      0.00    -0.01     0.00 1.00    10374     9299

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.05      0.00     0.04     0.05 1.00     3584     4201

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>p.mlm4 <span class="ot">&lt;-</span> <span class="fu">posterior_samples</span>(mlm<span class="fl">.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Method 'posterior_samples' is deprecated. Please see ?as_draws for
recommended alternatives.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: cmdstanr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This is cmdstanr version 0.5.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- CmdStanR documentation and vignettes: mc-stan.org/cmdstanr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- CmdStan path: /Users/jackson/.cmdstan/cmdstan-2.32.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>- CmdStan version: 2.32.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
A newer version of CmdStan is available. See ?install_cmdstan() to install it.
To disable this check set option or environment variable CMDSTANR_NO_VER_CHECK=TRUE.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: posterior</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>This is posterior version 1.4.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'posterior'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    mad, sd, var</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    %in%, match</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: parallel</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>rethinking (Version 2.40)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'rethinking'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:brms':

    LOO, stancode, WAIC</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    map</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    rstudent</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>r_2 <span class="ot">&lt;-</span> </span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rlkjcorr</span>(<span class="dv">1000</span>, <span class="at">K =</span> <span class="dv">2</span>, <span class="at">eta =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a>p.mlm4 <span class="sc">%&gt;%</span></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb131-7"><a href="#cb131-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data =</span> r_2, <span class="fu">aes</span>(<span class="at">x =</span> V2),</span>
<span id="cb131-8"><a href="#cb131-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"transparent"</span>, <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb131-9"><a href="#cb131-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> cor_ID__Intercept__time),</span>
<span id="cb131-10"><a href="#cb131-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"transparent"</span>, <span class="at">fill =</span> <span class="st">"grey"</span>, <span class="at">alpha =</span> <span class="dv">9</span><span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb131-11"><a href="#cb131-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="fl">0.15</span>, <span class="at">y =</span> <span class="fl">1.1</span>, </span>
<span id="cb131-12"><a href="#cb131-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"posterior"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">family =</span> <span class="st">"Courier"</span>) <span class="sc">+</span></span>
<span id="cb131-13"><a href="#cb131-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> .<span class="dv">2</span>, <span class="at">y =</span> <span class="fl">1.35</span>, </span>
<span id="cb131-14"><a href="#cb131-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"prior"</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">family =</span> <span class="st">"Courier"</span>) <span class="sc">+</span></span>
<span id="cb131-15"><a href="#cb131-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb131-16"><a href="#cb131-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Correlation between intercepts</span><span class="sc">\n</span><span class="st">and slopes, prior and posterior"</span>,</span>
<span id="cb131-17"><a href="#cb131-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="st">"correlation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a>partially_pooled_params <span class="ot">&lt;-</span></span>
<span id="cb132-2"><a href="#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(mlm<span class="fl">.4</span>)<span class="sc">$</span>ID [ , <span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">%&gt;%</span></span>
<span id="cb132-3"><a href="#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"ID"</span>) </span>
<span id="cb132-4"><a href="#cb132-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-5"><a href="#cb132-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-6"><a href="#cb132-6" aria-hidden="true" tabindex="-1"></a>un_pooled_params <span class="ot">&lt;-</span></span>
<span id="cb132-7"><a href="#cb132-7" aria-hidden="true" tabindex="-1"></a>  mlm <span class="sc">%&gt;%</span></span>
<span id="cb132-8"><a href="#cb132-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, time) <span class="sc">%&gt;%</span></span>
<span id="cb132-9"><a href="#cb132-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(CON)) <span class="sc">%&gt;%</span></span>
<span id="cb132-10"><a href="#cb132-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do</span>(<span class="fu">tidy</span>(<span class="fu">lm</span>(mean <span class="sc">~</span> time, <span class="at">data=</span>.))) <span class="sc">%&gt;%</span> </span>
<span id="cb132-11"><a href="#cb132-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb132-12"><a href="#cb132-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, term, estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb132-13"><a href="#cb132-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb132-14"><a href="#cb132-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Intercept =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb132-15"><a href="#cb132-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb132-16"><a href="#cb132-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">as.character</span>(ID))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'ID'. You can override using the `.groups`
argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># `bind_rows()` will stack the second tibble below the first</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(partially_pooled_params, un_pooled_params) <span class="sc">%&gt;%</span></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># index whether the estimates are pooled</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pooled =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"partially"</span>, <span class="st">"not"</span>), <span class="at">each =</span> <span class="fu">nrow</span>(.)<span class="sc">/</span><span class="dv">2</span>)) </span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> params, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> Intercept)) <span class="sc">+</span></span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">geom =</span> <span class="st">"polygon"</span>, <span class="at">type =</span> <span class="st">"norm"</span>, <span class="at">level =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>, <span class="at">size =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">20</span>, <span class="at">fill =</span> <span class="st">"#E7CDC2"</span>) <span class="sc">+</span></span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">geom =</span> <span class="st">"polygon"</span>, <span class="at">type =</span> <span class="st">"norm"</span>, <span class="at">level =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">10</span>, <span class="at">size =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">20</span>, <span class="at">fill =</span> <span class="st">"#E7CDC2"</span>) <span class="sc">+</span></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">geom =</span> <span class="st">"polygon"</span>, <span class="at">type =</span> <span class="st">"norm"</span>, <span class="at">level =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">10</span>, <span class="at">size =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">20</span>, <span class="at">fill =</span> <span class="st">"#E7CDC2"</span>) <span class="sc">+</span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">geom =</span> <span class="st">"polygon"</span>, <span class="at">type =</span> <span class="st">"norm"</span>, <span class="at">level =</span> <span class="dv">4</span><span class="sc">/</span><span class="dv">10</span>, <span class="at">size =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">20</span>, <span class="at">fill =</span> <span class="st">"#E7CDC2"</span>) <span class="sc">+</span></span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">geom =</span> <span class="st">"polygon"</span>, <span class="at">type =</span> <span class="st">"norm"</span>, <span class="at">level =</span> <span class="dv">5</span><span class="sc">/</span><span class="dv">10</span>, <span class="at">size =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">20</span>, <span class="at">fill =</span> <span class="st">"#E7CDC2"</span>) <span class="sc">+</span></span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">geom =</span> <span class="st">"polygon"</span>, <span class="at">type =</span> <span class="st">"norm"</span>, <span class="at">level =</span> <span class="dv">6</span><span class="sc">/</span><span class="dv">10</span>, <span class="at">size =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">20</span>, <span class="at">fill =</span> <span class="st">"#E7CDC2"</span>) <span class="sc">+</span></span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">geom =</span> <span class="st">"polygon"</span>, <span class="at">type =</span> <span class="st">"norm"</span>, <span class="at">level =</span> <span class="dv">7</span><span class="sc">/</span><span class="dv">10</span>, <span class="at">size =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">20</span>, <span class="at">fill =</span> <span class="st">"#E7CDC2"</span>) <span class="sc">+</span></span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">geom =</span> <span class="st">"polygon"</span>, <span class="at">type =</span> <span class="st">"norm"</span>, <span class="at">level =</span> <span class="dv">8</span><span class="sc">/</span><span class="dv">10</span>, <span class="at">size =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">20</span>, <span class="at">fill =</span> <span class="st">"#E7CDC2"</span>) <span class="sc">+</span></span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">geom =</span> <span class="st">"polygon"</span>, <span class="at">type =</span> <span class="st">"norm"</span>, <span class="at">level =</span> <span class="dv">9</span><span class="sc">/</span><span class="dv">10</span>, <span class="at">size =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">20</span>, <span class="at">fill =</span> <span class="st">"#E7CDC2"</span>) <span class="sc">+</span></span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">geom =</span> <span class="st">"polygon"</span>, <span class="at">type =</span> <span class="st">"norm"</span>, <span class="at">level =</span> .<span class="dv">99</span>,  <span class="at">size =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">20</span>, <span class="at">fill =</span> <span class="st">"#E7CDC2"</span>) <span class="sc">+</span></span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">group =</span> ID, <span class="at">color =</span> pooled)) <span class="sc">+</span></span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> ID), <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">"Pooled?"</span>,</span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#80A0C7"</span>, <span class="st">"#A65141"</span>)) <span class="sc">+</span></span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(params<span class="sc">$</span>time),</span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(params<span class="sc">$</span>Intercept))</span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>p1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_variables</span>(mlm<span class="fl">.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "b_Intercept"             "b_time"                 
  [3] "sd_ID__Intercept"        "sd_ID__time"            
  [5] "cor_ID__Intercept__time" "sigma"                  
  [7] "r_ID[6,Intercept]"       "r_ID[29,Intercept]"     
  [9] "r_ID[34,Intercept]"      "r_ID[36,Intercept]"     
 [11] "r_ID[37,Intercept]"      "r_ID[48,Intercept]"     
 [13] "r_ID[53,Intercept]"      "r_ID[54,Intercept]"     
 [15] "r_ID[58,Intercept]"      "r_ID[61,Intercept]"     
 [17] "r_ID[66,Intercept]"      "r_ID[67,Intercept]"     
 [19] "r_ID[69,Intercept]"      "r_ID[71,Intercept]"     
 [21] "r_ID[74,Intercept]"      "r_ID[75,Intercept]"     
 [23] "r_ID[76,Intercept]"      "r_ID[78,Intercept]"     
 [25] "r_ID[79,Intercept]"      "r_ID[80,Intercept]"     
 [27] "r_ID[81,Intercept]"      "r_ID[82,Intercept]"     
 [29] "r_ID[85,Intercept]"      "r_ID[86,Intercept]"     
 [31] "r_ID[87,Intercept]"      "r_ID[89,Intercept]"     
 [33] "r_ID[91,Intercept]"      "r_ID[92,Intercept]"     
 [35] "r_ID[93,Intercept]"      "r_ID[94,Intercept]"     
 [37] "r_ID[96,Intercept]"      "r_ID[97,Intercept]"     
 [39] "r_ID[98,Intercept]"      "r_ID[99,Intercept]"     
 [41] "r_ID[101,Intercept]"     "r_ID[102,Intercept]"    
 [43] "r_ID[103,Intercept]"     "r_ID[104,Intercept]"    
 [45] "r_ID[105,Intercept]"     "r_ID[106,Intercept]"    
 [47] "r_ID[110,Intercept]"     "r_ID[112,Intercept]"    
 [49] "r_ID[114,Intercept]"     "r_ID[115,Intercept]"    
 [51] "r_ID[116,Intercept]"     "r_ID[120,Intercept]"    
 [53] "r_ID[122,Intercept]"     "r_ID[125,Intercept]"    
 [55] "r_ID[127,Intercept]"     "r_ID[129,Intercept]"    
 [57] "r_ID[135,Intercept]"     "r_ID[136,Intercept]"    
 [59] "r_ID[137,Intercept]"     "r_ID[140,Intercept]"    
 [61] "r_ID[141,Intercept]"     "r_ID[142,Intercept]"    
 [63] "r_ID[143,Intercept]"     "r_ID[144,Intercept]"    
 [65] "r_ID[146,Intercept]"     "r_ID[149,Intercept]"    
 [67] "r_ID[150,Intercept]"     "r_ID[152,Intercept]"    
 [69] "r_ID[153,Intercept]"     "r_ID[155,Intercept]"    
 [71] "r_ID[156,Intercept]"     "r_ID[159,Intercept]"    
 [73] "r_ID[160,Intercept]"     "r_ID[162,Intercept]"    
 [75] "r_ID[163,Intercept]"     "r_ID[165,Intercept]"    
 [77] "r_ID[167,Intercept]"     "r_ID[169,Intercept]"    
 [79] "r_ID[171,Intercept]"     "r_ID[174,Intercept]"    
 [81] "r_ID[182,Intercept]"     "r_ID[187,Intercept]"    
 [83] "r_ID[189,Intercept]"     "r_ID[190,Intercept]"    
 [85] "r_ID[193,Intercept]"     "r_ID[194,Intercept]"    
 [87] "r_ID[201,Intercept]"     "r_ID[204,Intercept]"    
 [89] "r_ID[205,Intercept]"     "r_ID[208,Intercept]"    
 [91] "r_ID[209,Intercept]"     "r_ID[211,Intercept]"    
 [93] "r_ID[214,Intercept]"     "r_ID[219,Intercept]"    
 [95] "r_ID[222,Intercept]"     "r_ID[223,Intercept]"    
 [97] "r_ID[229,Intercept]"     "r_ID[6,time]"           
 [99] "r_ID[29,time]"           "r_ID[34,time]"          
[101] "r_ID[36,time]"           "r_ID[37,time]"          
[103] "r_ID[48,time]"           "r_ID[53,time]"          
[105] "r_ID[54,time]"           "r_ID[58,time]"          
[107] "r_ID[61,time]"           "r_ID[66,time]"          
[109] "r_ID[67,time]"           "r_ID[69,time]"          
[111] "r_ID[71,time]"           "r_ID[74,time]"          
[113] "r_ID[75,time]"           "r_ID[76,time]"          
[115] "r_ID[78,time]"           "r_ID[79,time]"          
[117] "r_ID[80,time]"           "r_ID[81,time]"          
[119] "r_ID[82,time]"           "r_ID[85,time]"          
[121] "r_ID[86,time]"           "r_ID[87,time]"          
[123] "r_ID[89,time]"           "r_ID[91,time]"          
[125] "r_ID[92,time]"           "r_ID[93,time]"          
[127] "r_ID[94,time]"           "r_ID[96,time]"          
[129] "r_ID[97,time]"           "r_ID[98,time]"          
[131] "r_ID[99,time]"           "r_ID[101,time]"         
[133] "r_ID[102,time]"          "r_ID[103,time]"         
[135] "r_ID[104,time]"          "r_ID[105,time]"         
[137] "r_ID[106,time]"          "r_ID[110,time]"         
[139] "r_ID[112,time]"          "r_ID[114,time]"         
[141] "r_ID[115,time]"          "r_ID[116,time]"         
[143] "r_ID[120,time]"          "r_ID[122,time]"         
[145] "r_ID[125,time]"          "r_ID[127,time]"         
[147] "r_ID[129,time]"          "r_ID[135,time]"         
[149] "r_ID[136,time]"          "r_ID[137,time]"         
[151] "r_ID[140,time]"          "r_ID[141,time]"         
[153] "r_ID[142,time]"          "r_ID[143,time]"         
[155] "r_ID[144,time]"          "r_ID[146,time]"         
[157] "r_ID[149,time]"          "r_ID[150,time]"         
[159] "r_ID[152,time]"          "r_ID[153,time]"         
[161] "r_ID[155,time]"          "r_ID[156,time]"         
[163] "r_ID[159,time]"          "r_ID[160,time]"         
[165] "r_ID[162,time]"          "r_ID[163,time]"         
[167] "r_ID[165,time]"          "r_ID[167,time]"         
[169] "r_ID[169,time]"          "r_ID[171,time]"         
[171] "r_ID[174,time]"          "r_ID[182,time]"         
[173] "r_ID[187,time]"          "r_ID[189,time]"         
[175] "r_ID[190,time]"          "r_ID[193,time]"         
[177] "r_ID[194,time]"          "r_ID[201,time]"         
[179] "r_ID[204,time]"          "r_ID[205,time]"         
[181] "r_ID[208,time]"          "r_ID[209,time]"         
[183] "r_ID[211,time]"          "r_ID[214,time]"         
[185] "r_ID[219,time]"          "r_ID[222,time]"         
[187] "r_ID[223,time]"          "r_ID[229,time]"         
[189] "lprior"                  "lp__"                   
[191] "accept_stat__"           "treedepth__"            
[193] "stepsize__"              "divergent__"            
[195] "n_leapfrog__"            "energy__"               </code></pre>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.4</span> <span class="sc">%&gt;%</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(r_ID[ID,term]) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,184,000 × 6
# Groups:   ID, term [182]
      ID term         r_ID .chain .iteration .draw
   &lt;int&gt; &lt;chr&gt;       &lt;dbl&gt;  &lt;int&gt;      &lt;int&gt; &lt;int&gt;
 1     6 Intercept -0.0305      1          1     1
 2     6 Intercept  0.0222      1          2     2
 3     6 Intercept  0.0429      1          3     3
 4     6 Intercept  0.0735      1          4     4
 5     6 Intercept  0.0423      1          5     5
 6     6 Intercept -0.0271      1          6     6
 7     6 Intercept  0.0114      1          7     7
 8     6 Intercept  0.0146      1          8     8
 9     6 Intercept  0.0356      1          9     9
10     6 Intercept -0.0478      1         10    10
# ℹ 2,183,990 more rows</code></pre>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.4</span> <span class="sc">%&gt;%</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(b_time, r_ID[ID, term]) <span class="sc">%&gt;%</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"time"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">person_t =</span> b_time <span class="sc">+</span> r_ID) <span class="sc">%&gt;%</span> </span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a> <span class="fu">median_qi</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 91 × 14
# Groups:   ID [91]
      ID term    b_time b_time.lower b_time.upper     r_ID r_ID.lower r_ID.upper
   &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;
 1     6 time  -0.00285     -0.00733      0.00148  2.26e-5   -0.00993    0.0104 
 2    29 time  -0.00285     -0.00733      0.00148 -3.77e-4   -0.0135     0.00798
 3    34 time  -0.00285     -0.00733      0.00148 -6.00e-4   -0.0150     0.00669
 4    36 time  -0.00285     -0.00733      0.00148  1.38e-4   -0.00916    0.0130 
 5    37 time  -0.00285     -0.00733      0.00148 -2.17e-4   -0.0123     0.00748
 6    48 time  -0.00285     -0.00733      0.00148 -2.82e-5   -0.0108     0.00890
 7    53 time  -0.00285     -0.00733      0.00148 -2.33e-4   -0.0128     0.00789
 8    54 time  -0.00285     -0.00733      0.00148  2.22e-4   -0.00844    0.0112 
 9    58 time  -0.00285     -0.00733      0.00148  5.06e-4   -0.00714    0.0159 
10    61 time  -0.00285     -0.00733      0.00148 -5.52e-5   -0.0103     0.0104 
# ℹ 81 more rows
# ℹ 6 more variables: person_t &lt;dbl&gt;, person_t.lower &lt;dbl&gt;,
#   person_t.upper &lt;dbl&gt;, .width &lt;dbl&gt;, .point &lt;chr&gt;, .interval &lt;chr&gt;</code></pre>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.4</span> <span class="sc">%&gt;%</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(b_time, r_ID[ID, term]) <span class="sc">%&gt;%</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"time"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(<span class="at">person_t =</span> b_time <span class="sc">+</span> r_ID) <span class="sc">%&gt;%</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>( <span class="at">y =</span> <span class="fu">reorder</span>(ID, person_t), <span class="at">x =</span> person_t, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"est"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"ID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(mlm<span class="fl">.1</span>, <span class="st">"loo"</span>)</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.4</span> <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(mlm<span class="fl">.2</span>, <span class="st">"loo"</span>)</span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(mlm<span class="fl">.1</span>, mlm<span class="fl">.2</span>, <span class="at">criterion =</span> <span class="st">"loo"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      elpd_diff se_diff
mlm.1   0.0       0.0  
mlm.2 -58.1       8.8  </code></pre>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>esm <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/josh-jackson/bayes2022/main/static/Lectures/esm_w1_RENAMED.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
Rows: 11540 Columns: 89
── Column specification
──────────────────────────────────────────────────────── Delimiter: "," chr
(3): esm.startDateTime.w1, esm.endDateTime.w1, esm.OR.w1 dbl (84): ...1,
esm.IDnum.w1, esm.PRO01.w1, esm.PRO02.w1, esm.PRO03.w1, esm.... lgl (2):
esm.ST14.w1, esm.ST15.w1
ℹ Use `spec()` to retrieve the full column specification for this data. ℹ
Specify the column types or set `show_col_types = FALSE` to quiet this message.
• `` -&gt; `...1`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>esm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11,540 × 89
    ...1 esm.IDnum.w1 esm.PRO01.w1 esm.PRO02.w1 esm.PRO03.w1
   &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;
 1     1        10549           17            1            1
 2     2        10547           57            1            1
 3     3        10547           57            1            1
 4     4        10539           51            1            1
 5     5        10547           57            1            1
 6     6        10549           17            1            1
 7     7        10539           51            1            1
 8     8        10549           17            1            1
 9     9        10547           57            1            1
10    10        10526           36            1            1
# ℹ 11,530 more rows
# ℹ 84 more variables: esm.startDateTime.w1 &lt;chr&gt;, esm.PRO04.w1 &lt;dbl&gt;,
#   esm.PRO05.w1 &lt;dbl&gt;, esm.PRO06.w1 &lt;dbl&gt;, esm.PRO07.w1 &lt;dbl&gt;,
#   esm.endDateTime.w1 &lt;chr&gt;, esm.OR.w1 &lt;chr&gt;, esm.NQ11.w1 &lt;dbl&gt;,
#   esm.NQ12.w1 &lt;dbl&gt;, esm.EXT.w1 &lt;dbl&gt;, esm.AGR.w1 &lt;dbl&gt;, esm.CON.w1 &lt;dbl&gt;,
#   esm.NEU.w1 &lt;dbl&gt;, `esm.NQ11+1.w1` &lt;dbl&gt;, `esm.NQ12+1.w1` &lt;dbl&gt;,
#   `esm.EXT+1.w1` &lt;dbl&gt;, `esm.AGR+1.w1` &lt;dbl&gt;, `esm.CON+1.w1` &lt;dbl&gt;, …</code></pre>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>esm<span class="sc">$</span>PA <span class="ot">&lt;-</span> esm<span class="sc">$</span>esm.NQ11.w1</span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a>esm<span class="sc">$</span>W.other <span class="ot">&lt;-</span> esm<span class="sc">$</span>esm.ST04.w1</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>esm<span class="sc">$</span>ID <span class="ot">&lt;-</span> esm<span class="sc">$</span>esm.IDnum.w1</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Matrix'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lme4'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:brms':

    ngrps</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">lmer</span>(PA <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> W.other  <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> W.other  <span class="sc">|</span> ID), <span class="at">data =</span> esm )</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: PA ~ 1 + W.other + (1 + W.other | ID)
   Data: esm

REML criterion at convergence: 24523.2

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.5746 -0.6263  0.0180  0.6978  2.8135 

Random effects:
 Groups   Name        Variance Std.Dev. Corr 
 ID       (Intercept) 0.25954  0.5094        
          W.other     0.03266  0.1807   -0.56
 Residual             0.72255  0.8500        
Number of obs: 9461, groups:  ID, 364

Fixed effects:
            Estimate Std. Error t value
(Intercept)  3.15230    0.03538   89.09
W.other      0.31802    0.02612   12.18

Correlation of Fixed Effects:
        (Intr)
W.other -0.686</code></pre>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.5</span> <span class="ot">&lt;-</span> </span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">family =</span> gaussian,</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>      PA <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> W.other  <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> W.other  <span class="sc">|</span> ID),</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">class =</span> b),</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">10</span>, <span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> Intercept, <span class="at">group =</span> ID), </span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">10</span>, <span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> W.other, <span class="at">group =</span> ID), </span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">10</span>), <span class="at">class =</span> cor)),</span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">"mlm.5"</span>,</span>
<span id="cb156-13"><a href="#cb156-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">"cmdstanr"</span>,</span>
<span id="cb156-14"><a href="#cb156-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> esm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>747 parameters in our posterior</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_variables</span>(mlm<span class="fl">.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "b_Intercept"                "b_W.other"                 
  [3] "sd_ID__Intercept"           "sd_ID__W.other"            
  [5] "cor_ID__Intercept__W.other" "sigma"                     
  [7] "r_ID[81,Intercept]"         "r_ID[86,Intercept]"        
  [9] "r_ID[87,Intercept]"         "r_ID[88,Intercept]"        
 [11] "r_ID[89,Intercept]"         "r_ID[90,Intercept]"        
 [13] "r_ID[91,Intercept]"         "r_ID[92,Intercept]"        
 [15] "r_ID[93,Intercept]"         "r_ID[94,Intercept]"        
 [17] "r_ID[95,Intercept]"         "r_ID[97,Intercept]"        
 [19] "r_ID[98,Intercept]"         "r_ID[100,Intercept]"       
 [21] "r_ID[101,Intercept]"        "r_ID[102,Intercept]"       
 [23] "r_ID[104,Intercept]"        "r_ID[10105,Intercept]"     
 [25] "r_ID[10106,Intercept]"      "r_ID[10107,Intercept]"     
 [27] "r_ID[10108,Intercept]"      "r_ID[10109,Intercept]"     
 [29] "r_ID[10110,Intercept]"      "r_ID[10111,Intercept]"     
 [31] "r_ID[10112,Intercept]"      "r_ID[10113,Intercept]"     
 [33] "r_ID[10114,Intercept]"      "r_ID[10116,Intercept]"     
 [35] "r_ID[10117,Intercept]"      "r_ID[10118,Intercept]"     
 [37] "r_ID[10121,Intercept]"      "r_ID[10122,Intercept]"     
 [39] "r_ID[10123,Intercept]"      "r_ID[10124,Intercept]"     
 [41] "r_ID[10125,Intercept]"      "r_ID[10126,Intercept]"     
 [43] "r_ID[10127,Intercept]"      "r_ID[10128,Intercept]"     
 [45] "r_ID[10129,Intercept]"      "r_ID[10130,Intercept]"     
 [47] "r_ID[10131,Intercept]"      "r_ID[10132,Intercept]"     
 [49] "r_ID[10133,Intercept]"      "r_ID[10134,Intercept]"     
 [51] "r_ID[10136,Intercept]"      "r_ID[10137,Intercept]"     
 [53] "r_ID[10138,Intercept]"      "r_ID[10139,Intercept]"     
 [55] "r_ID[10141,Intercept]"      "r_ID[10143,Intercept]"     
 [57] "r_ID[10144,Intercept]"      "r_ID[10145,Intercept]"     
 [59] "r_ID[10147,Intercept]"      "r_ID[10148,Intercept]"     
 [61] "r_ID[10149,Intercept]"      "r_ID[10150,Intercept]"     
 [63] "r_ID[10151,Intercept]"      "r_ID[10153,Intercept]"     
 [65] "r_ID[10154,Intercept]"      "r_ID[10155,Intercept]"     
 [67] "r_ID[10157,Intercept]"      "r_ID[10158,Intercept]"     
 [69] "r_ID[10159,Intercept]"      "r_ID[10160,Intercept]"     
 [71] "r_ID[10161,Intercept]"      "r_ID[10162,Intercept]"     
 [73] "r_ID[10164,Intercept]"      "r_ID[10166,Intercept]"     
 [75] "r_ID[10167,Intercept]"      "r_ID[10171,Intercept]"     
 [77] "r_ID[10172,Intercept]"      "r_ID[10173,Intercept]"     
 [79] "r_ID[10174,Intercept]"      "r_ID[10175,Intercept]"     
 [81] "r_ID[10176,Intercept]"      "r_ID[10177,Intercept]"     
 [83] "r_ID[10178,Intercept]"      "r_ID[10180,Intercept]"     
 [85] "r_ID[10181,Intercept]"      "r_ID[10184,Intercept]"     
 [87] "r_ID[10185,Intercept]"      "r_ID[10186,Intercept]"     
 [89] "r_ID[10187,Intercept]"      "r_ID[10188,Intercept]"     
 [91] "r_ID[10190,Intercept]"      "r_ID[10192,Intercept]"     
 [93] "r_ID[10193,Intercept]"      "r_ID[10194,Intercept]"     
 [95] "r_ID[10195,Intercept]"      "r_ID[10196,Intercept]"     
 [97] "r_ID[10197,Intercept]"      "r_ID[10198,Intercept]"     
 [99] "r_ID[10199,Intercept]"      "r_ID[10200,Intercept]"     
[101] "r_ID[10201,Intercept]"      "r_ID[10202,Intercept]"     
[103] "r_ID[10203,Intercept]"      "r_ID[10204,Intercept]"     
[105] "r_ID[10205,Intercept]"      "r_ID[10206,Intercept]"     
[107] "r_ID[10207,Intercept]"      "r_ID[10208,Intercept]"     
[109] "r_ID[10210,Intercept]"      "r_ID[10211,Intercept]"     
[111] "r_ID[10212,Intercept]"      "r_ID[10213,Intercept]"     
[113] "r_ID[10214,Intercept]"      "r_ID[10215,Intercept]"     
[115] "r_ID[10216,Intercept]"      "r_ID[10217,Intercept]"     
[117] "r_ID[10219,Intercept]"      "r_ID[10220,Intercept]"     
[119] "r_ID[10221,Intercept]"      "r_ID[10222,Intercept]"     
[121] "r_ID[10223,Intercept]"      "r_ID[10226,Intercept]"     
[123] "r_ID[10227,Intercept]"      "r_ID[10228,Intercept]"     
[125] "r_ID[10229,Intercept]"      "r_ID[10230,Intercept]"     
[127] "r_ID[10231,Intercept]"      "r_ID[10232,Intercept]"     
[129] "r_ID[10233,Intercept]"      "r_ID[10234,Intercept]"     
[131] "r_ID[10236,Intercept]"      "r_ID[10237,Intercept]"     
[133] "r_ID[10238,Intercept]"      "r_ID[10239,Intercept]"     
[135] "r_ID[10240,Intercept]"      "r_ID[10241,Intercept]"     
[137] "r_ID[10242,Intercept]"      "r_ID[10243,Intercept]"     
[139] "r_ID[10244,Intercept]"      "r_ID[10245,Intercept]"     
[141] "r_ID[10247,Intercept]"      "r_ID[10248,Intercept]"     
[143] "r_ID[10249,Intercept]"      "r_ID[10250,Intercept]"     
[145] "r_ID[10251,Intercept]"      "r_ID[10253,Intercept]"     
[147] "r_ID[10255,Intercept]"      "r_ID[10256,Intercept]"     
[149] "r_ID[10258,Intercept]"      "r_ID[10259,Intercept]"     
[151] "r_ID[10260,Intercept]"      "r_ID[10266,Intercept]"     
[153] "r_ID[10267,Intercept]"      "r_ID[10268,Intercept]"     
[155] "r_ID[10269,Intercept]"      "r_ID[10270,Intercept]"     
[157] "r_ID[10271,Intercept]"      "r_ID[10272,Intercept]"     
[159] "r_ID[10273,Intercept]"      "r_ID[10274,Intercept]"     
[161] "r_ID[10275,Intercept]"      "r_ID[10276,Intercept]"     
[163] "r_ID[10277,Intercept]"      "r_ID[10280,Intercept]"     
[165] "r_ID[10281,Intercept]"      "r_ID[10285,Intercept]"     
[167] "r_ID[10286,Intercept]"      "r_ID[10287,Intercept]"     
[169] "r_ID[10288,Intercept]"      "r_ID[10289,Intercept]"     
[171] "r_ID[10290,Intercept]"      "r_ID[10291,Intercept]"     
[173] "r_ID[10292,Intercept]"      "r_ID[10293,Intercept]"     
[175] "r_ID[10294,Intercept]"      "r_ID[10295,Intercept]"     
[177] "r_ID[10296,Intercept]"      "r_ID[10299,Intercept]"     
[179] "r_ID[10301,Intercept]"      "r_ID[10304,Intercept]"     
[181] "r_ID[10305,Intercept]"      "r_ID[10308,Intercept]"     
[183] "r_ID[10309,Intercept]"      "r_ID[10310,Intercept]"     
[185] "r_ID[10311,Intercept]"      "r_ID[10312,Intercept]"     
[187] "r_ID[10313,Intercept]"      "r_ID[10314,Intercept]"     
[189] "r_ID[10315,Intercept]"      "r_ID[10316,Intercept]"     
[191] "r_ID[10317,Intercept]"      "r_ID[10318,Intercept]"     
[193] "r_ID[10319,Intercept]"      "r_ID[10320,Intercept]"     
[195] "r_ID[10322,Intercept]"      "r_ID[10323,Intercept]"     
[197] "r_ID[10324,Intercept]"      "r_ID[10325,Intercept]"     
[199] "r_ID[10326,Intercept]"      "r_ID[10327,Intercept]"     
[201] "r_ID[10328,Intercept]"      "r_ID[10329,Intercept]"     
[203] "r_ID[10330,Intercept]"      "r_ID[10331,Intercept]"     
[205] "r_ID[10332,Intercept]"      "r_ID[10333,Intercept]"     
[207] "r_ID[10335,Intercept]"      "r_ID[10336,Intercept]"     
[209] "r_ID[10337,Intercept]"      "r_ID[10338,Intercept]"     
[211] "r_ID[10340,Intercept]"      "r_ID[10341,Intercept]"     
[213] "r_ID[10342,Intercept]"      "r_ID[10343,Intercept]"     
[215] "r_ID[10345,Intercept]"      "r_ID[10347,Intercept]"     
[217] "r_ID[10348,Intercept]"      "r_ID[10349,Intercept]"     
[219] "r_ID[10350,Intercept]"      "r_ID[10351,Intercept]"     
[221] "r_ID[10352,Intercept]"      "r_ID[10353,Intercept]"     
[223] "r_ID[10354,Intercept]"      "r_ID[10357,Intercept]"     
[225] "r_ID[10358,Intercept]"      "r_ID[10359,Intercept]"     
[227] "r_ID[10360,Intercept]"      "r_ID[10361,Intercept]"     
[229] "r_ID[10363,Intercept]"      "r_ID[10364,Intercept]"     
[231] "r_ID[10365,Intercept]"      "r_ID[10366,Intercept]"     
[233] "r_ID[10367,Intercept]"      "r_ID[10368,Intercept]"     
[235] "r_ID[10369,Intercept]"      "r_ID[10370,Intercept]"     
[237] "r_ID[10371,Intercept]"      "r_ID[10372,Intercept]"     
[239] "r_ID[10373,Intercept]"      "r_ID[10374,Intercept]"     
[241] "r_ID[10378,Intercept]"      "r_ID[10379,Intercept]"     
[243] "r_ID[10380,Intercept]"      "r_ID[10381,Intercept]"     
[245] "r_ID[10382,Intercept]"      "r_ID[10383,Intercept]"     
[247] "r_ID[10384,Intercept]"      "r_ID[10386,Intercept]"     
[249] "r_ID[10388,Intercept]"      "r_ID[10389,Intercept]"     
[251] "r_ID[10390,Intercept]"      "r_ID[10391,Intercept]"     
[253] "r_ID[10392,Intercept]"      "r_ID[10394,Intercept]"     
[255] "r_ID[10397,Intercept]"      "r_ID[10398,Intercept]"     
[257] "r_ID[10399,Intercept]"      "r_ID[10402,Intercept]"     
[259] "r_ID[10404,Intercept]"      "r_ID[10407,Intercept]"     
[261] "r_ID[10408,Intercept]"      "r_ID[10409,Intercept]"     
[263] "r_ID[10411,Intercept]"      "r_ID[10412,Intercept]"     
[265] "r_ID[10413,Intercept]"      "r_ID[10414,Intercept]"     
[267] "r_ID[10415,Intercept]"      "r_ID[10418,Intercept]"     
[269] "r_ID[10421,Intercept]"      "r_ID[10422,Intercept]"     
[271] "r_ID[10423,Intercept]"      "r_ID[10426,Intercept]"     
[273] "r_ID[10427,Intercept]"      "r_ID[10428,Intercept]"     
[275] "r_ID[10429,Intercept]"      "r_ID[10431,Intercept]"     
[277] "r_ID[10432,Intercept]"      "r_ID[10433,Intercept]"     
[279] "r_ID[10434,Intercept]"      "r_ID[10435,Intercept]"     
[281] "r_ID[10436,Intercept]"      "r_ID[10437,Intercept]"     
[283] "r_ID[10438,Intercept]"      "r_ID[10439,Intercept]"     
[285] "r_ID[10440,Intercept]"      "r_ID[10441,Intercept]"     
[287] "r_ID[10442,Intercept]"      "r_ID[10444,Intercept]"     
[289] "r_ID[10445,Intercept]"      "r_ID[10447,Intercept]"     
[291] "r_ID[10448,Intercept]"      "r_ID[10449,Intercept]"     
[293] "r_ID[10450,Intercept]"      "r_ID[10451,Intercept]"     
[295] "r_ID[10452,Intercept]"      "r_ID[10453,Intercept]"     
[297] "r_ID[10454,Intercept]"      "r_ID[10455,Intercept]"     
[299] "r_ID[10456,Intercept]"      "r_ID[10457,Intercept]"     
[301] "r_ID[10459,Intercept]"      "r_ID[10460,Intercept]"     
[303] "r_ID[10461,Intercept]"      "r_ID[10462,Intercept]"     
[305] "r_ID[10463,Intercept]"      "r_ID[10465,Intercept]"     
[307] "r_ID[10466,Intercept]"      "r_ID[10469,Intercept]"     
[309] "r_ID[10470,Intercept]"      "r_ID[10471,Intercept]"     
[311] "r_ID[10472,Intercept]"      "r_ID[10473,Intercept]"     
[313] "r_ID[10474,Intercept]"      "r_ID[10475,Intercept]"     
[315] "r_ID[10476,Intercept]"      "r_ID[10477,Intercept]"     
[317] "r_ID[10479,Intercept]"      "r_ID[10480,Intercept]"     
[319] "r_ID[10481,Intercept]"      "r_ID[10483,Intercept]"     
[321] "r_ID[10484,Intercept]"      "r_ID[10485,Intercept]"     
[323] "r_ID[10486,Intercept]"      "r_ID[10487,Intercept]"     
[325] "r_ID[10488,Intercept]"      "r_ID[10490,Intercept]"     
[327] "r_ID[10492,Intercept]"      "r_ID[10493,Intercept]"     
[329] "r_ID[10494,Intercept]"      "r_ID[10495,Intercept]"     
[331] "r_ID[10496,Intercept]"      "r_ID[10497,Intercept]"     
[333] "r_ID[10498,Intercept]"      "r_ID[10500,Intercept]"     
[335] "r_ID[10503,Intercept]"      "r_ID[10506,Intercept]"     
[337] "r_ID[10508,Intercept]"      "r_ID[10509,Intercept]"     
[339] "r_ID[10510,Intercept]"      "r_ID[10511,Intercept]"     
[341] "r_ID[10512,Intercept]"      "r_ID[10513,Intercept]"     
[343] "r_ID[10515,Intercept]"      "r_ID[10516,Intercept]"     
[345] "r_ID[10517,Intercept]"      "r_ID[10518,Intercept]"     
[347] "r_ID[10522,Intercept]"      "r_ID[10523,Intercept]"     
[349] "r_ID[10524,Intercept]"      "r_ID[10525,Intercept]"     
[351] "r_ID[10526,Intercept]"      "r_ID[10528,Intercept]"     
[353] "r_ID[10529,Intercept]"      "r_ID[10530,Intercept]"     
[355] "r_ID[10532,Intercept]"      "r_ID[10533,Intercept]"     
[357] "r_ID[10535,Intercept]"      "r_ID[10536,Intercept]"     
[359] "r_ID[10537,Intercept]"      "r_ID[10538,Intercept]"     
[361] "r_ID[10539,Intercept]"      "r_ID[10540,Intercept]"     
[363] "r_ID[10541,Intercept]"      "r_ID[10542,Intercept]"     
[365] "r_ID[10543,Intercept]"      "r_ID[10544,Intercept]"     
[367] "r_ID[10545,Intercept]"      "r_ID[10547,Intercept]"     
[369] "r_ID[10549,Intercept]"      "r_ID[10550,Intercept]"     
[371] "r_ID[81,W.other]"           "r_ID[86,W.other]"          
[373] "r_ID[87,W.other]"           "r_ID[88,W.other]"          
[375] "r_ID[89,W.other]"           "r_ID[90,W.other]"          
[377] "r_ID[91,W.other]"           "r_ID[92,W.other]"          
[379] "r_ID[93,W.other]"           "r_ID[94,W.other]"          
[381] "r_ID[95,W.other]"           "r_ID[97,W.other]"          
[383] "r_ID[98,W.other]"           "r_ID[100,W.other]"         
[385] "r_ID[101,W.other]"          "r_ID[102,W.other]"         
[387] "r_ID[104,W.other]"          "r_ID[10105,W.other]"       
[389] "r_ID[10106,W.other]"        "r_ID[10107,W.other]"       
[391] "r_ID[10108,W.other]"        "r_ID[10109,W.other]"       
[393] "r_ID[10110,W.other]"        "r_ID[10111,W.other]"       
[395] "r_ID[10112,W.other]"        "r_ID[10113,W.other]"       
[397] "r_ID[10114,W.other]"        "r_ID[10116,W.other]"       
[399] "r_ID[10117,W.other]"        "r_ID[10118,W.other]"       
[401] "r_ID[10121,W.other]"        "r_ID[10122,W.other]"       
[403] "r_ID[10123,W.other]"        "r_ID[10124,W.other]"       
[405] "r_ID[10125,W.other]"        "r_ID[10126,W.other]"       
[407] "r_ID[10127,W.other]"        "r_ID[10128,W.other]"       
[409] "r_ID[10129,W.other]"        "r_ID[10130,W.other]"       
[411] "r_ID[10131,W.other]"        "r_ID[10132,W.other]"       
[413] "r_ID[10133,W.other]"        "r_ID[10134,W.other]"       
[415] "r_ID[10136,W.other]"        "r_ID[10137,W.other]"       
[417] "r_ID[10138,W.other]"        "r_ID[10139,W.other]"       
[419] "r_ID[10141,W.other]"        "r_ID[10143,W.other]"       
[421] "r_ID[10144,W.other]"        "r_ID[10145,W.other]"       
[423] "r_ID[10147,W.other]"        "r_ID[10148,W.other]"       
[425] "r_ID[10149,W.other]"        "r_ID[10150,W.other]"       
[427] "r_ID[10151,W.other]"        "r_ID[10153,W.other]"       
[429] "r_ID[10154,W.other]"        "r_ID[10155,W.other]"       
[431] "r_ID[10157,W.other]"        "r_ID[10158,W.other]"       
[433] "r_ID[10159,W.other]"        "r_ID[10160,W.other]"       
[435] "r_ID[10161,W.other]"        "r_ID[10162,W.other]"       
[437] "r_ID[10164,W.other]"        "r_ID[10166,W.other]"       
[439] "r_ID[10167,W.other]"        "r_ID[10171,W.other]"       
[441] "r_ID[10172,W.other]"        "r_ID[10173,W.other]"       
[443] "r_ID[10174,W.other]"        "r_ID[10175,W.other]"       
[445] "r_ID[10176,W.other]"        "r_ID[10177,W.other]"       
[447] "r_ID[10178,W.other]"        "r_ID[10180,W.other]"       
[449] "r_ID[10181,W.other]"        "r_ID[10184,W.other]"       
[451] "r_ID[10185,W.other]"        "r_ID[10186,W.other]"       
[453] "r_ID[10187,W.other]"        "r_ID[10188,W.other]"       
[455] "r_ID[10190,W.other]"        "r_ID[10192,W.other]"       
[457] "r_ID[10193,W.other]"        "r_ID[10194,W.other]"       
[459] "r_ID[10195,W.other]"        "r_ID[10196,W.other]"       
[461] "r_ID[10197,W.other]"        "r_ID[10198,W.other]"       
[463] "r_ID[10199,W.other]"        "r_ID[10200,W.other]"       
[465] "r_ID[10201,W.other]"        "r_ID[10202,W.other]"       
[467] "r_ID[10203,W.other]"        "r_ID[10204,W.other]"       
[469] "r_ID[10205,W.other]"        "r_ID[10206,W.other]"       
[471] "r_ID[10207,W.other]"        "r_ID[10208,W.other]"       
[473] "r_ID[10210,W.other]"        "r_ID[10211,W.other]"       
[475] "r_ID[10212,W.other]"        "r_ID[10213,W.other]"       
[477] "r_ID[10214,W.other]"        "r_ID[10215,W.other]"       
[479] "r_ID[10216,W.other]"        "r_ID[10217,W.other]"       
[481] "r_ID[10219,W.other]"        "r_ID[10220,W.other]"       
[483] "r_ID[10221,W.other]"        "r_ID[10222,W.other]"       
[485] "r_ID[10223,W.other]"        "r_ID[10226,W.other]"       
[487] "r_ID[10227,W.other]"        "r_ID[10228,W.other]"       
[489] "r_ID[10229,W.other]"        "r_ID[10230,W.other]"       
[491] "r_ID[10231,W.other]"        "r_ID[10232,W.other]"       
[493] "r_ID[10233,W.other]"        "r_ID[10234,W.other]"       
[495] "r_ID[10236,W.other]"        "r_ID[10237,W.other]"       
[497] "r_ID[10238,W.other]"        "r_ID[10239,W.other]"       
[499] "r_ID[10240,W.other]"        "r_ID[10241,W.other]"       
[501] "r_ID[10242,W.other]"        "r_ID[10243,W.other]"       
[503] "r_ID[10244,W.other]"        "r_ID[10245,W.other]"       
[505] "r_ID[10247,W.other]"        "r_ID[10248,W.other]"       
[507] "r_ID[10249,W.other]"        "r_ID[10250,W.other]"       
[509] "r_ID[10251,W.other]"        "r_ID[10253,W.other]"       
[511] "r_ID[10255,W.other]"        "r_ID[10256,W.other]"       
[513] "r_ID[10258,W.other]"        "r_ID[10259,W.other]"       
[515] "r_ID[10260,W.other]"        "r_ID[10266,W.other]"       
[517] "r_ID[10267,W.other]"        "r_ID[10268,W.other]"       
[519] "r_ID[10269,W.other]"        "r_ID[10270,W.other]"       
[521] "r_ID[10271,W.other]"        "r_ID[10272,W.other]"       
[523] "r_ID[10273,W.other]"        "r_ID[10274,W.other]"       
[525] "r_ID[10275,W.other]"        "r_ID[10276,W.other]"       
[527] "r_ID[10277,W.other]"        "r_ID[10280,W.other]"       
[529] "r_ID[10281,W.other]"        "r_ID[10285,W.other]"       
[531] "r_ID[10286,W.other]"        "r_ID[10287,W.other]"       
[533] "r_ID[10288,W.other]"        "r_ID[10289,W.other]"       
[535] "r_ID[10290,W.other]"        "r_ID[10291,W.other]"       
[537] "r_ID[10292,W.other]"        "r_ID[10293,W.other]"       
[539] "r_ID[10294,W.other]"        "r_ID[10295,W.other]"       
[541] "r_ID[10296,W.other]"        "r_ID[10299,W.other]"       
[543] "r_ID[10301,W.other]"        "r_ID[10304,W.other]"       
[545] "r_ID[10305,W.other]"        "r_ID[10308,W.other]"       
[547] "r_ID[10309,W.other]"        "r_ID[10310,W.other]"       
[549] "r_ID[10311,W.other]"        "r_ID[10312,W.other]"       
[551] "r_ID[10313,W.other]"        "r_ID[10314,W.other]"       
[553] "r_ID[10315,W.other]"        "r_ID[10316,W.other]"       
[555] "r_ID[10317,W.other]"        "r_ID[10318,W.other]"       
[557] "r_ID[10319,W.other]"        "r_ID[10320,W.other]"       
[559] "r_ID[10322,W.other]"        "r_ID[10323,W.other]"       
[561] "r_ID[10324,W.other]"        "r_ID[10325,W.other]"       
[563] "r_ID[10326,W.other]"        "r_ID[10327,W.other]"       
[565] "r_ID[10328,W.other]"        "r_ID[10329,W.other]"       
[567] "r_ID[10330,W.other]"        "r_ID[10331,W.other]"       
[569] "r_ID[10332,W.other]"        "r_ID[10333,W.other]"       
[571] "r_ID[10335,W.other]"        "r_ID[10336,W.other]"       
[573] "r_ID[10337,W.other]"        "r_ID[10338,W.other]"       
[575] "r_ID[10340,W.other]"        "r_ID[10341,W.other]"       
[577] "r_ID[10342,W.other]"        "r_ID[10343,W.other]"       
[579] "r_ID[10345,W.other]"        "r_ID[10347,W.other]"       
[581] "r_ID[10348,W.other]"        "r_ID[10349,W.other]"       
[583] "r_ID[10350,W.other]"        "r_ID[10351,W.other]"       
[585] "r_ID[10352,W.other]"        "r_ID[10353,W.other]"       
[587] "r_ID[10354,W.other]"        "r_ID[10357,W.other]"       
[589] "r_ID[10358,W.other]"        "r_ID[10359,W.other]"       
[591] "r_ID[10360,W.other]"        "r_ID[10361,W.other]"       
[593] "r_ID[10363,W.other]"        "r_ID[10364,W.other]"       
[595] "r_ID[10365,W.other]"        "r_ID[10366,W.other]"       
[597] "r_ID[10367,W.other]"        "r_ID[10368,W.other]"       
[599] "r_ID[10369,W.other]"        "r_ID[10370,W.other]"       
[601] "r_ID[10371,W.other]"        "r_ID[10372,W.other]"       
[603] "r_ID[10373,W.other]"        "r_ID[10374,W.other]"       
[605] "r_ID[10378,W.other]"        "r_ID[10379,W.other]"       
[607] "r_ID[10380,W.other]"        "r_ID[10381,W.other]"       
[609] "r_ID[10382,W.other]"        "r_ID[10383,W.other]"       
[611] "r_ID[10384,W.other]"        "r_ID[10386,W.other]"       
[613] "r_ID[10388,W.other]"        "r_ID[10389,W.other]"       
[615] "r_ID[10390,W.other]"        "r_ID[10391,W.other]"       
[617] "r_ID[10392,W.other]"        "r_ID[10394,W.other]"       
[619] "r_ID[10397,W.other]"        "r_ID[10398,W.other]"       
[621] "r_ID[10399,W.other]"        "r_ID[10402,W.other]"       
[623] "r_ID[10404,W.other]"        "r_ID[10407,W.other]"       
[625] "r_ID[10408,W.other]"        "r_ID[10409,W.other]"       
[627] "r_ID[10411,W.other]"        "r_ID[10412,W.other]"       
[629] "r_ID[10413,W.other]"        "r_ID[10414,W.other]"       
[631] "r_ID[10415,W.other]"        "r_ID[10418,W.other]"       
[633] "r_ID[10421,W.other]"        "r_ID[10422,W.other]"       
[635] "r_ID[10423,W.other]"        "r_ID[10426,W.other]"       
[637] "r_ID[10427,W.other]"        "r_ID[10428,W.other]"       
[639] "r_ID[10429,W.other]"        "r_ID[10431,W.other]"       
[641] "r_ID[10432,W.other]"        "r_ID[10433,W.other]"       
[643] "r_ID[10434,W.other]"        "r_ID[10435,W.other]"       
[645] "r_ID[10436,W.other]"        "r_ID[10437,W.other]"       
[647] "r_ID[10438,W.other]"        "r_ID[10439,W.other]"       
[649] "r_ID[10440,W.other]"        "r_ID[10441,W.other]"       
[651] "r_ID[10442,W.other]"        "r_ID[10444,W.other]"       
[653] "r_ID[10445,W.other]"        "r_ID[10447,W.other]"       
[655] "r_ID[10448,W.other]"        "r_ID[10449,W.other]"       
[657] "r_ID[10450,W.other]"        "r_ID[10451,W.other]"       
[659] "r_ID[10452,W.other]"        "r_ID[10453,W.other]"       
[661] "r_ID[10454,W.other]"        "r_ID[10455,W.other]"       
[663] "r_ID[10456,W.other]"        "r_ID[10457,W.other]"       
[665] "r_ID[10459,W.other]"        "r_ID[10460,W.other]"       
[667] "r_ID[10461,W.other]"        "r_ID[10462,W.other]"       
[669] "r_ID[10463,W.other]"        "r_ID[10465,W.other]"       
[671] "r_ID[10466,W.other]"        "r_ID[10469,W.other]"       
[673] "r_ID[10470,W.other]"        "r_ID[10471,W.other]"       
[675] "r_ID[10472,W.other]"        "r_ID[10473,W.other]"       
[677] "r_ID[10474,W.other]"        "r_ID[10475,W.other]"       
[679] "r_ID[10476,W.other]"        "r_ID[10477,W.other]"       
[681] "r_ID[10479,W.other]"        "r_ID[10480,W.other]"       
[683] "r_ID[10481,W.other]"        "r_ID[10483,W.other]"       
[685] "r_ID[10484,W.other]"        "r_ID[10485,W.other]"       
[687] "r_ID[10486,W.other]"        "r_ID[10487,W.other]"       
[689] "r_ID[10488,W.other]"        "r_ID[10490,W.other]"       
[691] "r_ID[10492,W.other]"        "r_ID[10493,W.other]"       
[693] "r_ID[10494,W.other]"        "r_ID[10495,W.other]"       
[695] "r_ID[10496,W.other]"        "r_ID[10497,W.other]"       
[697] "r_ID[10498,W.other]"        "r_ID[10500,W.other]"       
[699] "r_ID[10503,W.other]"        "r_ID[10506,W.other]"       
[701] "r_ID[10508,W.other]"        "r_ID[10509,W.other]"       
[703] "r_ID[10510,W.other]"        "r_ID[10511,W.other]"       
[705] "r_ID[10512,W.other]"        "r_ID[10513,W.other]"       
[707] "r_ID[10515,W.other]"        "r_ID[10516,W.other]"       
[709] "r_ID[10517,W.other]"        "r_ID[10518,W.other]"       
[711] "r_ID[10522,W.other]"        "r_ID[10523,W.other]"       
[713] "r_ID[10524,W.other]"        "r_ID[10525,W.other]"       
[715] "r_ID[10526,W.other]"        "r_ID[10528,W.other]"       
[717] "r_ID[10529,W.other]"        "r_ID[10530,W.other]"       
[719] "r_ID[10532,W.other]"        "r_ID[10533,W.other]"       
[721] "r_ID[10535,W.other]"        "r_ID[10536,W.other]"       
[723] "r_ID[10537,W.other]"        "r_ID[10538,W.other]"       
[725] "r_ID[10539,W.other]"        "r_ID[10540,W.other]"       
[727] "r_ID[10541,W.other]"        "r_ID[10542,W.other]"       
[729] "r_ID[10543,W.other]"        "r_ID[10544,W.other]"       
[731] "r_ID[10545,W.other]"        "r_ID[10547,W.other]"       
[733] "r_ID[10549,W.other]"        "r_ID[10550,W.other]"       
[735] "prior_Intercept"            "prior_b"                   
[737] "prior_sigma"                "prior_sd_ID__Intercept"    
[739] "prior_sd_ID__W.other"       "prior_cor_ID"              
[741] "lprior"                     "lp__"                      
[743] "accept_stat__"              "treedepth__"               
[745] "stepsize__"                 "divergent__"               
[747] "n_leapfrog__"               "energy__"                  </code></pre>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mlm<span class="fl">.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: PA ~ 1 + W.other + (1 + W.other | ID) 
   Data: esm (Number of observations: 9461) 
  Draws: 4 chains, each with iter = 4000; warmup = 1000; thin = 1;
         total post-warmup draws = 12000

Group-Level Effects: 
~ID (Number of levels: 364) 
                       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
sd(Intercept)              0.50      0.03     0.44     0.55 1.00     4405
sd(W.other)                0.18      0.04     0.10     0.26 1.00     1251
cor(Intercept,W.other)    -0.43      0.11    -0.63    -0.19 1.00    10095
                       Tail_ESS
sd(Intercept)              7218
sd(W.other)                1834
cor(Intercept,W.other)     6956

Population-Level Effects: 
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept     3.15      0.04     3.08     3.22 1.00     5313     7266
W.other       0.32      0.03     0.27     0.37 1.00    15524     9887

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.85      0.01     0.84     0.86 1.00    17740     8791

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>partially_pooled_params2 <span class="ot">&lt;-</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(mlm<span class="fl">.5</span>)<span class="sc">$</span>ID [ , <span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">%&gt;%</span></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"ID"</span>) </span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>un_pooled_params <span class="ot">&lt;-</span></span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>  esm <span class="sc">%&gt;%</span></span>
<span id="cb161-8"><a href="#cb161-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((<span class="sc">!</span><span class="fu">is.na</span>(PA))) <span class="sc">%&gt;%</span> </span>
<span id="cb161-9"><a href="#cb161-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, W.other) <span class="sc">%&gt;%</span></span>
<span id="cb161-10"><a href="#cb161-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(PA)) <span class="sc">%&gt;%</span></span>
<span id="cb161-11"><a href="#cb161-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do</span>(<span class="fu">tidy</span>(<span class="fu">lm</span>(mean <span class="sc">~</span> W.other, <span class="at">data=</span>.))) <span class="sc">%&gt;%</span> </span>
<span id="cb161-12"><a href="#cb161-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb161-13"><a href="#cb161-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, term, estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb161-14"><a href="#cb161-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb161-15"><a href="#cb161-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Intercept =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb161-16"><a href="#cb161-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb161-17"><a href="#cb161-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#select(-`Intercept`) %&gt;% </span></span>
<span id="cb161-18"><a href="#cb161-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">as.character</span>(ID))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'ID'. You can override using the `.groups`
argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># `bind_rows()` will stack the second tibble below the first</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(partially_pooled_params2, un_pooled_params) <span class="sc">%&gt;%</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># index whether the estimates are pooled</span></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pooled =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"partially"</span>, <span class="st">"not"</span>), <span class="at">each =</span> <span class="fu">nrow</span>(.)<span class="sc">/</span><span class="dv">2</span>)) </span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> params, <span class="fu">aes</span>(<span class="at">x =</span> W.other, <span class="at">y =</span> Intercept)) <span class="sc">+</span></span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">group =</span> ID, <span class="at">color =</span> pooled)) <span class="sc">+</span></span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> ID), <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">"Pooled?"</span>,</span>
<span id="cb163-12"><a href="#cb163-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#80A0C7"</span>, <span class="st">"#A65141"</span>)) <span class="sc">+</span> <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>) </span>
<span id="cb163-13"><a href="#cb163-13" aria-hidden="true" tabindex="-1"></a>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 157 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 157 rows containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.5</span> <span class="sc">%&gt;%</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(b_W.other, r_ID[ID, term]) <span class="sc">%&gt;%</span></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"W.other"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(<span class="at">person_t =</span> b_W.other <span class="sc">+</span> r_ID) <span class="sc">%&gt;%</span></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>( <span class="at">y =</span> <span class="fu">reorder</span>(ID, person_t), <span class="at">x =</span> person_t, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="at">alpha =</span> .<span class="dv">1</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"est"</span>)  <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y=</span><span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>esm <span class="ot">&lt;-</span> esm <span class="sc">%&gt;%</span> </span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span> </span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">W.other.pm =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">W.other</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(W.other.pm)) <span class="sc">%&gt;%</span>   </span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">W.other.pc =</span> W.other <span class="sc">-</span> W.other.pm) <span class="sc">%&gt;%</span> </span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">W.other.gmc =</span>W.other.pm  <span class="sc">-</span> <span class="fu">mean</span> (W.other.pm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.6</span> <span class="ot">&lt;-</span> </span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">family =</span> gaussian,</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>      PA <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> W.other.pc  <span class="sc">+</span>  W.other.gmc <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> W.other.pc  <span class="sc">|</span> ID),</span>
<span id="cb168-4"><a href="#cb168-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb168-5"><a href="#cb168-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">class =</span> b),</span>
<span id="cb168-6"><a href="#cb168-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">10</span>, <span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> Intercept, <span class="at">group =</span> ID), </span>
<span id="cb168-7"><a href="#cb168-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">10</span>, <span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">coef =</span> W.other.pc, <span class="at">group =</span> ID), </span>
<span id="cb168-8"><a href="#cb168-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb168-9"><a href="#cb168-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">10</span>), <span class="at">class =</span> cor)),</span>
<span id="cb168-10"><a href="#cb168-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">4000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb168-11"><a href="#cb168-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">"mlm.6"</span>,</span>
<span id="cb168-12"><a href="#cb168-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">"cmdstanr"</span>,</span>
<span id="cb168-13"><a href="#cb168-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> esm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mlm<span class="fl">.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: gaussian 
  Links: mu = identity; sigma = identity 
Formula: PA ~ 1 + W.other.pc + W.other.gmc + (1 + W.other.pc | ID) 
   Data: esm (Number of observations: 8321) 
  Draws: 4 chains, each with iter = 4000; warmup = 1000; thin = 1;
         total post-warmup draws = 12000

Group-Level Effects: 
~ID (Number of levels: 326) 
                          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
sd(Intercept)                 0.45      0.02     0.41     0.50 1.00     1758
sd(W.other.pc)                0.20      0.04     0.12     0.28 1.00     3702
cor(Intercept,W.other.pc)    -0.25      0.13    -0.51     0.00 1.00     9630
                          Tail_ESS
sd(Intercept)                 4293
sd(W.other.pc)                5292
cor(Intercept,W.other.pc)     8296

Population-Level Effects: 
            Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept       3.40      0.03     3.34     3.45 1.00     1698     3188
W.other.pc      0.33      0.03     0.28     0.39 1.00    10487     9038
W.other.gmc     0.86      0.18     0.51     1.22 1.00     1963     3738

Family Specific Parameters: 
      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sigma     0.86      0.01     0.84     0.87 1.00    14321     9005

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>partially_pooled_params3 <span class="ot">&lt;-</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(mlm<span class="fl">.6</span>)<span class="sc">$</span>ID [ , <span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">%&gt;%</span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"ID"</span>) </span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-6"><a href="#cb171-6" aria-hidden="true" tabindex="-1"></a>un_pooled_params2 <span class="ot">&lt;-</span></span>
<span id="cb171-7"><a href="#cb171-7" aria-hidden="true" tabindex="-1"></a>  esm <span class="sc">%&gt;%</span></span>
<span id="cb171-8"><a href="#cb171-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>((<span class="sc">!</span><span class="fu">is.na</span>(PA))) <span class="sc">%&gt;%</span> </span>
<span id="cb171-9"><a href="#cb171-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, W.other.pc) <span class="sc">%&gt;%</span></span>
<span id="cb171-10"><a href="#cb171-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(PA)) <span class="sc">%&gt;%</span></span>
<span id="cb171-11"><a href="#cb171-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do</span>(<span class="fu">tidy</span>(<span class="fu">lm</span>(mean <span class="sc">~</span> W.other.pc, <span class="at">data=</span>.))) <span class="sc">%&gt;%</span> </span>
<span id="cb171-12"><a href="#cb171-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb171-13"><a href="#cb171-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, term, estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb171-14"><a href="#cb171-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> term, <span class="at">values_from =</span> estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb171-15"><a href="#cb171-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Intercept =</span> <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb171-16"><a href="#cb171-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb171-17"><a href="#cb171-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#select(-`Intercept`) %&gt;% </span></span>
<span id="cb171-18"><a href="#cb171-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">as.character</span>(ID))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'ID'. You can override using the `.groups`
argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a>params2 <span class="ot">&lt;-</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># `bind_rows()` will stack the second tibble below the first</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(partially_pooled_params3, un_pooled_params2) <span class="sc">%&gt;%</span></span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># index whether the estimates are pooled</span></span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pooled =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"partially"</span>, <span class="st">"not"</span>), <span class="at">each =</span> <span class="fu">nrow</span>(.)<span class="sc">/</span><span class="dv">2</span>)) </span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb173-8"><a href="#cb173-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> params2, <span class="fu">aes</span>(<span class="at">x =</span> W.other.pc, <span class="at">y =</span> Intercept, <span class="at">group =</span> pooled)) <span class="sc">+</span></span>
<span id="cb173-9"><a href="#cb173-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">group =</span> ID, <span class="at">color =</span> pooled)) <span class="sc">+</span></span>
<span id="cb173-10"><a href="#cb173-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> ID), <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb173-11"><a href="#cb173-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">"Pooled?"</span>,</span>
<span id="cb173-12"><a href="#cb173-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#80A0C7"</span>, <span class="st">"#A65141"</span>)) <span class="sc">+</span></span>
<span id="cb173-13"><a href="#cb173-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">1</span>,<span class="dv">5</span>)</span>
<span id="cb173-14"><a href="#cb173-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-15"><a href="#cb173-15" aria-hidden="true" tabindex="-1"></a>p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 143 rows containing missing values (`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 143 rows containing missing values (`geom_line()`).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>mlm<span class="fl">.6</span> <span class="sc">%&gt;%</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(b_W.other.pc, r_ID[ID, term]) <span class="sc">%&gt;%</span></span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">==</span> <span class="st">"W.other.pc"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(<span class="at">person_t =</span> b_W.other.pc <span class="sc">+</span> r_ID) <span class="sc">%&gt;%</span></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>( <span class="at">y =</span> <span class="fu">reorder</span>(ID, person_t), <span class="at">x =</span> person_t, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper)) <span class="sc">+</span></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="at">alpha =</span> .<span class="dv">1</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">"est"</span>)  <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.y=</span><span class="fu">element_blank</span>(),</span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y=</span><span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="making-predictions" class="level2">
<h2 class="anchored" data-anchor-id="making-predictions">Making predictions</h2>
<p>We often want to make predictions for different groups or individuals. The previous slide is one example. We made these predictions using/borrowing information from other individuals, through partial pooling. This improves our predictions.</p>
<p>Can we improve it further? Think about predictions in presidential races, or think about if we want to make some decision for a cancer drug. Do we stick with these standard MLM based predictions?</p>
</section>
<section id="mr.-p" class="level2">
<h2 class="anchored" data-anchor-id="mr.-p">Mr.&nbsp;P</h2>
<p>Improving predictions by incorporating outside (of the model) information. MRP = multilevel regression with poststratification</p>
<p>One of the biggest problems with psych data is that it is unrepresentative. (Do you trust undergrads or adults off the street wanting to help science?) Often survey weights are used. But if we know the distribution of the broader population, we can reweight (post-stratify) our results to get more accurate estimates. Instead of making assumptions about how the observed sample was produced from the population, we make assumptions about how the observed sample can be used to reconstruct the rest of the population</p>
</section>
<section id="mr.p" class="level2">
<h2 class="anchored" data-anchor-id="mr.p">Mr.P</h2>
<p>Mr = Multi-level regression aka MLM P = poststratification, with post for posterior and stratification for stratify.</p>
<p>You take your posterior and make predictions based on different strata</p>
<p>Weighted average of predicted values, where weights are the population shares of each category</p>
</section>
<section id="weighting-vs-postratifying" class="level2">
<h2 class="anchored" data-anchor-id="weighting-vs-postratifying">Weighting vs postratifying</h2>
<p>Weighting is done all the time with data. It gives more or less “weight” to observations that are over or under sampled. Some people “count” more than others in the service of getting data that represents some population.</p>
<p>Poststratification is similar in that it weights the posterior samples rather than the observations.</p>
<p>Why is this preferred? A few reasons, but mainly one can make generalization to new groups or groups with little data. Rather than weighting those specific individuals, partial pooling from other information will help with learning</p>
<hr>
<p>What do we need? A reliable data source (such as a census) that gives us the population weights. Data can be re-weighted based on many different categories, not just one: for example, we could post-stratify based on age, education, state of residence, etc.</p>
<p>Don’t need to even attempt a random sample. All we need is a sample that is large and diverse enough + population data (e.g., from the census).</p>
<hr>
<p>Estimating the proportion of heterosexual women who kept their maiden name after marriage.</p>
<p>https://www.monicaalexander.com/posts/2019-08-07-mrp/ https://bookdown.org/content/4857/models-with-memory.html#summary-bonus-post-stratification-in-an-example</p>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>mrp <span class="ot">&lt;-</span><span class="fu">load</span>(<span class="st">"mrp.rds"</span>)</span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>mrp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "d"           "cell_counts"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,413 × 5
   kept_name state_name     age_group decade_married educ_group
       &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;     &lt;chr&gt;          &lt;chr&gt;     
 1         0 ohio           50        1979           &gt;BA       
 2         0 virginia       35        1999           &gt;BA       
 3         1 new york       35        2009           &gt;BA       
 4         0 rhode island   55        1999           &gt;BA       
 5         0 illinois       35        2009           &gt;BA       
 6         0 north carolina 25        2009           &gt;BA       
 7         1 iowa           35        1999           &gt;BA       
 8         1 texas          35        2009           &gt;BA       
 9         0 south dakota   35        1999           &gt;BA       
10         0 texas          35        2009           &gt;BA       
# ℹ 4,403 more rows</code></pre>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>cell_counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,058 × 5
   state_name age_group decade_married educ_group     n
   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;          &lt;chr&gt;      &lt;dbl&gt;
 1 alabama    25        1999           &lt;BA        19012
 2 alabama    25        2009           &lt;BA        37488
 3 alabama    25        1999           &gt;BA          959
 4 alabama    25        2009           &gt;BA         5319
 5 alabama    25        1999           BA          2986
 6 alabama    25        2009           BA         14261
 7 alaska     25        1999           &lt;BA         3320
 8 alaska     25        2009           &lt;BA         7001
 9 alaska     25        1999           &gt;BA          159
10 alaska     25        2009           &gt;BA          435
# ℹ 6,048 more rows</code></pre>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>mlm.mrp <span class="ot">&lt;-</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">family =</span> binomial,</span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>      kept_name <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> age_group) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> decade_married) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> educ_group) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> state_name),</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd)),</span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">98</span>),</span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> d,</span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">backend =</span> <span class="st">"cmdstanr"</span>,</span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">"mlm.mrp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mlm.mrp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Family: binomial 
  Links: mu = logit 
Formula: kept_name | trials(1) ~ 1 + (1 | age_group) + (1 | decade_married) + (1 | educ_group) + (1 | state_name) 
   Data: d (Number of observations: 4373) 
  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
         total post-warmup draws = 4000

Group-Level Effects: 
~age_group (Number of levels: 11) 
              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)     1.15      0.29     0.72     1.88 1.00     1470     2235

~decade_married (Number of levels: 5) 
              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)     1.00      0.39     0.49     2.03 1.00     2246     2946

~educ_group (Number of levels: 4) 
              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)     0.92      0.49     0.35     2.17 1.00     2553     2773

~state_name (Number of levels: 52) 
              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
sd(Intercept)     0.25      0.06     0.15     0.38 1.00     1407     2328

Population-Level Effects: 
          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
Intercept    -0.72      0.63    -1.99     0.50 1.00     1966     2475

Draws were sampled using sample(hmc). For each parameter, Bulk_ESS
and Tail_ESS are effective sample size measures, and Rhat is the potential
scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_variables</span>(mlm.mrp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "b_Intercept"                                 
 [2] "sd_age_group__Intercept"                     
 [3] "sd_decade_married__Intercept"                
 [4] "sd_educ_group__Intercept"                    
 [5] "sd_state_name__Intercept"                    
 [6] "r_age_group[25,Intercept]"                   
 [7] "r_age_group[30,Intercept]"                   
 [8] "r_age_group[35,Intercept]"                   
 [9] "r_age_group[40,Intercept]"                   
[10] "r_age_group[45,Intercept]"                   
[11] "r_age_group[50,Intercept]"                   
[12] "r_age_group[55,Intercept]"                   
[13] "r_age_group[60,Intercept]"                   
[14] "r_age_group[65,Intercept]"                   
[15] "r_age_group[70,Intercept]"                   
[16] "r_age_group[75,Intercept]"                   
[17] "r_decade_married[1979,Intercept]"            
[18] "r_decade_married[1989,Intercept]"            
[19] "r_decade_married[1999,Intercept]"            
[20] "r_decade_married[2009,Intercept]"            
[21] "r_decade_married[2019,Intercept]"            
[22] "r_educ_group[&lt;BA,Intercept]"                 
[23] "r_educ_group[&gt;BA,Intercept]"                 
[24] "r_educ_group[BA,Intercept]"                  
[25] "r_educ_group[NA,Intercept]"                  
[26] "r_state_name[alabama,Intercept]"             
[27] "r_state_name[alaska,Intercept]"              
[28] "r_state_name[arizona,Intercept]"             
[29] "r_state_name[arkansas,Intercept]"            
[30] "r_state_name[california,Intercept]"          
[31] "r_state_name[colorado,Intercept]"            
[32] "r_state_name[connecticut,Intercept]"         
[33] "r_state_name[delaware,Intercept]"            
[34] "r_state_name[district.of.columbia,Intercept]"
[35] "r_state_name[florida,Intercept]"             
[36] "r_state_name[georgia,Intercept]"             
[37] "r_state_name[hawaii,Intercept]"              
[38] "r_state_name[idaho,Intercept]"               
[39] "r_state_name[illinois,Intercept]"            
[40] "r_state_name[indiana,Intercept]"             
[41] "r_state_name[iowa,Intercept]"                
[42] "r_state_name[kansas,Intercept]"              
[43] "r_state_name[kentucky,Intercept]"            
[44] "r_state_name[louisiana,Intercept]"           
[45] "r_state_name[maine,Intercept]"               
[46] "r_state_name[maryland,Intercept]"            
[47] "r_state_name[massachusetts,Intercept]"       
[48] "r_state_name[michigan,Intercept]"            
[49] "r_state_name[minnesota,Intercept]"           
[50] "r_state_name[mississippi,Intercept]"         
[51] "r_state_name[missouri,Intercept]"            
[52] "r_state_name[montana,Intercept]"             
[53] "r_state_name[nebraska,Intercept]"            
[54] "r_state_name[nevada,Intercept]"              
[55] "r_state_name[new.hampshire,Intercept]"       
[56] "r_state_name[new.jersey,Intercept]"          
[57] "r_state_name[new.mexico,Intercept]"          
[58] "r_state_name[new.york,Intercept]"            
[59] "r_state_name[north.carolina,Intercept]"      
[60] "r_state_name[north.dakota,Intercept]"        
[61] "r_state_name[ohio,Intercept]"                
[62] "r_state_name[oklahoma,Intercept]"            
[63] "r_state_name[oregon,Intercept]"              
[64] "r_state_name[pennsylvania,Intercept]"        
[65] "r_state_name[puerto.rico,Intercept]"         
[66] "r_state_name[rhode.island,Intercept]"        
[67] "r_state_name[south.carolina,Intercept]"      
[68] "r_state_name[south.dakota,Intercept]"        
[69] "r_state_name[tennessee,Intercept]"           
[70] "r_state_name[texas,Intercept]"               
[71] "r_state_name[utah,Intercept]"                
[72] "r_state_name[vermont,Intercept]"             
[73] "r_state_name[virginia,Intercept]"            
[74] "r_state_name[washington,Intercept]"          
[75] "r_state_name[west.virginia,Intercept]"       
[76] "r_state_name[wisconsin,Intercept]"           
[77] "r_state_name[wyoming,Intercept]"             
[78] "lprior"                                      
[79] "lp__"                                        
[80] "accept_stat__"                               
[81] "treedepth__"                                 
[82] "stepsize__"                                  
[83] "divergent__"                                 
[84] "n_leapfrog__"                                
[85] "energy__"                                    </code></pre>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(mlm.mrp) <span class="sc">%&gt;%</span> </span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"sd_"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">str_c</span>(<span class="st">"sigma["</span>, <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"decade~married"</span>, <span class="st">"education"</span>, <span class="st">"state"</span>), <span class="st">"]"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(<span class="at">.width =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">70</span>, <span class="at">to =</span> .<span class="dv">95</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper, <span class="at">y =</span> <span class="fu">reorder</span>(name, value))) <span class="sc">+</span></span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_interval</span>(<span class="fu">aes</span>(<span class="at">alpha =</span> .width), <span class="at">color =</span> <span class="st">"orange3"</span>) <span class="sc">+</span></span>
<span id="cb188-10"><a href="#cb188-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> ggplot2<span class="sc">:::</span>parse_safe) <span class="sc">+</span></span>
<span id="cb188-11"><a href="#cb188-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_continuous</span>(<span class="st">"CI width"</span>, <span class="at">range =</span> <span class="fu">c</span>(.<span class="dv">7</span>, .<span class="dv">15</span>)) <span class="sc">+</span></span>
<span id="cb188-12"><a href="#cb188-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb188-13"><a href="#cb188-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb188-14"><a href="#cb188-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Method 'posterior_samples' is deprecated. Please see ?as_draws for
recommended alternatives.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>Census data we will use to make predictions. We will make predictions for every combination of variable we are interested in (state, age, decade married, edu)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a>age_prop <span class="ot">&lt;-</span> </span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>  cell_counts <span class="sc">%&gt;%</span> </span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span> </span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>age_prop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6,058 × 6
   state_name age_group decade_married educ_group     n      prop
   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;          &lt;chr&gt;      &lt;dbl&gt;     &lt;dbl&gt;
 1 alabama    25        1999           &lt;BA        19012 0.00414  
 2 alabama    25        2009           &lt;BA        37488 0.00816  
 3 alabama    25        1999           &gt;BA          959 0.000209 
 4 alabama    25        2009           &gt;BA         5319 0.00116  
 5 alabama    25        1999           BA          2986 0.000650 
 6 alabama    25        2009           BA         14261 0.00310  
 7 alaska     25        1999           &lt;BA         3320 0.000723 
 8 alaska     25        2009           &lt;BA         7001 0.00152  
 9 alaska     25        1999           &gt;BA          159 0.0000346
10 alaska     25        2009           &gt;BA          435 0.0000947
# ℹ 6,048 more rows</code></pre>
</div>
</div>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> mlm.mrp <span class="sc">%&gt;%</span> </span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predicted_draws</span>(<span class="at">newdata =</span> age_prop <span class="sc">%&gt;%</span> </span>
<span id="cb192-3"><a href="#cb192-3" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">filter</span>(age_group <span class="sc">&gt;</span> <span class="dv">20</span>, </span>
<span id="cb192-4"><a href="#cb192-4" aria-hidden="true" tabindex="-1"></a>                               age_group <span class="sc">&lt;</span> <span class="dv">80</span>, </span>
<span id="cb192-5"><a href="#cb192-5" aria-hidden="true" tabindex="-1"></a>                               decade_married <span class="sc">&gt;</span> <span class="dv">1969</span>),</span>
<span id="cb192-6"><a href="#cb192-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">allow_new_levels =</span> T)</span>
<span id="cb192-7"><a href="#cb192-7" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24,232,000 × 11
# Groups:   state_name, age_group, decade_married, educ_group, n, prop, .row
#   [6,058]
   state_name age_group decade_married educ_group     n    prop  .row .chain
   &lt;chr&gt;      &lt;chr&gt;     &lt;chr&gt;          &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;  &lt;int&gt;
 1 alabama    25        1999           &lt;BA        19012 0.00414     1     NA
 2 alabama    25        1999           &lt;BA        19012 0.00414     1     NA
 3 alabama    25        1999           &lt;BA        19012 0.00414     1     NA
 4 alabama    25        1999           &lt;BA        19012 0.00414     1     NA
 5 alabama    25        1999           &lt;BA        19012 0.00414     1     NA
 6 alabama    25        1999           &lt;BA        19012 0.00414     1     NA
 7 alabama    25        1999           &lt;BA        19012 0.00414     1     NA
 8 alabama    25        1999           &lt;BA        19012 0.00414     1     NA
 9 alabama    25        1999           &lt;BA        19012 0.00414     1     NA
10 alabama    25        1999           &lt;BA        19012 0.00414     1     NA
# ℹ 24,231,990 more rows
# ℹ 3 more variables: .iteration &lt;int&gt;, .draw &lt;int&gt;, .prediction &lt;int&gt;</code></pre>
</div>
</div>
<p>6,058 census categories * 4,000 samples = 24,232,000</p>
<hr>
<p>If we group the results by age_group and .draw, we can sum the product of the posterior predictions and the weights (prop), which will leave us with 4,000 stratified posterior draws for each of the 11 levels of age_group</p>
<p><span class="math display">\[\frac{\sum_i N_i p_i}{\sum_i N_i}\]</span></p>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>pp <span class="ot">&lt;-</span></span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>  p <span class="sc">%&gt;%</span> </span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group, .draw) <span class="sc">%&gt;%</span> </span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">kept_name_predict =</span> <span class="fu">sum</span>(.prediction <span class="sc">*</span> prop)) <span class="sc">%&gt;%</span> </span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span> </span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(kept_name_predict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'age_group'. You can override using the
`.groups` argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>pp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 7
   age_group kept_name_predict .lower .upper .width .point .interval
   &lt;chr&gt;                 &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
 1 25                    0.175 0.0932  0.277   0.95 mean   qi       
 2 30                    0.182 0.116   0.261   0.95 mean   qi       
 3 35                    0.219 0.149   0.300   0.95 mean   qi       
 4 40                    0.244 0.174   0.325   0.95 mean   qi       
 5 45                    0.279 0.199   0.368   0.95 mean   qi       
 6 50                    0.301 0.220   0.399   0.95 mean   qi       
 7 55                    0.324 0.234   0.423   0.95 mean   qi       
 8 60                    0.438 0.326   0.557   0.95 mean   qi       
 9 65                    0.561 0.419   0.703   0.95 mean   qi       
10 70                    0.515 0.298   0.745   0.95 mean   qi       
11 75                    0.227 0.0455  0.521   0.95 mean   qi       </code></pre>
</div>
</div>
<hr>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"raw data"</span>, <span class="st">"multilevel"</span>, <span class="st">"MRP"</span>)</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the proportions from the data</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group, kept_name) <span class="sc">%&gt;%</span></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span> </span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n),</span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="fu">factor</span>(<span class="st">"raw data"</span>, <span class="at">levels =</span> levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(kept_name <span class="sc">==</span> <span class="dv">1</span>, age_group <span class="sc">&lt;</span> <span class="dv">80</span>, age_group <span class="sc">&gt;</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> prop, <span class="at">y =</span> age_group)) <span class="sc">+</span> </span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb198-14"><a href="#cb198-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb198-15"><a href="#cb198-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'age_group'. You can override using the
`.groups` argument.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">distinct</span>(d, age_group) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(age_group)</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(mlm.mrp,</span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">re_formula =</span> <span class="sc">~</span> (<span class="dv">1</span> <span class="sc">|</span> age_group),</span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> Estimate,</span>
<span id="cb200-10"><a href="#cb200-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="fu">factor</span>(<span class="st">"multilevel"</span>, <span class="at">levels =</span> levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb200-11"><a href="#cb200-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb200-12"><a href="#cb200-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> prop, <span class="at">xmin =</span> Q2<span class="fl">.5</span>, <span class="at">xmax =</span> Q97<span class="fl">.5</span>, <span class="at">y =</span> age_group)) <span class="sc">+</span> </span>
<span id="cb200-13"><a href="#cb200-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">color =</span> <span class="st">"blue2"</span>, <span class="at">size =</span> <span class="fl">0.8</span>, <span class="at">fatten =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb200-14"><a href="#cb200-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb200-15"><a href="#cb200-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb200-16"><a href="#cb200-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type)</span>
<span id="cb200-17"><a href="#cb200-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-18"><a href="#cb200-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-19"><a href="#cb200-19" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span></span>
<span id="cb200-20"><a href="#cb200-20" aria-hidden="true" tabindex="-1"></a>  pp <span class="sc">%&gt;%</span></span>
<span id="cb200-21"><a href="#cb200-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">factor</span>(<span class="st">"MRP"</span>, <span class="at">levels =</span> levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb200-22"><a href="#cb200-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> kept_name_predict, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper, <span class="at">y =</span> age_group)) <span class="sc">+</span> </span>
<span id="cb200-23"><a href="#cb200-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">color =</span> <span class="st">"orange2"</span>, <span class="at">size =</span> <span class="fl">0.8</span>, <span class="at">fatten =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb200-24"><a href="#cb200-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb200-25"><a href="#cb200-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="at">labels =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb200-26"><a href="#cb200-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type)</span>
<span id="cb200-27"><a href="#cb200-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-28"><a href="#cb200-28" aria-hidden="true" tabindex="-1"></a><span class="co"># combine!</span></span>
<span id="cb200-29"><a href="#cb200-29" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">|</span> p2 <span class="sc">|</span> p3) <span class="sc">+</span></span>
<span id="cb200-30"><a href="#cb200-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">"Proportion of women keeping name after marriage, by age"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="mlm-8_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<hr>
<p>Can also be done simply in {marginaleffects}</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">predictions</span>(  <span class="co"># Compute predictions,</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> mod, <span class="co"># using the mlm model `mod`, </span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> stratification, <span class="co"># for each row of the `stratification` table.</span></span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"age"</span>, <span class="co">#select which grouping variable</span></span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">wts =</span> <span class="st">"proportion"</span>) <span class="co">#weight them</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>The general idea is that we can create predictions based on what we want to do with the predictions. Previously when we wanted to plot prediction lines we made predictions across the levels of X. When we want to see observational level variability we incorporate sigma in the predictions rather than focus on expected predictions. If we wanted the CI around a specific value rather than a band then we calculate predictions around that X value. All involve feeding in data.</p>
<p>Here we are doing the same thing, feeding in values to predict but choosing them to be “weighted” however we want.</p>
</section>
<section id="mr.p-not-limited-to-surveys" class="level2">
<h2 class="anchored" data-anchor-id="mr.p-not-limited-to-surveys">Mr.P Not limited to surveys</h2>
<p>Example (using brms) with experimental data – can you generalize from your sample of undergraduates to other undergraduates at your university, let alone undergraduates in general, let alone young adults, to say nothing about the population of humans. https://arxiv.org/pdf/1906.11323.pdf</p>
<p>More info: https://marginaleffects.com/articles/mrp.html</p>
</section>
<section id="recent-example" class="level2">
<h2 class="anchored" data-anchor-id="recent-example">recent example</h2>
<p>https://osf.io/preprints/psyarxiv/fcm3n/</p>
<p><img src="mrp.png" class="img-fluid"></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>